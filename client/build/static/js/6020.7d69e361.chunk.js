"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[6020],{23415:(e,t,l)=>{l.d(t,{A:()=>o});l(14556);var n=l(91688),r=l(70579);const o=()=>{var e;const t=null===(e=localStorage)||void 0===e?void 0:e.getItem("user");return console.log(t,"loggin"),t?null:(0,r.jsx)(n.Redirect,{to:"/pages/authentication/login"})}},91439:(e,t,l)=>{l.d(t,{A:()=>d});var n=l(65043),r=l(21450),o=l(85369),a=l(40854),s=l.n(a),i=l(70579);const d=e=>{var t;let{employees:l}=e;const[a,d]=(0,n.useState)(JSON.parse(null===(t=localStorage)||void 0===t?void 0:t.getItem("user"))),[c,u]=(0,n.useState)();(0,n.useEffect)((()=>{m()}));const m=async()=>{try{var e;const t=await s().get("http://54.81.250.98:8083/api/users/company/?companyId=".concat(null===a||void 0===a||null===(e=a.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===a||void 0===a?void 0:a.accessToken}});console.log(t.data,"company name"),u(t.data)}catch(t){console.error("Error fetching documents:",null===t||void 0===t?void 0:t.message)}};console.log(l,"employees");const p=(e,t)=>[...e.values()].find((e=>null===e.department&&null===t.department||5===t.roleId&&e.department===t.department?e.roleId===t.roleId-1:5===t.roleId&&"Piping"===t.department?1===e.roleId:4===t.roleId&&"Process"===t.department?2===e.roleId&&"Process"===e.department:2===t.roleId||e.department===t.department?e.roleId===t.roleId-1:5===t.roleId&&"Instrumentation"===t.department&&1===e.roleId)),h=e=>{const t=0===e.children.length;return(0,i.jsxs)(r.n,{label:(0,i.jsxs)("div",{style:{backgroundColor:(e=>{switch(e){case 1:return"#FFD700";case 2:return"#87CEEB";case 3:return"#90EE90";case 4:return"#FFA07A";case 5:return"#DDA0DD";default:return"#FFFFFF"}})(e.roleId),padding:"4px",borderRadius:"16px",fontWeight:"bold",cursor:t?"default":"pointer"},children:[e.lastName,"-",e.department,"-",e.roleTitle,t&&(0,i.jsx)(o.sHz,{style:{marginLeft:"2px",fontSize:"20px",color:"#008000"}})]}),children:[e.children.map((e=>h(e)))," "]},e.id.toString())};return(0,i.jsx)("div",{style:{overflowX:"auto"},children:(0,i.jsx)(r.P,{label:(0,i.jsx)("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#333"},children:2==a.user.roleId?a.user.department:c}),children:(e=>{const t=new Map;e.forEach((e=>{t.set(e.id,{...e,children:[]})})),console.log(t,"employeeMap");const l=[];return t.forEach((e=>{const n=e.roleId,r=e.department;if(2==a.user.roleId)if(r&&2===n)l.push(e);else{const l=p(t,e);l&&l.children.push(e)}else if(r||1!==n){const l=p(t,e);l&&l.children.push(e)}else l.push(e)})),console.log(l,"tree"),l})(l).map((e=>h(e)))})})}},26020:(e,t,l)=>{l.r(t),l.d(t,{default:()=>k});var n=l(65043),r=l(91688),o=l(60521),a=l(64435),s=l(89421),i=l(15627),d=l(21261),c=l(94376),u=l(70610),m=l(78186),p=l(47419),h=l(11645),g=l(26412),v=l(22285),x=l(40854),y=l.n(x),f=l(23415),I=l(70579);var j=l(91439);var A=l(62058),S=l(16854),b=l.n(S);function k(){var e,t,l,x;const[S,k]=(0,n.useState)(""),[E,C]=(0,n.useState)(""),D=(0,n.useRef)(null),T=(0,r.useLocation)(),[w,N]=(0,n.useState)(null),[z,F]=(0,n.useState)(!0),[P,J]=(0,n.useState)([]),[O,R]=(0,n.useState)(""),[_,H]=(0,n.useState)(null),[L,q]=(0,n.useState)([]),[U,B]=(0,n.useState)(!1),[W,X]=(0,n.useState)(!1),[K,M]=(0,n.useState)(""),[Q,G]=(0,n.useState)(""),[V,Y]=(0,n.useState)(""),[Z,$]=(0,n.useState)(""),ee=/\S+@\S+\.\S+/.test(K),[te,le]=(0,n.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[ne,re]=(0,n.useState)([]),[oe,ae]=(0,n.useState)([]),[se,ie]=(0,n.useState)(!1),de=(null===(t=T.state)||void 0===t?void 0:t.users)||null,[ce,ue]=(0,n.useState)(null);console.log(de,"users");(0,n.useEffect)((()=>{const e=setTimeout((()=>{J(L.map((e=>e.label))),F(!1)}),1e3);return()=>clearTimeout(e)}),[L]);const me=()=>{B(!1)},pe=()=>{X(!1)},he=(e,t,l)=>{t(),k(e[0]),C(l)},ge=e=>({filterDropdown:t=>{let{setSelectedKeys:l,selectedKeys:n,confirm:r,clearFilters:i,close:d}=t;return(0,I.jsxs)("div",{style:{padding:8},children:[(0,I.jsx)(o.A,{ref:D,placeholder:"Search ".concat(e),value:n[0],onChange:e=>l(e.target.value?[e.target.value]:[]),onPressEnter:()=>he(n,r,e),style:{marginBottom:8,display:"block"}}),(0,I.jsxs)(a.A,{children:[(0,I.jsx)(s.A,{type:"primary",onClick:()=>he(n,r,e),icon:(0,I.jsx)(A.A,{}),size:"small",style:{width:90},children:"Search"}),(0,I.jsx)(s.A,{onClick:()=>i&&(e=>{e(),k("")})(i),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,I.jsx)(A.A,{style:{color:e?"#1677ff":void 0}}),onFilter:(t,l)=>l[e].toString().toLowerCase().includes(t.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null===(e=D.current)||void 0===e?void 0:e.select()}),100)},render:t=>E===e?(0,I.jsx)(b(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[S],autoEscape:!0,textToHighlight:t?t.toString():""}):t}),ve=[{title:"Name",dataIndex:"firstName",key:"firstName",...ge("firstName")},{title:"Department",dataIndex:"department",key:"department",...ge("department")},{title:"Role",dataIndex:"roleTitle",key:"roleTitle",filters:[{text:"Lead",value:"Head"},{text:"Senior Engineer",value:"Senior"},{text:"Junior Engineer",value:"Junior"},{text:"Designer",value:"Designer"}],onFilter:(e,t)=>t.roleTitle===e},{title:"Reporting To",dataIndex:"reported_to",key:"reported_to",...ge("reported_to")},{title:"Email",dataIndex:"email",key:"email",...ge("email")},{title:"Action",key:"action",render:(e,t)=>(0,I.jsx)(a.A,{size:"middle",children:(0,I.jsx)("a",{children:"Delete"})})}],xe=async()=>{console.log(te.user.roleId,"roleId");try{if(2==te.user.roleId){var e;const t=await y().get("http://54.81.250.98:8083/api/users?companyId=".concat(null===te||void 0===te||null===(e=te.user)||void 0===e?void 0:e.companyId,"&departmentId=").concat(te.user.departmentId),{headers:{Authorization:null===te||void 0===te?void 0:te.accessToken}});re(t.data),ae(t.data)}else{var t;const e=await y().get("http://54.81.250.98:8083/api/users?companyId=".concat(null===te||void 0===te||null===(t=te.user)||void 0===t?void 0:t.companyId),{headers:{Authorization:null===te||void 0===te?void 0:te.accessToken}});console.log(e.data);const l=["Head of Department","Senior Engineer","Junior Engineer","Designer/Draughtsmen"];e.data.sort(((e,t)=>l.indexOf(e.roleTitle)-l.indexOf(t.roleTitle))),re(e.data),ae(e.data),console.log("response",e.data)}}catch(l){console.error("Error fetching documents:",null===l||void 0===l?void 0:l.message)}},ye=e=>{const t=oe.filter((t=>t.department===e)),l=["Head of Department","Senior Engineer","Junior Engineer","Designer/Draugthsmen"];t.sort(((e,t)=>l.indexOf(e.roleTitle)-l.indexOf(t.roleTitle))),console.log("filter",t),re(t)};return(0,n.useEffect)((()=>{var e;le(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),de?re(de):((async()=>{try{var e;const t=await y().get("http://54.81.250.98:8083/api/departments?companyId=".concat(null===te||void 0===te||null===(e=te.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===te||void 0===te?void 0:te.accessToken}}),l=[];for(const e of null===t||void 0===t?void 0:t.data)l.push({value:{id:null===e||void 0===e?void 0:e.id,title:null===e||void 0===e?void 0:e.title},label:null===e||void 0===e?void 0:e.title});console.log("departments",l),q(l)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),xe())}),[]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(d.A,{title:"Add User",width:416,centered:!0,visible:U,onCancel:me,footer:null,closeIcon:(0,I.jsx)(v.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,I.jsxs)(c.A,{layout:"vertical",name:"basic",encType:"multipart/form-data",children:[(0,I.jsx)(c.A.Item,{label:"First Name",name:"firstName",rules:[{required:!0,message:"Please input your firstName!"}],children:(0,I.jsx)(o.A,{value:V,onChange:e=>Y(e.target.value)})}),(0,I.jsx)(c.A.Item,{label:"Last Name",name:"lastName",rules:[{required:!0,message:"Please input your lastName!"}],children:(0,I.jsx)(o.A,{value:Z,onChange:e=>$(e.target.value)})}),(0,I.jsx)(c.A.Item,{label:"E-mail :",name:"email",rules:[{type:"email",message:"The input is not valid E-mail!"},{required:!0,message:"Please input your E-mail!"}],children:(0,I.jsx)(o.A,{id:"email",value:K,onChange:e=>M(e.target.value)})}),(0,I.jsx)(c.A.Item,{label:"Role",name:"role",children:(0,I.jsx)(u.A,{defaultValue:"",options:[{value:"head",label:"Head"},{value:"seniorEngineer",label:"Senior Engineer"},{value:"juniorEngineer",label:"Junior Engineer"},{value:"designer",label:"Designer/Draftsmen"}],value:Q,onChange:e=>G(e)})}),(0,I.jsx)(c.A.Item,{label:"Select Department",rules:[{required:!0,message:"Please select one department!"}],children:(0,I.jsx)(m.A.Group,{options:L,value:O,onChange:R})}),(0,I.jsxs)(p.A,{children:[(0,I.jsx)(h.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,I.jsx)(s.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{try{var e,t;const l={head:"2",seniorEngineer:"3",juniorEngineer:"4",designer:"5"};console.log("selectedDeparment",O),console.log("role",Q),console.log(O.id,O.title,"checking");const n=await y().post("http://54.81.250.98:8083/api/users?".concat(w),{roleId:l[Q],companyId:null===te||void 0===te||null===(e=te.user)||void 0===e?void 0:e.companyId,departmentId:O[0].id,department:O[0].title,email:K,firstName:V,lastName:Z},{headers:{Authorization:null===te||void 0===te?void 0:te.accessToken}});console.log(n),i.Ay.success(null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message),xe(),me()}catch(l){console.error("Error adding user:",l)}})(),disabled:!(K.length&&V.length&&Z.length&&ee),className:K.length&&V.length&&Z.length&&ee?"":"disabled-button",children:"Add"})}),(0,I.jsx)(h.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,I.jsx)(s.A,{block:!0,onClick:me,children:"Cancel"})})]})]})}),(0,I.jsxs)(d.A,{title:"Departments",width:416,centered:!0,visible:W,onCancel:pe,footer:null,closeIcon:(0,I.jsx)(v.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:[(0,I.jsx)(s.A,{size:"default",type:"primary",onClick:()=>(pe(),void re(oe)),style:{margin:"8px"},children:"All Departments"}),z?L.map((e=>(0,I.jsx)(s.A,{loading:!0,size:"default",style:{margin:"8px"},children:e.label},e.label))):P.map((e=>(0,I.jsx)(s.A,{size:"default",style:{margin:"8px"},onClick:()=>(e=>{H(e),pe(),ye(e)})(e),type:_===e?"primary":"default",children:e},e)))]}),(0,I.jsxs)("div",{style:{textAlign:"right",marginBottom:"16px"},children:[1==(null===te||void 0===te||null===(l=te.user)||void 0===l?void 0:l.roleId)&&(0,I.jsx)(s.A,{type:"primary",onClick:()=>{B(!0)},children:"Add User"}),(0,I.jsx)(s.A,{type:"primary",onClick:()=>{ie(!0)},onDoubleClick:()=>{ie(!1)},style:{margin:"4px"},children:"User Tree"})]}),se?(0,I.jsx)("div",{style:{overflowX:"auto",width:"1300px"},children:2===(null===te||void 0===te||null===(x=te.user)||void 0===x?void 0:x.roleId)&&de?(0,I.jsx)(j.A,{employees:de}):(0,I.jsx)(j.A,{employees:oe})}):(0,I.jsx)("div",{style:{overflowX:"auto"},children:(0,I.jsx)(g.A,{dataSource:ne,columns:ve,title:()=>"All Users",footer:()=>"You may filter users based on department and roles"})}),(0,I.jsx)(f.A,{})]})}}}]);
//# sourceMappingURL=6020.7d69e361.chunk.js.map