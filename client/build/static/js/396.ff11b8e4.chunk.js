"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[396],{59408:(e,t,o)=>{o.d(t,{c:()=>a});o(33280);var n=o(83144),l=o(82496);const a=()=>{var e;const t=null===(e=localStorage)||void 0===e?void 0:e.getItem("user");return console.log(t,"loggin"),t?null:(0,l.jsx)(n.Redirect,{to:"/pages/authentication/login"})}},15396:(e,t,o)=>{o.r(t),o.d(t,{default:()=>I});var n=o(69060),l=o(83144),a=(o(26701),o(39322)),s=o(57156),i=o(29512),d=o(38088),c=o(9992),r=o(48004),u=o(80336),v=o(74421),m=o(19056),p=o(84196),h=o(26536),g=o.n(h),j=o(38112),x=(o(33280),o(99092),o(92948),o(59408)),y=o(82496);function I(){var e,t,o;const[h,I]=(0,n.useState)(!1),[f,b]=(0,n.useState)(!1),[S,C]=(0,n.useState)(!1),[N,k]=(0,n.useState)(!1),[D,w]=(0,n.useState)(""),[A,O]=(0,n.useState)(""),[R,M]=(0,n.useState)(""),[E,P]=(0,n.useState)(""),[T,z]=(0,n.useState)(""),[J,q]=(0,n.useState)(""),[F,U]=(0,n.useState)([]),[_,G]=(0,n.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[$,B]=(0,n.useState)([]),[H,L]=(0,n.useState)([]),[X,Y]=(0,n.useState)([]),[K,Q]=(0,n.useState)([]),[V,W]=(0,n.useState)([]),[Z,ee]=(0,n.useState)([]),[te,oe]=(0,n.useState)([]),[ne,le]=(0,n.useState)(!1),[ae,se]=(0,n.useState)([]),[ie,de]=(0,n.useState)([]),[ce,re]=(0,n.useState)([]),[ue,ve]=(0,n.useState)([]),[me,pe]=(0,n.useState)([]),[he,ge]=(0,n.useState)(),[je,xe]=(0,n.useState)(),ye=JSON.stringify(ie);console.log("serialized",ye);const Ie=(0,l.useHistory)(),fe=()=>{const e=F.find((e=>(null===e||void 0===e?void 0:e.value)==A));console.log("departmentOptions",ae);const t=JSON.stringify(ae),o=JSON.stringify(ie);console.log("serialized",o);const n=JSON.stringify(F),l=JSON.stringify(Z),a=JSON.stringify(X);Ie.push("/pages/initialMDR?projectCode=".concat(e.code,"&mdrCode=").concat(E,"\n    &departmentOption=").concat(o,"&departmentOptions=").concat(t,"\n    &projectOptions=").concat(n,"&projectId=").concat(A,"&projectCode=").concat(je,"\n    &departmentId=").concat(H,"&title=").concat(D,"&approver=").concat(l,"&reviewer=").concat(a))},be=()=>{w(""),O(""),M(""),I(!1)};const Se=async e=>{console.log("record",e),Ne(e)},Ce=async e=>{if(await Ne(e),console.log(0,"counttt"),K.length>0){const e=(e=>{const t=[],o=Object.keys(e[0]);return t.push(o.join(",")),e.forEach((e=>{const n=o.map((t=>"string"===typeof e[t]&&e[t].includes(",")?'"'.concat(e[t].replace(/"/g,'""'),'"'):e[t]));t.push(n.join(","))})),t.join("\n")})(K),t=new Blob([e],{type:"text/csv"}),o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.setAttribute("download","MDR ".concat(K[0].masterDocumentId,".csv")),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},Ne=async e=>{try{console.log("recorddd",e);const t=await g().get("http://54.81.250.98:8083/api/documents?masterDocumentId=".concat(e.mdrCode,"&projectId=").concat(e.projectId,"&companyId=").concat(e.companyId),{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}});Q(t.data),console.log(K,"hiiiiiiiii"),console.log(t.data,"received")}catch(t){console.error("Error fetching documents:",null===t||void 0===t?void 0:t.message)}};(0,n.useEffect)((()=>{}),[K]);const ke=async()=>{try{var e,t,o,n;const l=await g().get("http://54.81.250.98:8083/api/documents/mdr?companyId=".concat(null===_||void 0===_||null===(e=_.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}});if(console.log("mdr data",l.data),xe(l.data.projectCode),3===(null===_||void 0===_||null===(t=_.user)||void 0===t?void 0:t.roleId)||4===(null===_||void 0===_||null===(o=_.user)||void 0===o?void 0:o.roleId)){const e=l.data.filter((e=>{var t;return e.authorId===(null===_||void 0===_||null===(t=_.user)||void 0===t?void 0:t.id)}));console.log("data",e),B(e)}else if(2===(null===_||void 0===_||null===(n=_.user)||void 0===n?void 0:n.roleId)){const e=l.data.filter((e=>{var t;return e.authorId===(null===_||void 0===_||null===(t=_.user)||void 0===t?void 0:t.id)}));B(e)}else B(l.data)}catch(l){console.error("Error fetching documents:",null===l||void 0===l?void 0:l.message)}};return(0,n.useEffect)((()=>{var e;G(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),(async()=>{try{var e;const t=await g().get("http://54.81.250.98:8083/api/departments?companyId=".concat(null===_||void 0===_||null===(e=_.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}}),o=[],n=[];for(const e of null===t||void 0===t?void 0:t.data)o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title}),n.push({value:null===e||void 0===e?void 0:e.suffix,label:null===e||void 0===e?void 0:e.title});console.log("option",n),console.log("options",o),se(o),de(n),console.log("option",n)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const t=await g().get("http://54.81.250.98:8083/api/projects?companyId=".concat(null===_||void 0===_||null===(e=_.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}}),o=new Set,n=null===t||void 0===t?void 0:t.data.reduce(((e,t)=>(o.has(t.title)||(o.add(t.title),e.push({value:t.id,label:t.title,code:t.code})),e)),[]);console.log(t.data),U(n),console.log(F)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const o=await g().get("http://54.81.250.98:8083/api/users?companyId=".concat(null===_||void 0===_||null===(e=_.user)||void 0===e?void 0:e.companyId,"&roleId=2"),{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}});oe(o.data),console.log(null===o||void 0===o?void 0:o.data,"Users");const n=[],l=[];for(const e of null===o||void 0===o?void 0:o.data){var t="Engineer";1==e.roleId&&(t="CEO",n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName,departmentId:null===e||void 0===e?void 0:e.departmentId,department:e.department},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),2==e.roleId&&(t="HEAD of ".concat(e.department),n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")}),l.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),3==e.roleId&&(t="Senior Engineer ".concat(e.department),n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")}),l.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),4==e.roleId&&(t="Junior"),5==e.roleId&&(t="Designer/Draughtsmen")}const a=n.filter((e=>1!==e.roleId));ve(a),re(n),pe(l),console.log("my options",n),console.log("my users",ce)}catch(o){console.error("Error fetching departments:",null===o||void 0===o?void 0:o.message)}})(),ke(),console.log($)}),[]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(a.c,{title:"Upload Document",width:400,centered:!0,visible:h,onCancel:be,footer:null,closeIcon:(0,y.jsx)(j.M5$,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(s.c,{justify:"space-between",align:"center",children:(0,y.jsx)(i.c,{span:20,children:(0,y.jsxs)(d.c,{layout:"vertical",name:"basic",children:[(0,y.jsx)(d.c.Item,{label:"MDR Title",name:"docTitle",rules:[{required:!0,message:"Please input your title"}],children:(0,y.jsx)(c.c,{value:D,onChange:e=>w(e.target.value)})}),(0,y.jsx)(d.c.Item,{label:"MDR Code",name:"docCode",rules:[{required:!0,message:"Please input your code"}],children:(0,y.jsx)(c.c,{value:D,onChange:e=>P(e.target.value)})}),(0,y.jsx)(d.c.Item,{label:"Departments",name:"departmentIds",rules:[{required:!0,message:"Please select at least one department"}],children:(0,y.jsx)(r.c.Group,{options:ae,value:H,onChange:L})}),(0,y.jsxs)(d.c.Item,{label:"Project Name",name:"projectName",rules:[{required:!0,message:"Please select Project Name"}],children:[(0,y.jsx)(u.default,{options:F,value:A,onChange:e=>O(e)}),"              "]}),(0,y.jsx)(d.c.Item,{label:"Add Reviewers",name:"reviewers",rules:[{required:!0,message:"Please select Reviewers Name"}],children:(0,y.jsx)(r.c.Group,{options:ce,value:X,onChange:Y})})," ",(0,y.jsx)(d.c.Item,{label:"Add Approvers",name:"approvers",rules:[{required:!0,message:"Please select Approvers Name"}],children:(0,y.jsx)(r.c.Group,{options:ce,value:Z,onChange:ee})}),(0,y.jsxs)(s.c,{children:[(0,y.jsx)(i.c,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(v.c,{block:!0,onClick:fe,type:"primary",htmlType:"submit",children:"MDR template"})}),(0,y.jsx)(i.c,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(v.c,{block:!0,onClick:fe,type:"primary",htmlType:"submit",children:"Create Custom"})})]})]})})})}),(0,y.jsx)(a.c,{title:"Assign Document",width:400,centered:!0,visible:f,onCancel:()=>{b(!1)},footer:null,closeIcon:(0,y.jsx)(j.M5$,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(s.c,{justify:"space-between",align:"center",children:(0,y.jsx)(i.c,{span:20,children:(0,y.jsxs)(d.c,{layout:"vertical",name:"basic",children:[(0,y.jsx)(d.c.Item,{label:"Project Name",name:"projectName",rules:[{required:!0,message:"Please select Project Name"}],children:(0,y.jsx)(u.default,{options:F,value:A,onChange:e=>O(e)})}),(0,y.jsx)(d.c.Item,{label:"Assigned MDR to",name:"assignMDR",rules:[{required:!0,message:"Please Assign MDR"}],children:(0,y.jsx)(u.default,{options:me,value:V,onChange:e=>W(e)})}),(0,y.jsx)(s.c,{children:(0,y.jsx)(i.c,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(v.c,{block:!0,onClick:()=>(async(e,t)=>{try{const o=t.find((t=>t.id==e)),n=F.find((e=>(null===e||void 0===e?void 0:e.value)==A));ae.find((e=>(null===e||void 0===e?void 0:e.value)==R)),await g().post("http://54.81.250.98:8083/api/documents/mdr",{departmentId:o.departmentId,projectId:A,companyId:null===o||void 0===o?void 0:o.companyId,authorId:null===o||void 0===o?void 0:o.id,authorName:null===o||void 0===o?void 0:o.firstName,mdrCode:E,projectCode:null===n||void 0===n?void 0:n.code,departmentName:o.department,status:"Assigned",noOfDocuments:0},{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}}),b(!1),ke()}catch(o){console.error("Error assigning documents:",o)}})(V,te),type:"primary",htmlType:"submit",children:"Assigned"})})}),(0,y.jsx)(s.c,{})]})})})}),(0,y.jsx)(a.c,{title:"Show MDR Documents ",width:400,centered:!0,visible:N,onCancel:()=>{k(!1)},footer:null,closeIcon:(0,y.jsx)(j.M5$,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(s.c,{justify:"space-between",align:"center",children:(0,y.jsx)(i.c,{span:20,children:(0,y.jsxs)("div",{children:[(0,y.jsx)("h3",{children:"MDR Documents"}),(0,y.jsx)("ul",{children:K.map(((e,t)=>(0,y.jsxs)("li",{children:[(0,y.jsx)("strong",{children:"Document Title:"})," ",e.title," ",(0,y.jsx)("br",{})]},t)))})]})})})}),(0,y.jsxs)("div",{style:{textAlign:"right",marginBottom:"16px"},children:[(0,y.jsx)(v.c,{type:"primary",onClick:()=>{I(!0)},disabled:1!=(null===_||void 0===_||null===(t=_.user)||void 0===t?void 0:t.roleId),style:{marginRight:"10px"},children:"Create MDR Yourself"}),(0,y.jsx)(v.c,{type:"primary",onClick:()=>{b(!0)},disabled:1!=(null===_||void 0===_||null===(o=_.user)||void 0===o?void 0:o.roleId),children:"Assign MDR"}),ne&&(0,y.jsx)(MdrTemplate,{})]}),(0,y.jsx)("div",{style:{overflowX:"auto"},children:(0,y.jsx)(m.c,{columns:[{title:"Document Title",dataIndex:"title",key:"title"},{title:"Dept Id",dataIndex:"departmentId",key:"departmentId"},{title:"Dept Name",dataIndex:"departmentName",key:"departmentName"},{title:"Project Id",dataIndex:"projectId",key:"projectId"},{title:"Project Code",dataIndex:"projectCode",key:"projectCode"},{title:"Author Id",dataIndex:"authorId",key:"authorId"},{title:"Author Name",dataIndex:"authorName",key:"authorName"},{title:"No of Documents",dataIndex:"noOfDocuments",key:"noOfDocuments"},{title:"Status",dataIndex:"status",key:"status"},{title:"Action",key:"action",render:(e,t)=>{var o;return(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)(p.c,{size:"middle",children:[(0,y.jsx)(v.c,{onClick:()=>Ce(t),disabled:1!=(null===_||void 0===_||null===(o=_.user)||void 0===o?void 0:o.roleId),children:"Export"},null===t||void 0===t?void 0:t.id),1!==_.user.roleId&&(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(v.c,{onClick:()=>{(e=>{console.log("record",e),ge(e),I(!0)})(t)},children:"Create"},null===t||void 0===t?void 0:t.id)}),1==_.user.roleId&&(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(v.c,{onClick:()=>{(e=>{console.log(e),ge(e),Se(e),k(!0)})(t)},children:"Open"},null===t||void 0===t?void 0:t.id)})]})})}}],dataSource:$})}),(0,y.jsx)(x.c,{})]})}}}]);
//# sourceMappingURL=396.ff11b8e4.chunk.js.map