"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[348],{23415:(e,o,t)=>{t.d(o,{A:()=>a});t(14556);var n=t(91688),l=t(70579);const a=()=>{var e;const o=null===(e=localStorage)||void 0===e?void 0:e.getItem("user");return console.log(o,"loggin"),o?null:(0,l.jsx)(n.Redirect,{to:"/pages/authentication/login"})}},80967:(e,o,t)=>{t.r(o),t.d(o,{default:()=>A});var n=t(65043),l=t(91688),a=(t(15627),t(21261)),s=t(47419),i=t(11645),d=t(94376),r=t(62967),c=t(78186),u=t(33733),v=t(89421),m=t(26412),p=t(64435),h=t(40854),g=t.n(h),j=t(73754),x=(t(14556),t(92823),t(25884),t(23415)),y=t(70579);function A(){var e,o,t;const[h,A]=(0,n.useState)(!1),[I,f]=(0,n.useState)(!1),[b,C]=(0,n.useState)(!1),[S,N]=(0,n.useState)(!1),[k,D]=(0,n.useState)(""),[w,O]=(0,n.useState)(""),[R,E]=(0,n.useState)(""),[T,M]=(0,n.useState)(""),[P,z]=(0,n.useState)(""),[J,q]=(0,n.useState)(""),[F,U]=(0,n.useState)([]),[_,G]=(0,n.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[Q,B]=(0,n.useState)([]),[H,L]=(0,n.useState)([]),[X,Y]=(0,n.useState)([]),[K,V]=(0,n.useState)([]),[W,Z]=(0,n.useState)([]),[$,ee]=(0,n.useState)([]),[oe,te]=(0,n.useState)([]),[ne,le]=(0,n.useState)(!1),[ae,se]=(0,n.useState)([]),[ie,de]=(0,n.useState)([]),[re,ce]=(0,n.useState)([]),[ue,ve]=(0,n.useState)([]),[me,pe]=(0,n.useState)([]),[he,ge]=(0,n.useState)(),[je,xe]=(0,n.useState)(),ye=JSON.stringify(ie);console.log("serialized",ye);const Ae=(0,l.useHistory)(),Ie=()=>{const e=F.find((e=>(null===e||void 0===e?void 0:e.value)==w));console.log("departmentOptions",ae);const o=JSON.stringify(ae),t=JSON.stringify(ie);console.log("serialized",t);const n=JSON.stringify(F),l=JSON.stringify($),a=JSON.stringify(X);Ae.push("/pages/initialMDR?projectCode=".concat(e.code,"&mdrCode=").concat(T,"\n    &departmentOption=").concat(t,"&departmentOptions=").concat(o,"\n    &projectOptions=").concat(n,"&projectId=").concat(w,"&projectCode=").concat(je,"\n    &departmentId=").concat(H,"&title=").concat(k,"&approver=").concat(l,"&reviewer=").concat(a))},fe=()=>{D(""),O(""),E(""),A(!1)};const be=async e=>{console.log("record",e),Se(e)},Ce=async e=>{if(await Se(e),console.log(0,"counttt"),K.length>0){const e=(e=>{const o=[],t=Object.keys(e[0]);return o.push(t.join(",")),e.forEach((e=>{const n=t.map((o=>"string"===typeof e[o]&&e[o].includes(",")?'"'.concat(e[o].replace(/"/g,'""'),'"'):e[o]));o.push(n.join(","))})),o.join("\n")})(K),o=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(o),n=document.createElement("a");n.href=t,n.setAttribute("download","MDR ".concat(K[0].masterDocumentId,".csv")),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},Se=async e=>{try{console.log("recorddd",e);const o=await g().get("http://54.81.250.98:8083/api/documents?masterDocumentId=".concat(e.mdrCode,"&projectId=").concat(e.projectId,"&companyId=").concat(e.companyId),{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}});V(o.data),console.log(K,"hiiiiiiiii"),console.log(o.data,"received")}catch(o){console.error("Error fetching documents:",null===o||void 0===o?void 0:o.message)}};(0,n.useEffect)((()=>{}),[K]);const Ne=async()=>{try{var e,o,t,n;const l=await g().get("http://54.81.250.98:8083/api/documents/mdr?companyId=".concat(null===_||void 0===_||null===(e=_.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}});if(console.log("mdr data",l.data),xe(l.data.projectCode),3===(null===_||void 0===_||null===(o=_.user)||void 0===o?void 0:o.roleId)||4===(null===_||void 0===_||null===(t=_.user)||void 0===t?void 0:t.roleId)){const e=l.data.filter((e=>{var o;return e.authorId===(null===_||void 0===_||null===(o=_.user)||void 0===o?void 0:o.id)}));console.log("data",e),B(e)}else if(2===(null===_||void 0===_||null===(n=_.user)||void 0===n?void 0:n.roleId)){const e=l.data.filter((e=>{var o;return e.authorId===(null===_||void 0===_||null===(o=_.user)||void 0===o?void 0:o.id)}));B(e)}else B(l.data)}catch(l){console.error("Error fetching documents:",null===l||void 0===l?void 0:l.message)}};return(0,n.useEffect)((()=>{var e;G(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),(async()=>{try{var e;const o=await g().get("http://54.81.250.98:8083/api/departments?companyId=".concat(null===_||void 0===_||null===(e=_.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}}),t=[],n=[];for(const e of null===o||void 0===o?void 0:o.data)t.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title}),n.push({value:null===e||void 0===e?void 0:e.suffix,label:null===e||void 0===e?void 0:e.title});console.log("option",n),console.log("options",t),se(t),de(n),console.log("option",n)}catch(o){console.error("Error fetching departments:",null===o||void 0===o?void 0:o.message)}})(),(async()=>{try{var e;const o=await g().get("http://54.81.250.98:8083/api/projects?companyId=".concat(null===_||void 0===_||null===(e=_.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}}),t=new Set,n=null===o||void 0===o?void 0:o.data.reduce(((e,o)=>(t.has(o.title)||(t.add(o.title),e.push({value:o.id,label:o.title,code:o.code})),e)),[]);console.log(o.data),U(n),console.log(F)}catch(o){console.error("Error fetching departments:",null===o||void 0===o?void 0:o.message)}})(),(async()=>{try{var e;const t=await g().get("http://54.81.250.98:8083/api/users?companyId=".concat(null===_||void 0===_||null===(e=_.user)||void 0===e?void 0:e.companyId,"&roleId=2"),{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}});te(t.data),console.log(null===t||void 0===t?void 0:t.data,"Users");const n=[],l=[];for(const e of null===t||void 0===t?void 0:t.data){var o="Engineer";1==e.roleId&&(o="CEO",n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName,departmentId:null===e||void 0===e?void 0:e.departmentId,department:e.department},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(o," ")})),2==e.roleId&&(o="HEAD of ".concat(e.department),n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(o," ")}),l.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(o," ")})),3==e.roleId&&(o="Senior Engineer ".concat(e.department),n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(o," ")}),l.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(o," ")})),4==e.roleId&&(o="Junior"),5==e.roleId&&(o="Designer/Draughtsmen")}const a=n.filter((e=>1!==e.roleId));ve(a),ce(n),pe(l),console.log("my options",n),console.log("my users",re)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),Ne(),console.log(Q)}),[]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(a.A,{title:"Upload Document",width:400,centered:!0,visible:h,onCancel:fe,footer:null,closeIcon:(0,y.jsx)(j.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(s.A,{justify:"space-between",align:"center",children:(0,y.jsx)(i.A,{span:20,children:(0,y.jsxs)(d.A,{layout:"vertical",name:"basic",children:[(0,y.jsx)(d.A.Item,{label:"MDR Title",name:"docTitle",rules:[{required:!0,message:"Please input your title"}],children:(0,y.jsx)(r.A,{value:k,onChange:e=>D(e.target.value)})}),(0,y.jsx)(d.A.Item,{label:"MDR Code",name:"docCode",rules:[{required:!0,message:"Please input your code"}],children:(0,y.jsx)(r.A,{value:k,onChange:e=>M(e.target.value)})}),(0,y.jsx)(d.A.Item,{label:"Departments",name:"departmentIds",rules:[{required:!0,message:"Please select at least one department"}],children:(0,y.jsx)(c.A.Group,{options:ae,value:H,onChange:L})}),(0,y.jsxs)(d.A.Item,{label:"Project Name",name:"projectName",rules:[{required:!0,message:"Please select Project Name"}],children:[(0,y.jsx)(u.A,{options:F,value:w,onChange:e=>O(e)}),"              "]}),(0,y.jsx)(d.A.Item,{label:"Add Reviewers",name:"reviewers",rules:[{required:!0,message:"Please select Reviewers Name"}],children:(0,y.jsx)(c.A.Group,{options:re,value:X,onChange:Y})})," ",(0,y.jsx)(d.A.Item,{label:"Add Approvers",name:"approvers",rules:[{required:!0,message:"Please select Approvers Name"}],children:(0,y.jsx)(c.A.Group,{options:re,value:$,onChange:ee})}),(0,y.jsxs)(s.A,{children:[(0,y.jsx)(i.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(v.A,{block:!0,onClick:Ie,type:"primary",htmlType:"submit",children:"MDR template"})}),(0,y.jsx)(i.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(v.A,{block:!0,onClick:Ie,type:"primary",htmlType:"submit",children:"Create Custom"})})]})]})})})}),(0,y.jsx)(a.A,{title:"Assign Document",width:400,centered:!0,visible:I,onCancel:()=>{f(!1)},footer:null,closeIcon:(0,y.jsx)(j.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(s.A,{justify:"space-between",align:"center",children:(0,y.jsx)(i.A,{span:20,children:(0,y.jsxs)(d.A,{layout:"vertical",name:"basic",children:[(0,y.jsx)(d.A.Item,{label:"Project Name",name:"projectName",rules:[{required:!0,message:"Please select Project Name"}],children:(0,y.jsx)(u.A,{options:F,value:w,onChange:e=>O(e)})}),(0,y.jsx)(d.A.Item,{label:"Assigned MDR to",name:"assignMDR",rules:[{required:!0,message:"Please Assign MDR"}],children:(0,y.jsx)(u.A,{options:me,value:W,onChange:e=>Z(e)})}),(0,y.jsx)(s.A,{children:(0,y.jsx)(i.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(v.A,{block:!0,onClick:()=>(async(e,o)=>{try{const t=o.find((o=>o.id==e)),n=F.find((e=>(null===e||void 0===e?void 0:e.value)==w));ae.find((e=>(null===e||void 0===e?void 0:e.value)==R)),await g().post("http://54.81.250.98:8083/api/documents/mdr",{departmentId:t.departmentId,projectId:w,companyId:null===t||void 0===t?void 0:t.companyId,authorId:null===t||void 0===t?void 0:t.id,authorName:null===t||void 0===t?void 0:t.firstName,mdrCode:T,projectCode:null===n||void 0===n?void 0:n.code,departmentName:t.department,status:"Assigned",noOfDocuments:0},{headers:{Authorization:null===_||void 0===_?void 0:_.accessToken}}),f(!1),Ne()}catch(t){console.error("Error assigning documents:",t)}})(W,oe),type:"primary",htmlType:"submit",children:"Assigned"})})}),(0,y.jsx)(s.A,{})]})})})}),(0,y.jsx)(a.A,{title:"Show MDR Documents ",width:400,centered:!0,visible:S,onCancel:()=>{N(!1)},footer:null,closeIcon:(0,y.jsx)(j.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(s.A,{justify:"space-between",align:"center",children:(0,y.jsx)(i.A,{span:20,children:(0,y.jsxs)("div",{children:[(0,y.jsx)("h3",{children:"MDR Documents"}),(0,y.jsx)("ul",{children:K.map(((e,o)=>(0,y.jsxs)("li",{children:[(0,y.jsx)("strong",{children:"Document Title:"})," ",e.title," ",(0,y.jsx)("br",{})]},o)))})]})})})}),(0,y.jsxs)("div",{style:{textAlign:"right",marginBottom:"16px"},children:[(0,y.jsx)(v.A,{type:"primary",onClick:()=>{A(!0)},disabled:1!=(null===_||void 0===_||null===(o=_.user)||void 0===o?void 0:o.roleId),style:{marginRight:"10px"},children:"Create MDR Yourself"}),(0,y.jsx)(v.A,{type:"primary",onClick:()=>{f(!0)},disabled:1!=(null===_||void 0===_||null===(t=_.user)||void 0===t?void 0:t.roleId),children:"Assign MDR"}),ne&&(0,y.jsx)(MdrTemplate,{})]}),(0,y.jsx)("div",{style:{overflowX:"auto"},children:(0,y.jsx)(m.A,{columns:[{title:"Document Title",dataIndex:"title",key:"title"},{title:"Project Code",dataIndex:"projectCode",key:"projectCode"},{title:"Dept Name",dataIndex:"departmentName",key:"departmentName"},{title:"Author Name",dataIndex:"authorName",key:"authorName"},{title:"No of Documents",dataIndex:"noOfDocuments",key:"noOfDocuments"},{title:"Status",dataIndex:"status",key:"status"},{title:"Action",key:"action",render:(e,o)=>{var t;return(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)(p.A,{size:"middle",children:[(0,y.jsx)(v.A,{onClick:()=>Ce(o),disabled:1!=(null===_||void 0===_||null===(t=_.user)||void 0===t?void 0:t.roleId),children:"Export"},null===o||void 0===o?void 0:o.id),1!==_.user.roleId&&(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(v.A,{onClick:()=>{(e=>{console.log("record",e),ge(e),A(!0)})(o)},children:"Create"},null===o||void 0===o?void 0:o.id)}),1==_.user.roleId&&(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(v.A,{onClick:()=>{(e=>{console.log(e),ge(e),be(e),N(!0)})(o)},children:"Open"},null===o||void 0===o?void 0:o.id)})]})})}}],dataSource:Q})}),(0,y.jsx)(x.A,{})]})}}}]);
//# sourceMappingURL=348.613d7dfa.chunk.js.map