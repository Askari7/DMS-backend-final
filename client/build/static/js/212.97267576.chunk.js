"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[212],{33212:(e,t,o)=>{o.r(t),o.d(t,{default:()=>f});var r=o(65043),s=o(64435),a=o(15627),n=o(21261),i=o(47419),l=o(11645),d=o(94376),c=o(33733),u=o(62967),p=o(89421),m=o(26412),v=o(73754),h=o(40854),x=o.n(h),S=o(78186),y=o(70579);function f(){var e,t;const o=[{title:"Document Name",dataIndex:"docName",key:"docName"},{title:"MDR Code",dataIndex:"masterDocumentCode",key:"masterDocumentCode"},{title:"Approver",dataIndex:"approver",key:"approver"},{title:"Reviewer",dataIndex:"reviewer",key:"reviewer"},{title:"Your Role",dataIndex:"yourRole",key:"yourRole"},{title:"Your Status",dataIndex:"yourStatus",key:"yourStatus"},{title:"Overall Approver Status",dataIndex:"approverStatuss",key:"approverStatuss"},{title:"Overall Reviewer Status",dataIndex:"reviewerStatuss",key:"reviewerStatuss"},{title:"Creator",dataIndex:"allowCreate",key:"allowCreate"},{title:"Action",key:"action",render:(e,t)=>(0,y.jsxs)(s.A,{size:"middle",children:[(0,y.jsx)("a",{onClick:()=>je(t),children:"Open"}),(0,y.jsx)("a",{onClick:()=>xe(t),children:"Add Status"}),(0,y.jsx)("a",{onClick:()=>ye(t),children:"Send to Client"})]})}],[h,f]=(0,r.useState)(""),[g,A]=(0,r.useState)(""),[j,w]=(0,r.useState)(null),[I,k]=(0,r.useState)(!1),[C,b]=(0,r.useState)(!1),[O,R]=(0,r.useState)([]),[N,z]=(0,r.useState)(!1),[E,P]=(0,r.useState)([]),[D,T]=(0,r.useState)([]),[M,q]=(0,r.useState)(""),[G,F]=(0,r.useState)(""),[U,Y]=(0,r.useState)(!1),[B,Q]=(0,r.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[_,J]=(0,r.useState)([]),[L,V]=(0,r.useState)([]),[W,X]=(0,r.useState)([]),[H,K]=(0,r.useState)([]),[Z,$]=(0,r.useState)([]),[ee,te]=(0,r.useState)([]),[oe,re]=(0,r.useState)([]),[se,ae]=(0,r.useState)([]),[ne,ie]=(0,r.useState)([]),[le,de]=(0,r.useState)([]),[ce,ue]=(0,r.useState)([]),[pe,me]=(0,r.useState)(!1),[ve,he]=(0,r.useState)(""),xe=e=>{w(e),k(!0)},Se=()=>{f(""),k(!1)},ye=e=>{b(!0)},fe=()=>{b(!1)},[ge,Ae]=(0,r.useState)(""),je=async e=>{const t=await(async e=>{try{var t;const o=await x().get("http://54.81.250.98:8083/api/documents/establishment?companyId=".concat(null===B||void 0===B||null===(t=B.user)||void 0===t?void 0:t.companyId,"&userId=").concat(B.user.id,"&docName=").concat(e),{headers:{Authorization:null===B||void 0===B?void 0:B.accessToken}});return console.log(o.data,"received"),o.data}catch(o){console.error("Error fetching documents:",null===o||void 0===o?void 0:o.message)}})(e.docName);console.log("helllooo",t);const o=e.docName,r="".concat("http://54.81.250.98:8083","/documents/").concat(o,"-").concat(e.version,".pdf");console.log(B.user.roleId,B.user.firstName,B);let s="false";t&&(s="true"),window.location.href="http://54.81.250.98:3001/react-pdf-highlighter/?docName=".concat(o,".pdf&url=").concat(r,"&allowed=").concat(s,"&user=").concat(B.user.roleId," ").concat(B.user.firstName)},we=()=>{F(""),z(!1)},Ie=async()=>{try{var e,t;const o=await x().get("http://54.81.250.98:8083/api/documents/establishment?companyId=".concat(null===B||void 0===B||null===(e=B.user)||void 0===e?void 0:e.companyId,"&userId=").concat(null===B||void 0===B||null===(t=B.user)||void 0===t?void 0:t.id),{headers:{Authorization:null===B||void 0===B?void 0:B.accessToken}});console.log("response",o.data);for(let e of o.data){const t=e.approverStatus.split(",").map((e=>parseInt(e.trim(),10))),o=e.reviewerStatus.split(",").map((e=>parseInt(e.trim(),10))),r=e.reviewerId.split(",").map((e=>parseInt(e.trim(),10))),s=e.approverId.split(",").map((e=>parseInt(e.trim(),10)));ue(e.reviewerId.split(",").map((e=>parseInt(e.trim(),10)))),de(e.approverId.split(",").map((e=>parseInt(e.trim(),10)))),re(e.reviewerStatus.split(",").map((e=>parseInt(e.trim(),10)))),te(e.approverStatus.split(",").map((e=>parseInt(e.trim(),10)))),console.log(oe,ee,"hii"),e.approverId.includes(B.user.id)&&e.reviewerId.includes(B.user.id)?(console.log("YESSSSSSSSSSS"),e.yourRole="Approver and Reviewer",console.log(s.indexOf(B.user.id),"jjjjj"),console.log(s,B.user.id,t[s.indexOf(B.user.id)],"ssss"+typeof t),1==t[s.indexOf(B.user.id)]?e.yourStatus="Rejected":2==t[s.indexOf(B.user.id)]?e.yourStatus="Accepted":0==t[s.indexOf(B.user.id)]&&(e.yourStatus="Pending")):s.includes(B.user.id)?(console.log("YESSSSSSSSSSS"),e.yourRole="Approver",he(s.indexOf(B.user.id)),console.log(s.indexOf(B.user.id),"jjjjj"),console.log(s,B.user.id,t[s.indexOf(B.user.id)],"ssss"+typeof t),1==t[s.indexOf(B.user.id)]?e.yourStatus="Rejected":2==t[s.indexOf(B.user.id)]?e.yourStatus="Accepted":0==t[s.indexOf(B.user.id)]&&(e.yourStatus="Pending")):r.includes(B.user.id)&&(console.log("YESSSSSSSSSSS"),e.yourRole="Reviewer",he(r.indexOf(B.user.id)),console.log(r.indexOf(B.user.id),"jjjjj"),console.log(r,B.user.id,o[r.indexOf(B.user.id)],"ssss"+typeof o),1==o[r.indexOf(B.user.id)]?e.yourStatus="Rejected":2==o[r.indexOf(B.user.id)]?e.yourStatus="Accepted":0==o[r.indexOf(B.user.id)]&&(e.yourStatus="Pending")),t.every((e=>0===e))?e.approverStatuss="Pending":t.some((e=>0!==e&&2!==e))?e.approverStatuss="Rejected":t.every((e=>2===e))&&(e.approverStatuss="Sent to Client"),o.every((e=>0===e))?e.reviewerStatuss="Pending":o.every((e=>1===e))?e.reviewerStatuss="Rejected":o.every((e=>2===e))?e.reviewerStatuss="Sent for Approval":e.reviewerStatuss="Pending"}J(o.data)}catch(o){console.error("Error fetching departments:",null===o||void 0===o?void 0:o.message)}},ke=async e=>{try{console.log(oe,ee,"hohohoho");let t=[...oe],o=[...ee],r=[...ne],s=[...se];"Approver and Reviewer"===e.yourRole&&"Accept"===h?(1,o[le.indexOf(B.user.id)]=2,s[le.indexOf(B.user.id)]="",te(o),ae(s),t[ce.indexOf(B.user.id)]=2,r[ce.indexOf(B.user.id)]="",ie(r)):"Approver and Reviewer"===e.yourRole&&"Reject"===h?(1,o[le.indexOf(B.user.id)]=1,s[le.indexOf(B.user.id)]=e.remarks,ae(o),0,r[ce.indexOf(B.user.id)]=e.remarks,ie(r)):"Approver"===e.yourRole&&"Accept"===h?(1,o[le.indexOf(B.user.id)]=2,te(o),s[le.indexOf(B.user.id)]="",ae(s)):"Reviewer"===e.yourRole&&"Accept"===h?(0,t[ce.indexOf(B.user.id)]=2,re(t),r[ce.indexOf(B.user.id)]="",ie(r)):"Approver"===e.yourRole&&"Reject"===h?(1,o[le.indexOf(B.user.id)]=1,te(o),s[le.indexOf(B.user.id)]=e.remarks,ae(s)):"Reviewer"===e.yourRole&&"Reject"===h&&(0,t[ce.indexOf(B.user.id)]=1,re(t),r[ce.indexOf(B.user.id)]=e.remarks,ie(r)),console.log(e.yourRole,h,t.join(","),o.join(","));const a=await x().put("http://54.81.250.98:8083/api/documents/establishment",{status:h,revStatusArr:t.join(","),appStatusArr:o.join(","),reviewerComment:r.join(","),approverComment:s.join(","),docName:e.docName},{headers:{Authorization:null===B||void 0===B?void 0:B.accessToken}});console.log(a.data),await Ie()}catch(t){console.error("Error assigning documents:",t)}};return(0,r.useEffect)((async()=>{var e;Q(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),await Ie(),(async()=>{try{var e;const t=await x().get("http://54.81.250.98:8083/api/users?companyId=".concat(null===B||void 0===B||null===(e=B.user)||void 0===e?void 0:e.companyId,"&roleId=2"),{headers:{Authorization:null===B||void 0===B?void 0:B.accessToken}});console.log(null===t||void 0===t?void 0:t.data,"UUUAUA");const o=[];for(const e of null===t||void 0===t?void 0:t.data)o.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(null===e||void 0===e?void 0:e.lastName)});T(o)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const t=await x().get("http://54.81.250.98:8083/api/documents/mdr?companyId=".concat(null===B||void 0===B||null===(e=B.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===B||void 0===B?void 0:B.accessToken}}),o=[];for(const e of null===t||void 0===t?void 0:t.data)o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title,DocumentPermissionId:null===e||void 0===e?void 0:e.DocumentPermissionId,departmentId:null===e||void 0===e?void 0:e.departmentId});P(o)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const t=await x().get("http://54.81.250.98:8083/api/clients?companyId=".concat(null===B||void 0===B||null===(e=B.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===B||void 0===B?void 0:B.accessToken}});console.log(t.data,"received");const o=t.data.map((e=>({value:e.companyName,label:e.companyName})));console.log("clients",o),V(o)}catch(t){console.error("Error fetching clients:",null===t||void 0===t?void 0:t.message)}})()}),[]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(n.A,{title:"Change Status",width:400,centered:!0,visible:I,onCancel:Se,footer:null,closeIcon:(0,y.jsx)(v.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(i.A,{justify:"space-between",align:"center",children:(0,y.jsx)(l.A,{span:20,children:(0,y.jsxs)(d.A,{layout:"vertical",name:"basic",children:[(0,y.jsx)(d.A.Item,{label:"Select Status",name:"selectedStatus",rules:[{required:!0,message:"Please select a status"}],children:(0,y.jsx)(c.A,{options:[{label:"Accept",value:"Accept"},{label:"Reject",value:"Reject"}],value:h,onChange:e=>{return f(t=e),void me("Reject"===t);var t}})}),pe&&(0,y.jsx)(d.A.Item,{label:"Remarks",name:"remarks",rules:[{required:!0,message:"Please provide remarks for rejection"}],children:(0,y.jsx)(u.A.TextArea,{rows:4,placeholder:"Enter remarks for rejection",value:g,onChange:e=>A(e.target.value)})}),(0,y.jsxs)(i.A,{children:[(0,y.jsx)(l.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(p.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{if(console.log("rejection",g),j){const e={...j,status:h,remarks:g};console.log("updated",e);const t=_.map((t=>t.id===j.id?e:t));console.log(t,"updatedData"),$(t),await ke(j),Se()}})(),children:"Submit"})}),(0,y.jsx)(l.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,y.jsx)(p.A,{block:!0,onClick:Se,children:"Cancel"})})]})]})})})}),(0,y.jsx)(n.A,{title:"Send To Client",width:400,centered:!0,visible:C,onCancel:fe,footer:null,closeIcon:(0,y.jsx)(v.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(i.A,{justify:"space-between",align:"center",children:(0,y.jsx)(l.A,{span:20,children:(0,y.jsxs)(d.A,{layout:"vertical",name:"basic",children:[(0,y.jsx)(d.A.Item,{label:"Select Emails",name:"selectedEmails",rules:[{required:!0,message:"Please select a Email"}],children:(0,y.jsx)(c.A,{options:L,value:O,onChange:e=>R(e)})}),(0,y.jsxs)(i.A,{children:[(0,y.jsx)(l.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(p.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{})(),children:"Send"})}),(0,y.jsx)(l.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,y.jsx)(p.A,{block:!0,onClick:fe,children:"Cancel"})})]})]})})})}),(0,y.jsx)(n.A,{title:"Create Permissions",width:416,centered:!0,visible:N,onCancel:we,footer:null,closeIcon:(0,y.jsx)(v.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsxs)(d.A,{layout:"vertical",name:"basic",children:[(0,y.jsx)(d.A.Item,{label:"MDR",name:"mdr",rules:[{required:!0,message:"Please select MDR"}],children:(0,y.jsx)(c.A,{options:E,value:G,onChange:e=>F(e)})}),(0,y.jsx)(d.A.Item,{label:"Users",name:"users",rules:[{required:!0,message:"Please select MDR"}],children:(0,y.jsx)(c.A,{options:D,value:M,onChange:e=>q(e)})}),(0,y.jsx)(d.A.Item,{label:"Permissions",name:"permissions",children:(0,y.jsx)(S.A.Group,{options:[{label:"Reviewer",value:"Reviewer"},{label:"Approver",value:"Approver"},{label:"Creator",value:"Creator"}],defaultValue:0,onChange:e=>{console.log("checked = ",e),K(e)}})}),(0,y.jsxs)(i.A,{children:[(0,y.jsx)(l.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(p.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{try{var e,t;const o=await x().post("http://54.81.250.98:8083/api/documents/permissions",{masterDocumentId:G,userId:M,companyId:null===B||void 0===B||null===(e=B.user)||void 0===e?void 0:e.companyId,createDocument:null===H||void 0===H?void 0:H.includes("Creator"),reviewDocument:null===H||void 0===H?void 0:H.includes("Reviewer"),approveDocument:null===H||void 0===H?void 0:H.includes("Approver")},{headers:{Authorization:null===B||void 0===B?void 0:B.accessToken}});console.log(o),a.Ay.success(null===o||void 0===o||null===(t=o.data)||void 0===t?void 0:t.message),F(""),q(""),K([]),await Ie(),z(!1)}catch(o){"Request failed with status code 403"==(null===o||void 0===o?void 0:o.message)&&a.Ay.error("Permission Denied to create document on this MDR")}})(),children:"Add"})}),(0,y.jsx)(l.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,y.jsx)(p.A,{block:!0,onClick:we,children:"Cancel"})})]})]})}),(0,y.jsx)("div",{style:{textAlign:"right",marginBottom:"16px"},children:(0,y.jsx)(p.A,{type:"primary",onClick:()=>{z(!0)},disabled:1!=(null===B||void 0===B||null===(t=B.user)||void 0===t?void 0:t.roleId),children:"Add Permissions"})}),(0,y.jsx)("div",{style:{overflowX:"auto"},children:(0,y.jsx)(m.A,{columns:o,dataSource:_})})]})}},64435:(e,t,o)=>{o.d(t,{e:()=>v,A:()=>x});var r=o(58168),s=o(64467),a=o(5544),n=o(65043),i=o(98139),l=o.n(i),d=o(62149),c=o(25055);function u(e){var t=e.className,o=e.direction,a=e.index,i=e.marginDirection,l=e.children,d=e.split,c=e.wrap,u=n.useContext(v),p=u.horizontalSize,m=u.verticalSize,h=u.latestIndex,x={};return u.supportFlexGap||("vertical"===o?a<h&&(x={marginBottom:p/(d?2:1)}):x=(0,r.A)((0,r.A)({},a<h&&(0,s.A)({},i,p/(d?2:1))),c&&{paddingBottom:m})),null===l||void 0===l?null:n.createElement(n.Fragment,null,n.createElement("div",{className:t,style:x},l),a<h&&d&&n.createElement("span",{className:"".concat(t,"-split"),style:x},d))}var p=o(46058),m=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(o[r[s]]=e[r[s]])}return o},v=n.createContext({latestIndex:0,horizontalSize:0,verticalSize:0,supportFlexGap:!1}),h={small:8,middle:16,large:24};const x=function(e){var t,o=n.useContext(c.QO),i=o.getPrefixCls,x=o.space,S=o.direction,y=e.size,f=void 0===y?(null===x||void 0===x?void 0:x.size)||"small":y,g=e.align,A=e.className,j=e.children,w=e.direction,I=void 0===w?"horizontal":w,k=e.prefixCls,C=e.split,b=e.style,O=e.wrap,R=void 0!==O&&O,N=m(e,["size","align","className","children","direction","prefixCls","split","style","wrap"]),z=(0,p.A)(),E=n.useMemo((function(){return(Array.isArray(f)?f:[f,f]).map((function(e){return function(e){return"string"===typeof e?h[e]:e||0}(e)}))}),[f]),P=(0,a.A)(E,2),D=P[0],T=P[1],M=(0,d.A)(j,{keepEmpty:!0}),q=void 0===g&&"horizontal"===I?"center":g,G=i("space",k),F=l()(G,"".concat(G,"-").concat(I),(t={},(0,s.A)(t,"".concat(G,"-rtl"),"rtl"===S),(0,s.A)(t,"".concat(G,"-align-").concat(q),q),t),A),U="".concat(G,"-item"),Y="rtl"===S?"marginLeft":"marginRight",B=0,Q=M.map((function(e,t){return null!==e&&void 0!==e&&(B=t),n.createElement(u,{className:U,key:"".concat(U,"-").concat(t),direction:I,index:t,marginDirection:Y,split:C,wrap:R},e)})),_=n.useMemo((function(){return{horizontalSize:D,verticalSize:T,latestIndex:B,supportFlexGap:z}}),[D,T,B,z]);if(0===M.length)return null;var J={};return R&&(J.flexWrap="wrap",z||(J.marginBottom=-T)),z&&(J.columnGap=D,J.rowGap=T),n.createElement("div",(0,r.A)({className:F,style:(0,r.A)((0,r.A)({},J),b)},N),n.createElement(v.Provider,{value:_},Q))}}}]);
//# sourceMappingURL=212.97267576.chunk.js.map