"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[2151],{23415:(e,t,o)=>{o.d(t,{A:()=>s});o(14556);var n=o(91688),l=o(70579);const s=()=>{var e;const t=null===(e=localStorage)||void 0===e?void 0:e.getItem("user");return console.log(t,"loggin"),t?null:(0,l.jsx)(n.Redirect,{to:"/pages/authentication/login"})}},42151:(e,t,o)=>{o.r(t),o.d(t,{default:()=>O});var n=o(65043),l=o(91688),s=o(62058),r=o(16854),a=o.n(r),i=o(44411),d=(o(15627),o(60521)),c=o(64435),u=o(89421),m=o(83557),p=o(21261),v=o(47419),h=o(11645),g=o(94376),j=o(70610),x=o(78186),y=o(26412),f=o(40854),A=o.n(f),I=o(22285),C=(o(14556),o(92823),o(25884),o(23415)),S=o(7313),b=o(70579);const N=e=>{let{percentage:t}=e,o="#ff0000";return t>75?o="#1890ff":t>50&&(o="#fadb14"),(0,b.jsx)(v.A,{justify:"center",align:"middle",style:{width:180},children:(0,b.jsx)(S.A,{percent:t,steps:5,strokeColor:o})})},{Title:D,Text:w}=i.A,k="..//..//..//assets/images/logo/novacon.png";function O(){var e;const[t,o]=(0,n.useState)(""),[r,i]=(0,n.useState)(""),f=(0,n.useRef)(null),[S,O]=(0,n.useState)(!1),[R,E]=(0,n.useState)(!1),[T,M]=(0,n.useState)(!1),[P,z]=(0,n.useState)(!1),[J,F]=(0,n.useState)(!1),[q,L]=(0,n.useState)(),[U,Q]=(0,n.useState)(""),[_,B]=(0,n.useState)(""),[H,K]=(0,n.useState)(""),[Y,G]=(0,n.useState)(""),[V,W]=(0,n.useState)(""),[X,Z]=(0,n.useState)([]),[$,ee]=(0,n.useState)(""),[te,oe]=(0,n.useState)([]),[ne,le]=(0,n.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[se,re]=(0,n.useState)([]),[ae,ie]=(0,n.useState)([]),[de,ce]=(0,n.useState)([]),[ue,me]=(0,n.useState)([]),[pe,ve]=(0,n.useState)([]),[he,ge]=(0,n.useState)([]),[je,xe]=(0,n.useState)([]),[ye,fe]=(0,n.useState)([]),[Ae,Ie]=(0,n.useState)(!1),[Ce,Se]=(0,n.useState)([]),[be,Ne]=(0,n.useState)([]),[De,we]=(0,n.useState)([]),[ke,Oe]=(0,n.useState)([]),[Re,Ee]=(0,n.useState)([]),[Te,Me]=(0,n.useState)(),[Pe,ze]=(0,n.useState)(),[Je,Fe]=(0,n.useState)(),qe=(0,l.useLocation)(),{matchingRecord:Le}=qe.state||{},Ue=(e,t,n)=>{t(),o(e[0]),i(n)},Qe=e=>({filterDropdown:t=>{let{setSelectedKeys:n,selectedKeys:l,confirm:r,clearFilters:a,close:i}=t;return(0,b.jsxs)("div",{style:{padding:8},children:[(0,b.jsx)(d.A,{ref:f,placeholder:"Search ".concat(e),value:l[0],onChange:e=>n(e.target.value?[e.target.value]:[]),onPressEnter:()=>Ue(l,r,e),style:{marginBottom:8,display:"block"}}),(0,b.jsxs)(c.A,{children:[(0,b.jsx)(u.A,{type:"primary",onClick:()=>Ue(l,r,e),icon:(0,b.jsx)(s.A,{}),size:"small",style:{width:90},children:"Search"}),(0,b.jsx)(u.A,{onClick:()=>a&&(e=>{e(),o("")})(a),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,b.jsx)(s.A,{style:{color:e?"#1677ff":void 0}}),onFilter:(t,o)=>o[e].toString().toLowerCase().includes(t.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.select()}),100)},render:o=>r===e?(0,b.jsx)(a(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[t],autoEscape:!0,textToHighlight:o?o.toString():""}):o}),_e=(m.A,m.A.Item,m.A.Item,m.A.Item,JSON.stringify(be),(0,l.useHistory)()),Be=()=>{Q(""),B(""),K(""),O(!1)};const He=async e=>{Ge(e)},Ke=(e,t)=>{const o=((e,t)=>{const o=[];return o.push("Image,".concat(t)),e.forEach((e=>{const t=Object.keys(e)[0],n=e[t];o.push("Key,".concat(t));const l=Object.keys(n[0]);o.push('"'.concat(l.join('","'),'"')),n.forEach((e=>{const t=l.map((t=>{const o=e[t];return Array.isArray(o)?'"'.concat(o.join(","),'"'):'"'.concat(o,'"')}));o.push(t.join(","))})),o.push("")})),o.join("\n")})(e,t);return'\n    <!DOCTYPE html>\n    <html lang="en">\n    <head>\n      <meta charset="UTF-8">\n      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n      <title>CSV Export</title>\n    </head>\n    <body>\n      <img src="'.concat(t,'" alt="Logo">\n      <h1>CSV Data</h1>\n      <pre>').concat(o,"</pre>\n    </body>\n    </html>\n  ")},Ye=async(e,t)=>{await Ge(e);const o=await(async e=>{try{const t=await fetch(e),o=await t.blob();return new Promise(((e,t)=>{const n=new FileReader;n.readAsDataURL(o),n.onloadend=()=>{const t=n.result.split(",")[1];e(t)},n.onerror=e=>{t(e)}}))}catch(t){return console.error("Error fetching or converting image:",t),null}})(t);if(pe.length>0){const e=Ke(pe,o),t=new Blob([e],{type:"text/html"}),n=window.URL.createObjectURL(t),l=document.createElement("a");l.href=n,l.setAttribute("download","MDR ".concat(pe[0].masterDocumentId,".html")),document.body.appendChild(l),l.click(),document.body.removeChild(l)}},Ge=async e=>{try{const t=await A().get("http://54.81.250.98:8083/api/documents?masterDocumentId=".concat(e.mdrCode,"&projectId=").concat(e.projectId,"&companyId=").concat(e.companyId),{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}});console.log("response",t.data);const o=t.data.map((e=>{const{version:t,companyId:o,departmentId:n,projectId:l,masterDocumentId:s,masterDocumentName:r,content:a,extension:i,fileName:d,...c}=e;return c})),n={};o.forEach((e=>{const t=e.title.split("-")[2];n[t]||(n[t]=[]),n[t].push(e)}));const l=Object.keys(n).map((e=>({[e]:n[e]})));ve(l)}catch(t){console.error("Error fetching documents:",null===t||void 0===t?void 0:t.message)}};(0,n.useEffect)((()=>{}),[pe]);const Ve=async()=>{try{var e,t,o,n;const s=await A().get("http://54.81.250.98:8083/api/documents/mdr?companyId=".concat(null===ne||void 0===ne||null===(e=ne.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}});if(console.log(s.data,"response aya"),Fe(s.data.projectCode),3===(null===ne||void 0===ne||null===(t=ne.user)||void 0===t?void 0:t.roleId)||4===(null===ne||void 0===ne||null===(o=ne.user)||void 0===o?void 0:o.roleId)){const e=s.data.filter((e=>{var t;return e.authorId===(null===ne||void 0===ne||null===(t=ne.user)||void 0===t?void 0:t.id)}));re(e),ie(e)}else if(2===(null===ne||void 0===ne||null===(n=ne.user)||void 0===n?void 0:n.roleId)){var l;console.log(null===ne||void 0===ne||null===(l=ne.user)||void 0===l?void 0:l.departmentId,"departmentId");const e=s.data.filter((e=>{var t,o;return e.departmentId.split(",").includes(null===ne||void 0===ne||null===(t=ne.user)||void 0===t?void 0:t.departmentId)||e.authorId===(null===ne||void 0===ne||null===(o=ne.user)||void 0===o?void 0:o.id)}));console.log("dataaaaaa",e);const t=e.map((e=>e.projectId));Z(t),re(e),ie(e)}else re(s.data),ie(s.data)}catch(s){console.error("Error fetching documents:",null===s||void 0===s?void 0:s.message)}};return(0,n.useEffect)((()=>{var e;le(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),(async()=>{try{var e;const t=await A().get("http://54.81.250.98:8083/api/departments?companyId=".concat(null===ne||void 0===ne||null===(e=ne.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}}),o=[],n=[];for(const e of null===t||void 0===t?void 0:t.data)o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title}),n.push({value:null===e||void 0===e?void 0:e.suffix,label:null===e||void 0===e?void 0:e.title});Se(o),Ne(n)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const t=await A().get("http://54.81.250.98:8083/api/projects?companyId=".concat(null===ne||void 0===ne||null===(e=ne.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}}),o=new Set,n=null===t||void 0===t?void 0:t.data.reduce(((e,t)=>(o.has(t.title)||(o.add(t.title),e.push({value:t.id,label:t.title,code:t.code})),e)),[]);console.log(t.data),oe(n),console.log(te)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const o=await A().get("http://54.81.250.98:8083/api/users?companyId=".concat(null===ne||void 0===ne||null===(e=ne.user)||void 0===e?void 0:e.companyId,"&roleId=2"),{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}});fe(o.data),console.log(null===o||void 0===o?void 0:o.data,"Users");const n=[],l=[];for(const e of null===o||void 0===o?void 0:o.data){var t="Engineer";1==e.roleId&&(t="CEO",n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName,departmentId:null===e||void 0===e?void 0:e.departmentId,department:e.department},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),2==e.roleId&&(t="HEAD of ".concat(e.department),n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")}),l.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),3==e.roleId&&(t="Senior Engineer ".concat(e.department),n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")}),l.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),4==e.roleId&&(t="Junior"),5==e.roleId&&(t="Designer/Draughtsmen")}const s=n.filter((e=>1!==e.roleId));Oe(s),we(n),Ee(l)}catch(o){console.error("Error fetching departments:",null===o||void 0===o?void 0:o.message)}})(),Ve(),console.log(se)}),[]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.A,{title:"Upload Document",width:400,centered:!0,visible:S,onCancel:Be,footer:null,closeIcon:(0,b.jsx)(I.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,b.jsx)(v.A,{justify:"space-between",align:"center",children:(0,b.jsx)(h.A,{span:20,children:(0,b.jsxs)(g.A,{layout:"vertical",name:"basic",children:[(0,b.jsx)(g.A.Item,{label:"MDR Title",name:"docTitle",rules:[{required:!0,message:"Please input your title"}],children:(0,b.jsx)(d.A,{value:U,onChange:e=>Q(e.target.value)})}),(0,b.jsx)(g.A.Item,{label:"MDR Code",name:"docCode",rules:[{required:!0,message:"Please input your code"}],children:(0,b.jsx)(d.A,{value:U,onChange:e=>G(e.target.value)})}),(0,b.jsxs)(g.A.Item,{label:"Project Name",name:"projectName",rules:[{required:!0,message:"Please select Project Name"}],children:[(0,b.jsx)(j.A,{options:te,value:_,onChange:e=>B(e)}),"              "]}),(0,b.jsx)(g.A.Item,{label:"Add Reviewers",name:"reviewers",rules:[{required:!0,message:"Please select Reviewers Name"}],children:(0,b.jsx)(x.A.Group,{options:De,value:ue,onChange:me})})," ",(0,b.jsx)(g.A.Item,{label:"Add Approvers",name:"approvers",rules:[{required:!0,message:"Please select Approvers Name"}],children:(0,b.jsx)(x.A.Group,{options:De,value:je,onChange:xe})}),(0,b.jsx)(v.A,{children:(0,b.jsx)(h.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,b.jsx)(u.A,{block:!0,onClick:Te?()=>{const e=te.find((e=>(null===e||void 0===e?void 0:e.value)==_)),t=JSON.stringify(Ce),o=JSON.stringify(be),n=JSON.stringify(Te),l=JSON.stringify(te),s=JSON.stringify(je),r=JSON.stringify(ue);_e.push("/pages/initialMDR?projectCode=".concat(e.code,"&mdrCode=").concat(Y,"\n      &departmentOption=").concat(o,"&departmentOptions=").concat(t,"\n      &projectOptions=").concat(l,"&projectId=").concat(_,"&projectCode=").concat(Je,"\n      &departmentId=").concat(de,"&title=").concat(U,"&approver=").concat(s,"\n      &reviewer=").concat(r,"&record=").concat(n))}:()=>{const e=te.find((e=>(null===e||void 0===e?void 0:e.value)==_)),t=JSON.stringify(Ce),o=JSON.stringify(be),n=JSON.stringify(te),l=JSON.stringify(je),s=JSON.stringify(ue);_e.push("/pages/initialMDR?projectCode=".concat(e.code,"&mdrCode=").concat(Y,"\n    &departmentOption=").concat(o,"&departmentOptions=").concat(t,"\n    &projectOptions=").concat(n,"&projectId=").concat(_,"&projectCode=").concat(Je,"\n    &departmentId=").concat(de,"&title=").concat(U,"&approver=").concat(l,"&reviewer=").concat(s))},type:"primary",htmlType:"submit",children:"MDR template"})})})]})})})}),(0,b.jsx)(p.A,{title:"Assign Document",width:400,centered:!0,visible:R,onCancel:()=>{E(!1)},footer:null,closeIcon:(0,b.jsx)(I.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,b.jsx)(v.A,{justify:"space-between",align:"center",children:(0,b.jsx)(h.A,{span:20,children:(0,b.jsxs)(g.A,{layout:"vertical",name:"basic",children:[(0,b.jsx)(g.A.Item,{label:"Project Name",name:"projectName",rules:[{required:!0,message:"Please select Project Name"}],children:(0,b.jsx)(j.A,{options:te,value:_,onChange:e=>B(e)})}),(0,b.jsx)(g.A.Item,{label:"Assigned MDR to",name:"assignMDR",rules:[{required:!0,message:"Please Assign MDR"}],children:(0,b.jsx)(j.A,{options:Re,value:he,onChange:e=>ge(e)})}),(0,b.jsx)(v.A,{children:(0,b.jsx)(h.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,b.jsx)(u.A,{block:!0,onClick:()=>(async(e,t)=>{try{const o=t.find((t=>t.id==e)),n=te.find((e=>(null===e||void 0===e?void 0:e.value)==_));Ce.find((e=>(null===e||void 0===e?void 0:e.value)==H)),await A().post("http://54.81.250.98:8083/api/documents/mdr",{departmentId:o.departmentId,projectId:_,companyId:null===o||void 0===o?void 0:o.companyId,authorId:null===o||void 0===o?void 0:o.id,authorName:null===o||void 0===o?void 0:o.firstName,mdrCode:Y,projectCode:null===n||void 0===n?void 0:n.code,departmentName:o.department,status:"Assigned",noOfDocuments:0},{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}}),E(!1),Ve()}catch(o){console.error("Error assigning documents:",o)}})(he,ye),type:"primary",htmlType:"submit",children:"Assigned"})})}),(0,b.jsx)(v.A,{})]})})})}),(0,b.jsx)(p.A,{title:"MDR Information",width:400,centered:!0,visible:J,onCancel:()=>{F(!1)},footer:null,closeIcon:(0,b.jsx)(I.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:Pe?(0,b.jsxs)("div",{style:{textAlign:"center"},children:[(0,b.jsxs)("div",{style:{textAlign:"left"},children:[(0,b.jsxs)(D,{level:3,children:["Title: ",Pe.title||null]}),(0,b.jsx)("br",{}),(0,b.jsx)(w,{strong:!0,children:"Author Name: "}),(0,b.jsx)(w,{children:Pe.authorName||null}),(0,b.jsx)("br",{}),(0,b.jsx)(w,{strong:!0,children:"Department ID: "}),(0,b.jsx)(w,{children:Pe.departmentId||null}),(0,b.jsx)("br",{}),(0,b.jsx)(w,{strong:!0,children:"Project Code: "}),(0,b.jsx)(w,{children:Pe.projectCode||null}),(0,b.jsx)("br",{}),(0,b.jsx)(w,{strong:!0,children:"MDR Code: "}),(0,b.jsx)(w,{children:Pe.mdrCode||null}),(0,b.jsx)("br",{}),(0,b.jsx)(w,{strong:!0,children:"No of Documents: "}),(0,b.jsx)(w,{children:Pe.noOfDocuments||null}),(0,b.jsx)("br",{}),(0,b.jsx)(w,{strong:!0,children:"Percentage: "}),(0,b.jsx)(w,{children:Pe.percentage||null}),(0,b.jsx)("br",{}),(0,b.jsx)(w,{strong:!0,children:"Status: "}),(0,b.jsx)(w,{children:Pe.status}),(0,b.jsx)("br",{}),(0,b.jsx)(w,{strong:!0,children:"Created At: "}),(0,b.jsx)(w,{children:Pe.createdAt}),(0,b.jsx)("br",{}),(0,b.jsx)("br",{})]}),(0,b.jsx)(u.A,{type:"primary",style:{marginTop:"16px"},onClick:async()=>{try{console.log(Pe,"recordMdr")}catch(e){}},children:"Add More Documents"})]}):null}),(0,b.jsx)(p.A,{title:"Show MDR Documents ",width:400,centered:!0,visible:P,onCancel:()=>{z(!1)},footer:null,closeIcon:(0,b.jsx)(I.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,b.jsx)(v.A,{justify:"space-between",align:"center",children:(0,b.jsx)(h.A,{span:20,children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{children:"MDR Documents"}),(0,b.jsx)("ul",{children:pe.map(((e,t)=>(0,b.jsx)("li",{children:Object.entries(e).map((e=>{let[t,o]=e;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("strong",{children:[t,":"]}),(0,b.jsx)("ul",{children:o.map(((e,t)=>(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Document Title:"})," ",e.docTitle," ",(0,b.jsx)("br",{})]},t)))})]},t)}))},t)))}),"        "]})})})}),(0,b.jsxs)("div",{style:{textAlign:"right",marginBottom:"16px"},children:[1==(null===ne||void 0===ne?void 0:ne.user.roleId)&&(0,b.jsx)(u.A,{type:"primary",onClick:()=>{O(!0)},style:{marginRight:"10px"},children:"Create MDR Yourself"}),1==(null===ne||void 0===ne?void 0:ne.user.roleId)&&(0,b.jsx)(u.A,{type:"primary",onClick:()=>{E(!0)},children:"Assign MDR"}),Ae&&(0,b.jsx)(MdrTemplate,{})]}),(0,b.jsx)("div",{style:{overflowX:"auto"},children:(0,b.jsx)(y.A,{columns:[{title:"Document Title",dataIndex:"title",key:"title",...Qe("title")},{title:"Project Code",dataIndex:"projectCode",key:"projectCode",...Qe("projectCode")},{title:"Dept Name",dataIndex:"departmentName",key:"departmentName",...Qe("departmentName")},{title:"Author Name",dataIndex:"authorName",key:"authorName",...Qe("authorName")},{title:"No of Documents",dataIndex:"noOfDocuments",key:"noOfDocuments",sorter:(e,t)=>e.noOfDocuments-t.noOfDocuments},{title:"Status",key:"status",dataIndex:"status",filters:[{text:"Initialized",value:"Initialized"},{text:"Ongoing",value:"Ongoing"},{text:"Completed",value:"Completed"}],onFilter:(e,t)=>t.status===e},{title:"Action",key:"action",render:(e,t)=>{var o;return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(c.A,{size:"middle",children:[(0,b.jsx)(u.A,{onClick:()=>Ye(t,k),disabled:1!=(null===ne||void 0===ne||null===(o=ne.user)||void 0===o?void 0:o.roleId),children:"Export"},null===t||void 0===t?void 0:t.id),1!==ne.user.roleId&&t.authorId===(null===ne||void 0===ne?void 0:ne.user.id)&&"Assigned"==t.status&&(0,b.jsx)(u.A,{onClick:()=>(e=>{console.log("record",e),Me(e),O(!0)})(t),children:"Create"},null===t||void 0===t?void 0:t.id),1==ne.user.roleId&&(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(u.A,{onClick:()=>{(e=>{console.log("record",e),Me(e),He(e),z(!0)})(t)},children:"Open"},null===t||void 0===t?void 0:t.id)})]})})}},{title:"Progress Per Document",key:"percentage",render:(e,t)=>(0,b.jsx)(c.A,{children:null!==t.percentage?(0,b.jsx)(N,{percentage:t.percentage.toFixed(1)}):null})}],size:"middle",bordered:!0,title:()=>"All Department Documents",footer:()=>"You may filter MDR",dataSource:se,rowClassName:e=>Le&&e.id===Le.selectedRecord.id?"highlighted-row":""})}),(0,b.jsx)(C.A,{})]})}}}]);
//# sourceMappingURL=2151.2ac3c741.chunk.js.map