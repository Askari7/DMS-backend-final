"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[2151],{23415:(e,t,o)=>{o.d(t,{A:()=>s});o(14556);var n=o(91688),l=o(70579);const s=()=>{var e;const t=null===(e=localStorage)||void 0===e?void 0:e.getItem("user");return console.log(t,"loggin"),t?null:(0,l.jsx)(n.Redirect,{to:"/pages/authentication/login"})}},42151:(e,t,o)=>{o.r(t),o.d(t,{default:()=>w});var n=o(65043),l=o(91688),s=o(62058),r=o(16854),a=o.n(r),i=o(44411),d=(o(15627),o(60521)),c=o(64435),u=o(89421),m=o(83557),v=o(21261),p=o(47419),h=o(11645),j=o(94376),g=o(70610),x=o(78186),y=o(26412),f=o(40854),A=o.n(f),I=o(22285),S=(o(14556),o(92823),o(25884),o(23415)),C=o(7313),b=o(70579);const N=e=>{let{percentage:t}=e,o="#ff0000";return t>75?o="#1890ff":t>50&&(o="#fadb14"),(0,b.jsx)(p.A,{justify:"center",align:"middle",style:{width:180},children:(0,b.jsx)(C.A,{percent:t,steps:5,strokeColor:o})})},{Title:D,Text:k}=i.A;function w(){var e;const[t,o]=(0,n.useState)(""),[r,i]=(0,n.useState)(""),f=(0,n.useRef)(null),[C,w]=(0,n.useState)(!1),[O,R]=(0,n.useState)(!1),[T,E]=(0,n.useState)(!1),[M,P]=(0,n.useState)(!1),[z,J]=(0,n.useState)(!1),[F,q]=(0,n.useState)(),[L,Q]=(0,n.useState)(""),[U,_]=(0,n.useState)(""),[B,H]=(0,n.useState)(""),[K,G]=(0,n.useState)(""),[Y,W]=(0,n.useState)(""),[X,V]=(0,n.useState)([]),[Z,$]=(0,n.useState)(""),[ee,te]=(0,n.useState)([]),[oe,ne]=(0,n.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[le,se]=(0,n.useState)([]),[re,ae]=(0,n.useState)([]),[ie,de]=(0,n.useState)([]),[ce,ue]=(0,n.useState)([]),[me,ve]=(0,n.useState)([]),[pe,he]=(0,n.useState)([]),[je,ge]=(0,n.useState)([]),[xe,ye]=(0,n.useState)([]),[fe,Ae]=(0,n.useState)(!1),[Ie,Se]=(0,n.useState)([]),[Ce,be]=(0,n.useState)([]),[Ne,De]=(0,n.useState)([]),[ke,we]=(0,n.useState)([]),[Oe,Re]=(0,n.useState)([]),[Te,Ee]=(0,n.useState)(),[Me,Pe]=(0,n.useState)(),[ze,Je]=(0,n.useState)(),Fe=(0,l.useLocation)(),{matchingRecord:qe}=Fe.state||{},Le=(e,t,n)=>{t(),o(e[0]),i(n)},Qe=e=>({filterDropdown:t=>{let{setSelectedKeys:n,selectedKeys:l,confirm:r,clearFilters:a,close:i}=t;return(0,b.jsxs)("div",{style:{padding:8},children:[(0,b.jsx)(d.A,{ref:f,placeholder:"Search ".concat(e),value:l[0],onChange:e=>n(e.target.value?[e.target.value]:[]),onPressEnter:()=>Le(l,r,e),style:{marginBottom:8,display:"block"}}),(0,b.jsxs)(c.A,{children:[(0,b.jsx)(u.A,{type:"primary",onClick:()=>Le(l,r,e),icon:(0,b.jsx)(s.A,{}),size:"small",style:{width:90},children:"Search"}),(0,b.jsx)(u.A,{onClick:()=>a&&(e=>{e(),o("")})(a),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,b.jsx)(s.A,{style:{color:e?"#1677ff":void 0}}),onFilter:(t,o)=>o[e].toString().toLowerCase().includes(t.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.select()}),100)},render:o=>r===e?(0,b.jsx)(a(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[t],autoEscape:!0,textToHighlight:o?o.toString():""}):o}),Ue=(m.A,m.A.Item,m.A.Item,m.A.Item,JSON.stringify(Ce),(0,l.useHistory)()),_e=()=>{Q(""),_(""),H(""),w(!1)};const Be=async e=>{Ke(e)},He=async e=>{if(await Ke(e),me.length>0){const e=(e=>{const t=[];return e.forEach((e=>{const o=Object.keys(e)[0],n=e[o];t.push("Key,".concat(o));const l=Object.keys(n[0]);t.push('"'.concat(l.join('","'),'"')),n.forEach((e=>{const o=l.map((t=>{const o=e[t];return Array.isArray(o)?'"'.concat(o.join(","),'"'):'"'.concat(o,'"')}));t.push(o.join(","))})),t.push("")})),t.join("\n")})(me),t=new Blob([e],{type:"text/csv"}),o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.setAttribute("download","MDR ".concat(me[0].masterDocumentId,".csv")),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},Ke=async e=>{try{const t=await A().get("http://54.81.250.98:8083/api/documents?masterDocumentId=".concat(e.mdrCode,"&projectId=").concat(e.projectId,"&companyId=").concat(e.companyId),{headers:{Authorization:null===oe||void 0===oe?void 0:oe.accessToken}});console.log("response",t.data);const o=t.data.map((e=>{const{version:t,companyId:o,departmentId:n,projectId:l,masterDocumentId:s,masterDocumentName:r,content:a,extension:i,fileName:d,...c}=e;return c})),n={};o.forEach((e=>{const t=e.title.split("-")[2];n[t]||(n[t]=[]),n[t].push(e)}));const l=Object.keys(n).map((e=>({[e]:n[e]})));ve(l)}catch(t){console.error("Error fetching documents:",null===t||void 0===t?void 0:t.message)}};(0,n.useEffect)((()=>{}),[me]);const Ge=async()=>{try{var e,t,o,n;const s=await A().get("http://54.81.250.98:8083/api/documents/mdr?companyId=".concat(null===oe||void 0===oe||null===(e=oe.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===oe||void 0===oe?void 0:oe.accessToken}});if(console.log(s.data,"response aya"),Je(s.data.projectCode),3===(null===oe||void 0===oe||null===(t=oe.user)||void 0===t?void 0:t.roleId)||4===(null===oe||void 0===oe||null===(o=oe.user)||void 0===o?void 0:o.roleId)){const e=s.data.filter((e=>{var t;return e.authorId===(null===oe||void 0===oe||null===(t=oe.user)||void 0===t?void 0:t.id)}));se(e),ae(e)}else if(2===(null===oe||void 0===oe||null===(n=oe.user)||void 0===n?void 0:n.roleId)){var l;console.log(null===oe||void 0===oe||null===(l=oe.user)||void 0===l?void 0:l.departmentId,"departmentId");const e=s.data.filter((e=>{var t,o;return e.departmentId.split(",").includes(null===oe||void 0===oe||null===(t=oe.user)||void 0===t?void 0:t.departmentId)||e.authorId===(null===oe||void 0===oe||null===(o=oe.user)||void 0===o?void 0:o.id)}));console.log("dataaaaaa",e);const t=e.map((e=>e.projectId));V(t),se(e),ae(e)}else se(s.data),ae(s.data)}catch(s){console.error("Error fetching documents:",null===s||void 0===s?void 0:s.message)}};return(0,n.useEffect)((()=>{var e;ne(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),(async()=>{try{var e;const t=await A().get("http://54.81.250.98:8083/api/departments?companyId=".concat(null===oe||void 0===oe||null===(e=oe.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===oe||void 0===oe?void 0:oe.accessToken}}),o=[],n=[];for(const e of null===t||void 0===t?void 0:t.data)o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title}),n.push({value:null===e||void 0===e?void 0:e.suffix,label:null===e||void 0===e?void 0:e.title});Se(o),be(n)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const t=await A().get("http://54.81.250.98:8083/api/projects?companyId=".concat(null===oe||void 0===oe||null===(e=oe.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===oe||void 0===oe?void 0:oe.accessToken}}),o=new Set,n=null===t||void 0===t?void 0:t.data.reduce(((e,t)=>(o.has(t.title)||(o.add(t.title),e.push({value:t.id,label:t.title,code:t.code})),e)),[]);console.log(t.data),te(n),console.log(ee)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const o=await A().get("http://54.81.250.98:8083/api/users?companyId=".concat(null===oe||void 0===oe||null===(e=oe.user)||void 0===e?void 0:e.companyId,"&roleId=2"),{headers:{Authorization:null===oe||void 0===oe?void 0:oe.accessToken}});ye(o.data),console.log(null===o||void 0===o?void 0:o.data,"Users");const n=[],l=[];for(const e of null===o||void 0===o?void 0:o.data){var t="Engineer";1==e.roleId&&(t="CEO",n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName,departmentId:null===e||void 0===e?void 0:e.departmentId,department:e.department},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),2==e.roleId&&(t="HEAD of ".concat(e.department),n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")}),l.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),3==e.roleId&&(t="Senior Engineer ".concat(e.department),n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")}),l.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),4==e.roleId&&(t="Junior"),5==e.roleId&&(t="Designer/Draughtsmen")}const s=n.filter((e=>1!==e.roleId));we(s),De(n),Re(l)}catch(o){console.error("Error fetching departments:",null===o||void 0===o?void 0:o.message)}})(),Ge(),console.log(le)}),[]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.A,{title:"Upload Document",width:400,centered:!0,visible:C,onCancel:_e,footer:null,closeIcon:(0,b.jsx)(I.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,b.jsx)(p.A,{justify:"space-between",align:"center",children:(0,b.jsx)(h.A,{span:20,children:(0,b.jsxs)(j.A,{layout:"vertical",name:"basic",children:[(0,b.jsx)(j.A.Item,{label:"MDR Title",name:"docTitle",rules:[{required:!0,message:"Please input your title"}],children:(0,b.jsx)(d.A,{value:L,onChange:e=>Q(e.target.value)})}),(0,b.jsx)(j.A.Item,{label:"MDR Code",name:"docCode",rules:[{required:!0,message:"Please input your code"}],children:(0,b.jsx)(d.A,{value:L,onChange:e=>G(e.target.value)})}),(0,b.jsxs)(j.A.Item,{label:"Project Name",name:"projectName",rules:[{required:!0,message:"Please select Project Name"}],children:[(0,b.jsx)(g.A,{options:ee,value:U,onChange:e=>_(e)}),"              "]}),(0,b.jsx)(j.A.Item,{label:"Add Reviewers",name:"reviewers",rules:[{required:!0,message:"Please select Reviewers Name"}],children:(0,b.jsx)(x.A.Group,{options:Ne,value:ce,onChange:ue})})," ",(0,b.jsx)(j.A.Item,{label:"Add Approvers",name:"approvers",rules:[{required:!0,message:"Please select Approvers Name"}],children:(0,b.jsx)(x.A.Group,{options:Ne,value:je,onChange:ge})}),(0,b.jsx)(p.A,{children:(0,b.jsx)(h.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,b.jsx)(u.A,{block:!0,onClick:Te?()=>{const e=ee.find((e=>(null===e||void 0===e?void 0:e.value)==U)),t=JSON.stringify(Ie),o=JSON.stringify(Ce),n=JSON.stringify(Te),l=JSON.stringify(ee),s=JSON.stringify(je),r=JSON.stringify(ce);Ue.push("/pages/initialMDR?projectCode=".concat(e.code,"&mdrCode=").concat(K,"\n      &departmentOption=").concat(o,"&departmentOptions=").concat(t,"\n      &projectOptions=").concat(l,"&projectId=").concat(U,"&projectCode=").concat(ze,"\n      &departmentId=").concat(ie,"&title=").concat(L,"&approver=").concat(s,"\n      &reviewer=").concat(r,"&record=").concat(n))}:()=>{const e=ee.find((e=>(null===e||void 0===e?void 0:e.value)==U)),t=JSON.stringify(Ie),o=JSON.stringify(Ce),n=JSON.stringify(ee),l=JSON.stringify(je),s=JSON.stringify(ce);Ue.push("/pages/initialMDR?projectCode=".concat(e.code,"&mdrCode=").concat(K,"\n    &departmentOption=").concat(o,"&departmentOptions=").concat(t,"\n    &projectOptions=").concat(n,"&projectId=").concat(U,"&projectCode=").concat(ze,"\n    &departmentId=").concat(ie,"&title=").concat(L,"&approver=").concat(l,"&reviewer=").concat(s))},type:"primary",htmlType:"submit",children:"MDR template"})})})]})})})}),(0,b.jsx)(v.A,{title:"Assign Document",width:400,centered:!0,visible:O,onCancel:()=>{R(!1)},footer:null,closeIcon:(0,b.jsx)(I.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,b.jsx)(p.A,{justify:"space-between",align:"center",children:(0,b.jsx)(h.A,{span:20,children:(0,b.jsxs)(j.A,{layout:"vertical",name:"basic",children:[(0,b.jsx)(j.A.Item,{label:"Project Name",name:"projectName",rules:[{required:!0,message:"Please select Project Name"}],children:(0,b.jsx)(g.A,{options:ee,value:U,onChange:e=>_(e)})}),(0,b.jsx)(j.A.Item,{label:"Assigned MDR to",name:"assignMDR",rules:[{required:!0,message:"Please Assign MDR"}],children:(0,b.jsx)(g.A,{options:Oe,value:pe,onChange:e=>he(e)})}),(0,b.jsx)(p.A,{children:(0,b.jsx)(h.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,b.jsx)(u.A,{block:!0,onClick:()=>(async(e,t)=>{try{const o=t.find((t=>t.id==e)),n=ee.find((e=>(null===e||void 0===e?void 0:e.value)==U));Ie.find((e=>(null===e||void 0===e?void 0:e.value)==B)),await A().post("http://54.81.250.98:8083/api/documents/mdr",{departmentId:o.departmentId,projectId:U,companyId:null===o||void 0===o?void 0:o.companyId,authorId:null===o||void 0===o?void 0:o.id,authorName:null===o||void 0===o?void 0:o.firstName,mdrCode:K,projectCode:null===n||void 0===n?void 0:n.code,departmentName:o.department,status:"Assigned",noOfDocuments:0},{headers:{Authorization:null===oe||void 0===oe?void 0:oe.accessToken}}),R(!1),Ge()}catch(o){console.error("Error assigning documents:",o)}})(pe,xe),type:"primary",htmlType:"submit",children:"Assigned"})})}),(0,b.jsx)(p.A,{})]})})})}),(0,b.jsx)(v.A,{title:"MDR Information",width:400,centered:!0,visible:z,onCancel:()=>{J(!1)},footer:null,closeIcon:(0,b.jsx)(I.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:Me?(0,b.jsxs)("div",{style:{textAlign:"center"},children:[(0,b.jsxs)("div",{style:{textAlign:"left"},children:[(0,b.jsxs)(D,{level:3,children:["Title: ",Me.title||null]}),(0,b.jsx)("br",{}),(0,b.jsx)(k,{strong:!0,children:"Author Name: "}),(0,b.jsx)(k,{children:Me.authorName||null}),(0,b.jsx)("br",{}),(0,b.jsx)(k,{strong:!0,children:"Department ID: "}),(0,b.jsx)(k,{children:Me.departmentId||null}),(0,b.jsx)("br",{}),(0,b.jsx)(k,{strong:!0,children:"Project Code: "}),(0,b.jsx)(k,{children:Me.projectCode||null}),(0,b.jsx)("br",{}),(0,b.jsx)(k,{strong:!0,children:"MDR Code: "}),(0,b.jsx)(k,{children:Me.mdrCode||null}),(0,b.jsx)("br",{}),(0,b.jsx)(k,{strong:!0,children:"No of Documents: "}),(0,b.jsx)(k,{children:Me.noOfDocuments||null}),(0,b.jsx)("br",{}),(0,b.jsx)(k,{strong:!0,children:"Percentage: "}),(0,b.jsx)(k,{children:Me.percentage||null}),(0,b.jsx)("br",{}),(0,b.jsx)(k,{strong:!0,children:"Status: "}),(0,b.jsx)(k,{children:Me.status}),(0,b.jsx)("br",{}),(0,b.jsx)(k,{strong:!0,children:"Created At: "}),(0,b.jsx)(k,{children:Me.createdAt}),(0,b.jsx)("br",{}),(0,b.jsx)("br",{})]}),(0,b.jsx)(u.A,{type:"primary",style:{marginTop:"16px"},onClick:async()=>{try{console.log(Me,"recordMdr")}catch(e){}},children:"Add More Documents"})]}):null}),(0,b.jsx)(v.A,{title:"Show MDR Documents ",width:400,centered:!0,visible:M,onCancel:()=>{P(!1)},footer:null,closeIcon:(0,b.jsx)(I.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,b.jsx)(p.A,{justify:"space-between",align:"center",children:(0,b.jsx)(h.A,{span:20,children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{children:"MDR Documents"}),(0,b.jsx)("ul",{children:me.map(((e,t)=>(0,b.jsx)("li",{children:Object.entries(e).map((e=>{let[t,o]=e;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("strong",{children:[t,":"]}),(0,b.jsx)("ul",{children:o.map(((e,t)=>(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Document Title:"})," ",e.docTitle," ",(0,b.jsx)("br",{})]},t)))})]},t)}))},t)))}),"        "]})})})}),(0,b.jsxs)("div",{style:{textAlign:"right",marginBottom:"16px"},children:[1==(null===oe||void 0===oe?void 0:oe.user.roleId)&&(0,b.jsx)(u.A,{type:"primary",onClick:()=>{w(!0)},style:{marginRight:"10px"},children:"Create MDR Yourself"}),1==(null===oe||void 0===oe?void 0:oe.user.roleId)&&(0,b.jsx)(u.A,{type:"primary",onClick:()=>{R(!0)},children:"Assign MDR"}),fe&&(0,b.jsx)(MdrTemplate,{})]}),(0,b.jsx)("div",{style:{overflowX:"auto"},children:(0,b.jsx)(y.A,{columns:[{title:"Document Title",dataIndex:"title",key:"title",...Qe("title")},{title:"Project Code",dataIndex:"projectCode",key:"projectCode",...Qe("projectCode")},{title:"Dept Name",dataIndex:"departmentName",key:"departmentName",...Qe("departmentName")},{title:"Author Name",dataIndex:"authorName",key:"authorName",...Qe("authorName")},{title:"No of Documents",dataIndex:"noOfDocuments",key:"noOfDocuments",sorter:(e,t)=>e.noOfDocuments-t.noOfDocuments},{title:"Status",key:"status",dataIndex:"status",filters:[{text:"Initialized",value:"Initialized"},{text:"Ongoing",value:"Ongoing"},{text:"Completed",value:"Completed"}],onFilter:(e,t)=>t.status===e},{title:"Action",key:"action",render:(e,t)=>{var o;return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(c.A,{size:"middle",children:[(0,b.jsx)(u.A,{onClick:()=>He(t),disabled:1!=(null===oe||void 0===oe||null===(o=oe.user)||void 0===o?void 0:o.roleId),children:"Export"},null===t||void 0===t?void 0:t.id),1!==oe.user.roleId&&t.authorId===(null===oe||void 0===oe?void 0:oe.user.id)&&"Assigned"==t.status&&(0,b.jsx)(u.A,{onClick:()=>(e=>{console.log("record",e),Ee(e),w(!0)})(t),children:"Create"},null===t||void 0===t?void 0:t.id),1==oe.user.roleId&&(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(u.A,{onClick:()=>{(e=>{console.log("record",e),Ee(e),Be(e),P(!0)})(t)},children:"Open"},null===t||void 0===t?void 0:t.id)})]})})}},{title:"Progress Per Document",key:"percentage",render:(e,t)=>(0,b.jsx)(c.A,{children:null!==t.percentage?(0,b.jsx)(N,{percentage:t.percentage.toFixed(1)}):null})}],size:"middle",bordered:!0,title:()=>"All Department Documents",footer:()=>"You may filter MDR",dataSource:le,rowClassName:e=>qe&&e.id===qe.selectedRecord.id?"highlighted-row":""})}),(0,b.jsx)(S.A,{})]})}}}]);
//# sourceMappingURL=2151.3c74a8b7.chunk.js.map