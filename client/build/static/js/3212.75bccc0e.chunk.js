"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[3212],{33212:(e,o,t)=>{t.r(o),t.d(o,{default:()=>j});var s=t(65043),a=t(60521),r=t(64435),l=t(89421),i=t(15627),n=t(21261),d=t(47419),c=t(11645),u=t(94376),p=t(70610),v=t(26412),m=t(22285),h=t(40854),y=t.n(h),g=t(78186),x=t(62058),f=t(16854),A=t.n(f),S=t(70579);function j(){var e,o;const[t,h]=(0,s.useState)(""),[f,j]=(0,s.useState)(""),w=(0,s.useRef)(null),I=(e,o,t)=>{o(),h(e[0]),j(t)},k=e=>({filterDropdown:o=>{let{setSelectedKeys:t,selectedKeys:s,confirm:i,clearFilters:n,close:d}=o;return(0,S.jsxs)("div",{style:{padding:8},children:[(0,S.jsx)(a.A,{ref:w,placeholder:"Search ".concat(e),value:s[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>I(s,i,e),style:{marginBottom:8,display:"block"}}),(0,S.jsxs)(r.A,{children:[(0,S.jsx)(l.A,{type:"primary",onClick:()=>I(s,i,e),icon:(0,S.jsx)(x.A,{}),size:"small",style:{width:90},children:"Search"}),(0,S.jsx)(l.A,{onClick:()=>n&&(e=>{e(),h("")})(n),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,S.jsx)(x.A,{style:{color:e?"#1677ff":void 0}}),onFilter:(o,t)=>t[e].toString().toLowerCase().includes(o.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.select()}),100)},render:o=>f===e?(0,S.jsx)(A(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[t],autoEscape:!0,textToHighlight:o?o.toString():""}):o}),C="http://54.81.250.98:8083",b=[{title:"Document Name",dataIndex:"docName",key:"docName",...k("docName")},{title:"MDR Code",dataIndex:"masterDocumentCode",key:"masterDocumentCode",...k("masterDocumentCode")},{title:"Approver",dataIndex:"approver",key:"approver",...k("approver")},{title:"Reviewer",dataIndex:"reviewer",key:"reviewer",...k("reviewer")},{title:"Your Role",dataIndex:"yourRole",key:"yourRole"},{title:"Your Status",dataIndex:"yourStatus",key:"yourStatus"},{title:"Overall Approver Status",dataIndex:"approverStatuss",key:"approverStatuss"},{title:"Overall Reviewer Status",dataIndex:"reviewerStatuss",key:"reviewerStatuss"},{title:"Creator",dataIndex:"allowCreate",key:"allowCreate"},{title:"Action",key:"action",render:(e,o)=>(0,S.jsxs)(r.A,{size:"middle",children:[(0,S.jsx)("a",{onClick:()=>Je(o),children:"Open"}),(0,S.jsx)("a",{onClick:()=>Pe(o),children:"Add Status"}),(0,S.jsx)("a",{onClick:()=>ze(o),children:"Send to Client"})]})}],[R,N]=(0,s.useState)(""),[O,D]=(0,s.useState)(""),[P,E]=(0,s.useState)(null),[z,T]=(0,s.useState)(!1),[q,M]=(0,s.useState)(!1),[U,F]=(0,s.useState)([]),[J,_]=(0,s.useState)(),[Q,Y]=(0,s.useState)(!1),[B,K]=(0,s.useState)([]),[L,G]=(0,s.useState)([]),[H,V]=(0,s.useState)(""),[W,X]=(0,s.useState)(""),[Z,$]=(0,s.useState)(!1),[ee,oe]=(0,s.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[te,se]=(0,s.useState)([]),[ae,re]=(0,s.useState)([]),[le,ie]=(0,s.useState)([]),[ne,de]=(0,s.useState)([]),[ce,ue]=(0,s.useState)([]),[pe,ve]=(0,s.useState)([]),[me,he]=(0,s.useState)([]),[ye,ge]=(0,s.useState)(),[xe,fe]=(0,s.useState)(),[Ae,Se]=(0,s.useState)([]),[je,we]=(0,s.useState)([]),[Ie,ke]=(0,s.useState)([]),[Ce,be]=(0,s.useState)([]),[Re,Ne]=(0,s.useState)(!1),[Oe,De]=(0,s.useState)(""),Pe=e=>{E(e),T(!0)},Ee=()=>{N(""),T(!1)},ze=e=>{console.log(e,"record");const o=JSON.stringify(e);console.log(o,"record"),_(o),Ue(),M(!0)},Te=()=>{M(!1)},[qe,Me]=(0,s.useState)(""),Ue=async()=>{try{var e;console.log(J,"coddd");const o=await y().get("http://54.81.250.98:8083/api/clients?companyId=".concat(null===ee||void 0===ee||null===(e=ee.user)||void 0===e?void 0:e.companyId,"&recordId=").concat(J),{headers:{Authorization:null===ee||void 0===ee?void 0:ee.accessToken}});console.log(o.data,"received");const t=o.data.map((e=>({value:e.Email,label:e.Email})));console.log("clients",t),re(t)}catch(o){console.error("Error fetching clients:",null===o||void 0===o?void 0:o.message)}},Fe=async e=>{try{var o;const t=await y().get("http://54.81.250.98:8083/api/documents/establishment?companyId=".concat(null===ee||void 0===ee||null===(o=ee.user)||void 0===o?void 0:o.companyId,"&userId=").concat(ee.user.id,"&docName=").concat(e),{headers:{Authorization:null===ee||void 0===ee?void 0:ee.accessToken}});return console.log(t.data,"received"),t.data}catch(t){console.error("Error fetching documents:",null===t||void 0===t?void 0:t.message)}},Je=async e=>{const o=await Fe(e.docName);console.log("helllooo",o);const t=e.docName,s="".concat(C,"/uploads/").concat(t,"-").concat(e.version,".pdf");console.log(ee.user.roleId,ee.user.firstName,ee);let a="false";o&&(a="true"),window.location.href="http://54.81.250.98:3001/react-pdf-highlighter/?docName=".concat(t,".pdf&url=").concat(s,"&allowed=").concat(a,"&user=").concat(ee.user.roleId," ").concat(ee.user.firstName)},_e=()=>{X(""),Y(!1)},Qe=async()=>{try{var e,o;const t=await y().get("http://54.81.250.98:8083/api/documents/establishment?companyId=".concat(null===ee||void 0===ee||null===(e=ee.user)||void 0===e?void 0:e.companyId,"&userId=").concat(null===ee||void 0===ee||null===(o=ee.user)||void 0===o?void 0:o.id),{headers:{Authorization:null===ee||void 0===ee?void 0:ee.accessToken}});console.log("response",t.data);const s=[],a=[],r=[],l=[];for(let e of t.data){console.log(e,"response.data",e.id);const o=e.approverStatus.split(",").map((e=>parseInt(e.trim(),10))),t=e.reviewerStatus.split(",").map((e=>parseInt(e.trim(),10))),i=e.reviewerId.split(",").map((e=>parseInt(e.trim(),10))),n=e.approverId.split(",").map((e=>parseInt(e.trim(),10))),d=e.approverComment.split(","),c=e.reviewerComment.split(",");s.push({id:e.id,status:o,comment:d}),a.push({id:e.id,status:t,comment:c}),r.push({id:e.id,status:i}),l.push({id:e.id,status:n}),be(r),ke(l),he(a),ve(s),e.approverId.includes(ee.user.id)&&e.reviewerId.includes(ee.user.id)?(e.yourRole="Approver and Reviewer",console.log(o[n.indexOf(ee.user.id)],"App Rev dono ha"),1==o[n.indexOf(ee.user.id)]?e.yourStatus="Rejected":2==o[n.indexOf(ee.user.id)]?e.yourStatus="Accepted":0==o[n.indexOf(ee.user.id)]&&(e.yourStatus="Pending")):n.includes(ee.user.id)?(console.log(n.includes(ee.user.id),"approver ha"),e.yourRole="Approver",De(n.indexOf(ee.user.id)),console.log(n.indexOf(ee.user.id),"jjjjj"),console.log(n,ee.user.id,o[n.indexOf(ee.user.id)],"ssss"+typeof o),1==o[n.indexOf(ee.user.id)]?e.yourStatus="Rejected":2==o[n.indexOf(ee.user.id)]?e.yourStatus="Accepted":0==o[n.indexOf(ee.user.id)]&&(e.yourStatus="Pending")):i.includes(ee.user.id)&&(console.log(i.includes(ee.user.id),"reviewer ha"),e.yourRole="Reviewer",De(i.indexOf(ee.user.id)),console.log(i.indexOf(ee.user.id),"jjjjj"),console.log(i,ee.user.id,t[i.indexOf(ee.user.id)],"ssss"+typeof t),1==t[i.indexOf(ee.user.id)]?e.yourStatus="Rejected":2==t[i.indexOf(ee.user.id)]?e.yourStatus="Accepted":0==t[i.indexOf(ee.user.id)]&&(e.yourStatus="Pending")),o.every((e=>0===e))?e.approverStatuss="Pending":o.some((e=>0!==e&&2!==e))?e.approverStatuss="Rejected":o.every((e=>2===e))?e.approverStatuss="Sent to Client":e.approverStatuss="Pending",t.every((e=>0===e))?e.reviewerStatuss="Pending":t.every((e=>1===e))?e.reviewerStatuss="Rejected":t.every((e=>2===e))?e.reviewerStatuss="Sent for Approval":e.reviewerStatuss="Pending"}console.log(s,a,r,l,"arrays hain ye "),se(t.data)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}},Ye=async e=>{console.log(e,"record dekhS");const o=e.id,t=Ce.find((e=>e.id===o)),s=Ie.find((e=>e.id===o)),a=t.status,r=s.status;console.log(a,r,"ids");const l=me.find((e=>e.id===o)),i=pe.find((e=>e.id===o)),n=l.status,d=i.status,c=l.comment,u=i.comment;if(console.log(d,n,"obj"),"Approver and Reviewer"===e.yourRole&&"Accept"===R)d[r.indexOf(ee.user.id)]=2,n[a.indexOf(ee.user.id)]=2;else if("Approver and Reviewer"===e.yourRole&&"Reject"===R){d[r.indexOf(ee.user.id)]=1,n[a.indexOf(ee.user.id)]=1;const e=r.indexOf(ee.user.id),o=r.indexOf(ee.user.id);u[e]=O,c[o]=O}else if("Approver"===e.yourRole&&"Accept"===R)d[r.indexOf(ee.user.id)]=2;else if("Reviewer"===e.yourRole&&"Accept"===R)n[a.indexOf(ee.user.id)]=2;else if("Approver"===e.yourRole&&"Reject"===R){d[r.indexOf(ee.user.id)]=1;u[r.indexOf(ee.user.id)]=O}else if("Reviewer"===e.yourRole&&"Reject"===R){n[a.indexOf(ee.user.id)]=1;c[r.indexOf(ee.user.id)]=O}console.log(n,"changed Rev"),console.log(d,"changed App"),fe(n),ge(d);try{if(O){await y().put("http://54.81.250.98:8083/api/documents/establishment",{revStatusArr:n.join(","),appStatusArr:d.join(","),reviewerComment:c.join(","),approverComment:u.join(","),docName:e.docName},{headers:{Authorization:null===ee||void 0===ee?void 0:ee.accessToken}})}else{await y().put("http://54.81.250.98:8083/api/documents/establishment",{revStatusArr:n.join(","),appStatusArr:d.join(","),docName:e.docName},{headers:{Authorization:null===ee||void 0===ee?void 0:ee.accessToken}})}N(""),await Qe()}catch(p){console.error(p)}};return(0,s.useEffect)((async()=>{var e;oe(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),await Qe(),(async()=>{try{var e;const o=await y().get("http://54.81.250.98:8083/api/users?companyId=".concat(null===ee||void 0===ee||null===(e=ee.user)||void 0===e?void 0:e.companyId,"&roleId=2"),{headers:{Authorization:null===ee||void 0===ee?void 0:ee.accessToken}});console.log(null===o||void 0===o?void 0:o.data,"UUUAUA");const t=[];for(const e of null===o||void 0===o?void 0:o.data)t.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(null===e||void 0===e?void 0:e.lastName)});G(t)}catch(o){console.error("Error fetching departments:",null===o||void 0===o?void 0:o.message)}})(),(async()=>{try{var e;const o=await y().get("http://54.81.250.98:8083/api/documents/mdr?companyId=".concat(null===ee||void 0===ee||null===(e=ee.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===ee||void 0===ee?void 0:ee.accessToken}}),t=[];for(const e of null===o||void 0===o?void 0:o.data)t.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title,DocumentPermissionId:null===e||void 0===e?void 0:e.DocumentPermissionId,departmentId:null===e||void 0===e?void 0:e.departmentId});K(t)}catch(o){console.error("Error fetching departments:",null===o||void 0===o?void 0:o.message)}})()}),[]),(0,s.useEffect)((async()=>{await Ue()}),[J]),(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(n.A,{title:"Change Status",width:400,centered:!0,visible:z,onCancel:Ee,footer:null,closeIcon:(0,S.jsx)(m.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,S.jsx)(d.A,{justify:"space-between",align:"center",children:(0,S.jsx)(c.A,{span:20,children:(0,S.jsxs)(u.A,{layout:"vertical",name:"basic",children:[(0,S.jsx)(u.A.Item,{label:"Select Status",name:"selectedStatus",rules:[{required:!0,message:"Please select a status"}],children:(0,S.jsx)(p.A,{options:[{label:"Accept",value:"Accept"},{label:"Reject",value:"Reject"}],value:R,onChange:e=>{return N(o=e),void Ne("Reject"===o);var o}})}),Re&&(0,S.jsx)(u.A.Item,{label:"Remarks",name:"remarks",rules:[{required:!0,message:"Please provide remarks for rejection"}],children:(0,S.jsx)(a.A.TextArea,{rows:4,placeholder:"Enter remarks for rejection",value:O,onChange:e=>D(e.target.value)})}),(0,S.jsxs)(d.A,{children:[(0,S.jsx)(c.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,S.jsx)(l.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async e=>{console.log("rejection",O),console.log(e,"status bhi aya"),P&&(console.log(P,"document"),console.log(e,"status"),console.log(Ce,Ie,me,pe,"ye bhi dekh"),await Ye(P),Ee())})(R),children:"Submit"})}),(0,S.jsx)(c.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,S.jsx)(l.A,{block:!0,onClick:Ee,children:"Cancel"})})]})]})})})}),(0,S.jsx)(n.A,{title:"Send To Client",width:400,centered:!0,visible:q,onCancel:Te,footer:null,closeIcon:(0,S.jsx)(m.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,S.jsx)(d.A,{justify:"space-between",align:"center",children:(0,S.jsx)(c.A,{span:20,children:(0,S.jsxs)(u.A,{layout:"vertical",name:"basic",children:[(0,S.jsx)(u.A.Item,{label:"Select Emails",name:"selectedEmails",rules:[{required:!0,message:"Please select a Email"}],children:(0,S.jsx)(p.A,{options:ae,value:U,onChange:e=>F(e)})}),(0,S.jsxs)(d.A,{children:[(0,S.jsx)(c.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,S.jsx)(l.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{const e=JSON.parse(J);console.log("Record:",e.docName);const o=await Fe(e.docName);console.log("helllooo",o);const t=e.docName,s="".concat(C,"/uploads/").concat(t,"-").concat(e.version,".pdf");console.log(ee.user.roleId,ee.user.firstName,ee);let a="false";o&&(a="true");const r="http://54.81.250.98:3001/react-pdf-highlighter/?docName=".concat(t,".pdf&url=").concat(s,"&allowed=").concat(a,"&user=").concat(ee.user.roleId," ").concat(ee.user.firstName);try{var l,n;const e=await y().post("http://54.81.250.98:8083/api/clients/send-email-client",{roleId:ee.user.roleId,companyId:null===ee||void 0===ee||null===(l=ee.user)||void 0===l?void 0:l.companyId,url:r,clientName:U},{headers:{Authorization:null===ee||void 0===ee?void 0:ee.accessToken}});console.log(e),i.Ay.success(null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)}catch(d){console.error("Error Sending Email:",null===d||void 0===d?void 0:d.message)}})(),children:"Send"})}),(0,S.jsx)(c.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,S.jsx)(l.A,{block:!0,onClick:Te,children:"Cancel"})})]})]})})})}),(0,S.jsx)(n.A,{title:"Create Permissions",width:416,centered:!0,visible:Q,onCancel:_e,footer:null,closeIcon:(0,S.jsx)(m.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,S.jsxs)(u.A,{layout:"vertical",name:"basic",children:[(0,S.jsx)(u.A.Item,{label:"MDR",name:"mdr",rules:[{required:!0,message:"Please select MDR"}],children:(0,S.jsx)(p.A,{options:B,value:W,onChange:e=>X(e)})}),(0,S.jsx)(u.A.Item,{label:"Users",name:"users",rules:[{required:!0,message:"Please select MDR"}],children:(0,S.jsx)(p.A,{options:L,value:H,onChange:e=>V(e)})}),(0,S.jsx)(u.A.Item,{label:"Permissions",name:"permissions",children:(0,S.jsx)(g.A.Group,{options:[{label:"Reviewer",value:"Reviewer"},{label:"Approver",value:"Approver"},{label:"Creator",value:"Creator"}],defaultValue:0,onChange:e=>{console.log("checked = ",e),de(e)}})}),(0,S.jsxs)(d.A,{children:[(0,S.jsx)(c.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,S.jsx)(l.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{try{var e,o;const t=await y().post("http://54.81.250.98:8083/api/documents/permissions",{masterDocumentId:W,userId:H,companyId:null===ee||void 0===ee||null===(e=ee.user)||void 0===e?void 0:e.companyId,createDocument:null===ne||void 0===ne?void 0:ne.includes("Creator"),reviewDocument:null===ne||void 0===ne?void 0:ne.includes("Reviewer"),approveDocument:null===ne||void 0===ne?void 0:ne.includes("Approver")},{headers:{Authorization:null===ee||void 0===ee?void 0:ee.accessToken}});console.log(t),i.Ay.success(null===t||void 0===t||null===(o=t.data)||void 0===o?void 0:o.message),X(""),V(""),de([]),await Qe(),Y(!1)}catch(t){"Request failed with status code 403"==(null===t||void 0===t?void 0:t.message)&&i.Ay.error("Permission Denied to create document on this MDR")}})(),children:"Add"})}),(0,S.jsx)(c.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,S.jsx)(l.A,{block:!0,onClick:_e,children:"Cancel"})})]})]})}),(0,S.jsx)("div",{style:{textAlign:"right",marginBottom:"16px"},children:(0,S.jsx)(l.A,{type:"primary",onClick:()=>{Y(!0)},disabled:1!=(null===ee||void 0===ee||null===(o=ee.user)||void 0===o?void 0:o.roleId),children:"Add Permissions"})}),(0,S.jsx)("div",{style:{overflowX:"auto"},children:(0,S.jsx)(v.A,{columns:b,dataSource:te,bordered:!0,size:"middle",title:()=>"All Documents Assessments",footer:()=>"You may filter Documents"})})]})}}}]);
//# sourceMappingURL=3212.75bccc0e.chunk.js.map