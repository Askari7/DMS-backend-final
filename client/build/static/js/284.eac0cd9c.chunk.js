"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[284],{97284:(e,t,o)=>{o.r(t),o.d(t,{default:()=>x});var a=o(69060),r=o(84196),s=o(26701),n=o(39322),i=o(57156),l=o(29512),c=o(38088),d=o(80336),u=o(74421),p=o(19056),v=o(38112),m=o(26536),h=o.n(m),S=o(48004),y=o(82496);function x(){var e,t;const o=[{title:"Document Name",dataIndex:"docName",key:"docName"},{title:"MDR Code",dataIndex:"masterDocumentCode",key:"masterDocumentCode"},{title:"Approver",dataIndex:"approver",key:"approver"},{title:"Reviewer",dataIndex:"reviewer",key:"reviewer"},{title:"Your Role",dataIndex:"yourRole",key:"yourRole"},{title:"Your Status",dataIndex:"yourStatus",key:"yourStatus"},{title:"Overall Approver Status",dataIndex:"approverStatuss",key:"approverStatuss"},{title:"Overall Reviewer Status",dataIndex:"reviewerStatuss",key:"reviewerStatuss"},{title:"Creator",dataIndex:"allowCreate",key:"allowCreate"},{title:"Action",key:"action",render:(e,t)=>(0,y.jsxs)(r.c,{size:"middle",children:[(0,y.jsx)("a",{onClick:()=>se(t),children:"Open"}),(0,y.jsx)("a",{onClick:()=>te(t),children:"Add Status"})]})}],[m,x]=(0,a.useState)(""),[g,f]=(0,a.useState)(null),[I,j]=(0,a.useState)(!1),[w,b]=(0,a.useState)(!1),[k,C]=(0,a.useState)([]),[R,A]=(0,a.useState)([]),[N,O]=(0,a.useState)(""),[z,P]=(0,a.useState)(""),[D,E]=(0,a.useState)(!1),[M,T]=(0,a.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[G,U]=(0,a.useState)([]),[F,Y]=(0,a.useState)([]),[q,B]=(0,a.useState)([]),[_,J]=(0,a.useState)([]),[$,L]=(0,a.useState)([]),[V,W]=(0,a.useState)([]),[X,H]=(0,a.useState)([]),[K,Q]=(0,a.useState)([]),[Z,ee]=(0,a.useState)(""),te=e=>{f(e),j(!0)},oe=()=>{x(""),j(!1)},[ae,re]=(0,a.useState)(""),se=async e=>{const t=await(async e=>{try{var t;const o=await h().get("http://54.81.250.98:8083/api/documents/establishment?companyId=".concat(null===M||void 0===M||null===(t=M.user)||void 0===t?void 0:t.companyId,"&userId=").concat(M.user.id,"&docName=").concat(e),{headers:{Authorization:null===M||void 0===M?void 0:M.accessToken}});return console.log(o.data,"received"),o.data}catch(o){console.error("Error fetching documents:",null===o||void 0===o?void 0:o.message)}})(e.docName);console.log("helllooo",t);const o=e.docName,a="".concat("http://54.81.250.98:8083","/documents/").concat(o,"-").concat(e.version,".pdf");console.log(M.user.roleId,M.user.firstName,M);let r="false";t&&(r="true"),window.location.href="http://54.81.250.98:3001/react-pdf-highlighter/?docName=".concat(o,".pdf&url=").concat(a,"&allowed=").concat(r,"&user=").concat(M.user.roleId," ").concat(M.user.firstName)},ne=()=>{P(""),b(!1)},ie=async()=>{try{var e,t;const o=await h().get("http://54.81.250.98:8083/api/documents/establishment?companyId=".concat(null===M||void 0===M||null===(e=M.user)||void 0===e?void 0:e.companyId,"&userId=").concat(null===M||void 0===M||null===(t=M.user)||void 0===t?void 0:t.id),{headers:{Authorization:null===M||void 0===M?void 0:M.accessToken}});console.log("response",o.data);for(let e of o.data){const t=e.approverStatus.split(",").map((e=>parseInt(e.trim(),10))),o=e.reviewerStatus.split(",").map((e=>parseInt(e.trim(),10))),a=e.reviewerId.split(",").map((e=>parseInt(e.trim(),10))),r=e.approverId.split(",").map((e=>parseInt(e.trim(),10)));Q(e.reviewerId.split(",").map((e=>parseInt(e.trim(),10)))),H(e.approverId.split(",").map((e=>parseInt(e.trim(),10)))),W(e.reviewerStatus.split(",").map((e=>parseInt(e.trim(),10)))),L(e.approverStatus.split(",").map((e=>parseInt(e.trim(),10)))),console.log(V,$,"hii"),e.approverId.includes(M.user.id)&&e.reviewerId.includes(M.user.id)?(console.log("YESSSSSSSSSSS"),e.yourRole="Approver and Reviewer"):r.includes(M.user.id)?(console.log("YESSSSSSSSSSS"),e.yourRole="Approver",ee(r.indexOf(M.user.id))):a.includes(M.user.id)&&(console.log("YESSSSSSSSSSS"),e.yourRole="Reviewer",ee(a.indexOf(M.user.id)),console.log(a.indexOf(M.user.id),"jjjjj"),console.log(a,M.user.id,o[a.indexOf(M.user.id)],"ssss"+typeof o),1==o[a.indexOf(M.user.id)]?e.yourStatus="Rejected":2==o[a.indexOf(M.user.id)]?e.yourStatus="Accepted":0==o[a.indexOf(M.user.id)]&&(e.yourStatus="Pending")),t.every((e=>0===e))?e.approverStatuss="Pending":t.some((e=>0!==e&&2!==e))?e.approverStatuss="Rejected":t.every((e=>2===e))&&(e.approverStatuss="Sent to Client"),o.every((e=>0===e))?e.reviewerStatuss="Pending":o.every((e=>1===e))?e.reviewerStatuss="Rejected":o.every((e=>2===e))?e.reviewerStatuss="Sent for Approval":e.reviewerStatuss="Pending"}U(o.data)}catch(o){console.error("Error fetching departments:",null===o||void 0===o?void 0:o.message)}},le=async e=>{try{console.log(V,$,"hohohoho");let t=[...V],o=[...$];"Approver"===e.yourRole&&"Accept"===m?(1,o[X.indexOf(M.user.id)]=2,L(o)):"Reviewer"===e.yourRole&&"Accept"===m?(0,t[K.indexOf(M.user.id)]=2,W(t)):"Approver"===e.yourRole&&"Reject"===m?(1,o[X.indexOf(M.user.id)]=1,L(o)):"Reviewer"===e.yourRole&&"Reject"===m&&(0,t[K.indexOf(M.user.id)]=1,W(t)),console.log(e.yourRole,m,t.join(","),o.join(","));const a=await h().put("http://54.81.250.98:8083/api/documents/establishment",{status:m,revStatusArr:t.join(","),appStatusArr:o.join(","),docName:e.docName},{headers:{Authorization:null===M||void 0===M?void 0:M.accessToken}});console.log(a.data),await ie()}catch(t){console.error("Error assigning documents:",t)}};return(0,a.useEffect)((async()=>{var e;T(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),await ie(),(async()=>{try{var e;const t=await h().get("http://54.81.250.98:8083/api/users?companyId=".concat(null===M||void 0===M||null===(e=M.user)||void 0===e?void 0:e.companyId,"&roleId=2"),{headers:{Authorization:null===M||void 0===M?void 0:M.accessToken}});console.log(null===t||void 0===t?void 0:t.data,"UUUAUA");const o=[];for(const e of null===t||void 0===t?void 0:t.data)o.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(null===e||void 0===e?void 0:e.lastName)});A(o)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const t=await h().get("http://54.81.250.98:8083/api/documents/mdr?companyId=".concat(null===M||void 0===M||null===(e=M.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===M||void 0===M?void 0:M.accessToken}}),o=[];for(const e of null===t||void 0===t?void 0:t.data)o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title,DocumentPermissionId:null===e||void 0===e?void 0:e.DocumentPermissionId,departmentId:null===e||void 0===e?void 0:e.departmentId});C(o)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})()}),[]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(n.c,{title:"Change Status",width:400,centered:!0,visible:I,onCancel:oe,footer:null,closeIcon:(0,y.jsx)(v.M5$,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(i.c,{justify:"space-between",align:"center",children:(0,y.jsx)(l.c,{span:20,children:(0,y.jsxs)(c.c,{layout:"vertical",name:"basic",children:[(0,y.jsx)(c.c.Item,{label:"Select Status",name:"selectedStatus",rules:[{required:!0,message:"Please select a status"}],children:(0,y.jsx)(d.default,{options:[{label:"Accept",value:"Accept"},{label:"Reject",value:"Reject"}],value:m,onChange:e=>x(e)})}),(0,y.jsxs)(i.c,{children:[(0,y.jsx)(l.c,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(u.c,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{if(g){const e={...g,status:m},t=G.map((t=>t.id===g.id?e:t));J(t),await le(g),oe()}})(),children:"Submit"})}),(0,y.jsx)(l.c,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,y.jsx)(u.c,{block:!0,onClick:oe,children:"Cancel"})})]})]})})})}),(0,y.jsx)(n.c,{title:"Create Permissions",width:416,centered:!0,visible:w,onCancel:ne,footer:null,closeIcon:(0,y.jsx)(v.M5$,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsxs)(c.c,{layout:"vertical",name:"basic",children:[(0,y.jsx)(c.c.Item,{label:"MDR",name:"mdr",rules:[{required:!0,message:"Please select MDR"}],children:(0,y.jsx)(d.default,{options:k,value:z,onChange:e=>P(e)})}),(0,y.jsx)(c.c.Item,{label:"Users",name:"users",rules:[{required:!0,message:"Please select MDR"}],children:(0,y.jsx)(d.default,{options:R,value:N,onChange:e=>O(e)})}),(0,y.jsx)(c.c.Item,{label:"Permissions",name:"permissions",children:(0,y.jsx)(S.c.Group,{options:[{label:"Reviewer",value:"Reviewer"},{label:"Approver",value:"Approver"},{label:"Creator",value:"Creator"}],defaultValue:0,onChange:e=>{console.log("checked = ",e),B(e)}})}),(0,y.jsxs)(i.c,{children:[(0,y.jsx)(l.c,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(u.c,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{try{var e,t;const o=await h().post("http://54.81.250.98:8083/api/documents/permissions",{masterDocumentId:z,userId:N,companyId:null===M||void 0===M||null===(e=M.user)||void 0===e?void 0:e.companyId,createDocument:null===q||void 0===q?void 0:q.includes("Creator"),reviewDocument:null===q||void 0===q?void 0:q.includes("Reviewer"),approveDocument:null===q||void 0===q?void 0:q.includes("Approver")},{headers:{Authorization:null===M||void 0===M?void 0:M.accessToken}});console.log(o),s.cp.success(null===o||void 0===o||null===(t=o.data)||void 0===t?void 0:t.message),P(""),O(""),B([]),await ie(),b(!1)}catch(o){"Request failed with status code 403"==(null===o||void 0===o?void 0:o.message)&&s.cp.error("Permission Denied to create document on this MDR")}})(),children:"Add"})}),(0,y.jsx)(l.c,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,y.jsx)(u.c,{block:!0,onClick:ne,children:"Cancel"})})]})]})}),(0,y.jsx)("div",{style:{textAlign:"right",marginBottom:"16px"},children:(0,y.jsx)(u.c,{type:"primary",onClick:()=>{b(!0)},disabled:1!=(null===M||void 0===M||null===(t=M.user)||void 0===t?void 0:t.roleId),children:"Add Permissions"})}),(0,y.jsx)("div",{style:{overflowX:"auto"},children:(0,y.jsx)(p.c,{columns:o,dataSource:G})})]})}},84196:(e,t,o)=>{o.d(t,{U:()=>m,c:()=>S});var a=o(45072),r=o(52536),s=o(32920),n=o(69060),i=o(264),l=o.n(i),c=o(6776),d=o(33832);function u(e){var t=e.className,o=e.direction,s=e.index,i=e.marginDirection,l=e.children,c=e.split,d=e.wrap,u=n.useContext(m),p=u.horizontalSize,v=u.verticalSize,h=u.latestIndex,S={};return u.supportFlexGap||("vertical"===o?s<h&&(S={marginBottom:p/(c?2:1)}):S=(0,a.c)((0,a.c)({},s<h&&(0,r.c)({},i,p/(c?2:1))),d&&{paddingBottom:v})),null===l||void 0===l?null:n.createElement(n.Fragment,null,n.createElement("div",{className:t,style:S},l),s<h&&c&&n.createElement("span",{className:"".concat(t,"-split"),style:S},c))}var p=o(38304),v=function(e,t){var o={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(o[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(o[a[r]]=e[a[r]])}return o},m=n.createContext({latestIndex:0,horizontalSize:0,verticalSize:0,supportFlexGap:!1}),h={small:8,middle:16,large:24};const S=function(e){var t,o=n.useContext(d.MT),i=o.getPrefixCls,S=o.space,y=o.direction,x=e.size,g=void 0===x?(null===S||void 0===S?void 0:S.size)||"small":x,f=e.align,I=e.className,j=e.children,w=e.direction,b=void 0===w?"horizontal":w,k=e.prefixCls,C=e.split,R=e.style,A=e.wrap,N=void 0!==A&&A,O=v(e,["size","align","className","children","direction","prefixCls","split","style","wrap"]),z=(0,p.c)(),P=n.useMemo((function(){return(Array.isArray(g)?g:[g,g]).map((function(e){return function(e){return"string"===typeof e?h[e]:e||0}(e)}))}),[g]),D=(0,s.c)(P,2),E=D[0],M=D[1],T=(0,c.c)(j,{keepEmpty:!0}),G=void 0===f&&"horizontal"===b?"center":f,U=i("space",k),F=l()(U,"".concat(U,"-").concat(b),(t={},(0,r.c)(t,"".concat(U,"-rtl"),"rtl"===y),(0,r.c)(t,"".concat(U,"-align-").concat(G),G),t),I),Y="".concat(U,"-item"),q="rtl"===y?"marginLeft":"marginRight",B=0,_=T.map((function(e,t){return null!==e&&void 0!==e&&(B=t),n.createElement(u,{className:Y,key:"".concat(Y,"-").concat(t),direction:b,index:t,marginDirection:q,split:C,wrap:N},e)})),J=n.useMemo((function(){return{horizontalSize:E,verticalSize:M,latestIndex:B,supportFlexGap:z}}),[E,M,B,z]);if(0===T.length)return null;var $={};return N&&($.flexWrap="wrap",z||($.marginBottom=-M)),z&&($.columnGap=E,$.rowGap=M),n.createElement("div",(0,a.c)({className:F,style:(0,a.c)((0,a.c)({},$),R)},O),n.createElement(m.Provider,{value:J},_))}}}]);
//# sourceMappingURL=284.eac0cd9c.chunk.js.map