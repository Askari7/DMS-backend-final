"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[4692],{23415:(e,t,a)=>{a.d(t,{A:()=>s});a(14556);var l=a(91688),n=a(70579);const s=()=>{var e;const t=null===(e=localStorage)||void 0===e?void 0:e.getItem("user");return console.log(t,"loggin"),t?null:(0,n.jsx)(l.Redirect,{to:"/pages/authentication/login"})}},54692:(e,t,a)=>{a.r(t),a.d(t,{default:()=>w});var l=a(65043),n=a(60521),s=a(64435),o=a(89421),d=a(83557),i=a(15627),r=a(21261),c=a(94376),u=a(70610),m=a(78186),p=a(79170),v=a(47419),h=a(11645),g=a(26412),j=a(22285),x=a(40854),y=a.n(x),A=a(91688),I=a(23415),f=a(62058),S=a(16854),C=a.n(S),D=a(7313),k=a(70579);const b=e=>{let{percentage:t}=e;return console.log("Percentage:",t),(0,k.jsx)(v.A,{justify:"center",align:"middle",style:{width:180},children:(0,k.jsx)(D.A,{percent:t,size:"small"})})};function w(){var e,t;const[a,x]=(0,l.useState)(""),[S,D]=(0,l.useState)(""),w=(0,l.useRef)(null),[P,z]=(0,l.useState)(),[E,T]=(0,l.useState)([]),[O,F]=(0,l.useState)(""),[R,q]=(0,l.useState)(!1),[B,L]=(0,l.useState)(!1),[_,G]=(0,l.useState)(""),[H,J]=(0,l.useState)(""),[K,Q]=(0,l.useState)(""),[U,W]=(0,l.useState)(""),[Y,M]=(0,l.useState)(""),[V,X]=(0,l.useState)([]),[Z,$]=(0,l.useState)(""),[ee,te]=(0,l.useState)(""),[ae,le]=(0,l.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[ne,se]=(0,l.useState)([]),[oe,de]=(0,l.useState)([]),[ie,re]=(0,l.useState)([]),[ce,ue]=(0,l.useState)([]),[me,pe]=(0,l.useState)([]),[ve,he]=(0,l.useState)([]),[ge,je]=(0,l.useState)(""),xe=(0,A.useHistory)(),ye=(e,t,a)=>{t(),x(e[0]),D(a)},Ae=e=>({filterDropdown:t=>{let{setSelectedKeys:a,selectedKeys:l,confirm:d,clearFilters:i,close:r}=t;return(0,k.jsxs)("div",{style:{padding:8},children:[(0,k.jsx)(n.A,{ref:w,placeholder:"Search ".concat(e),value:l[0],onChange:e=>a(e.target.value?[e.target.value]:[]),onPressEnter:()=>ye(l,d,e),style:{marginBottom:8,display:"block"}}),(0,k.jsxs)(s.A,{children:[(0,k.jsx)(o.A,{type:"primary",onClick:()=>ye(l,d,e),icon:(0,k.jsx)(f.A,{}),size:"small",style:{width:90},children:"Search"}),(0,k.jsx)(o.A,{onClick:()=>i&&(e=>{e(),x("")})(i),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,k.jsx)(f.A,{style:{color:e?"#1677ff":void 0}}),onFilter:(t,a)=>a[e].toString().toLowerCase().includes(t.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.select()}),100)},render:t=>S===e?(0,k.jsx)(C(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[a],autoEscape:!0,textToHighlight:t?t.toString():""}):t}),Ie=(d.A,d.A.Item,d.A.Item,d.A.Item,[{title:"Project Code",dataIndex:"code",key:"code",...Ae("code")},{title:"Project ",dataIndex:"title",key:"title",...Ae("title")},{title:"Department ",dataIndex:"departmentTitle",key:"departmentTitle",...Ae("departmentTitle")},{title:"Client",dataIndex:"clientId",key:"clientId",...Ae("clientId")},{title:"Start Date",dataIndex:"startedDate",key:"startedDate",sorter:(e,t)=>new Date(e.startedDate.split("/").reverse().join("/"))-new Date(t.startedDate.split("/").reverse().join("/"))},{title:"Expected End Date",dataIndex:"endedDate",key:"endedDate",sorter:(e,t)=>new Date(e.endedDate.split("/").reverse().join("/"))-new Date(t.endedDate.split("/").reverse().join("/"))},{title:"Status",key:"status",dataIndex:"status",filters:[{text:"Initialized",value:"Initialized"},{text:"Ongoing",value:"Ongoing"},{text:"Completed",value:"Completed"}],onFilter:(e,t)=>t.status===e},{title:"Progress",key:"percentage",render:(e,t)=>(0,k.jsx)(s.A,{children:null!==t.percentage?(0,k.jsx)(b,{percentage:t.percentage.toFixed(1)}):null})}]),fe=()=>{te(""),$(""),G(""),Q(""),F(""),X([]),q(!1)},Se=async()=>{const e=E.map((e=>{const t=ce.find((t=>t.id===e));return{suffix:t?t.suffix:null,title:t?t.title:null}}));try{var t,a,l,n,s;const o=await y().post("http://54.81.250.98:8083/api/projects/",{title:_,departmentId:E,departments:e,status:"Initialized",noOfUsers:0,clientId:K,code:ee,companyId:null===ae||void 0===ae||null===(t=ae.user)||void 0===t?void 0:t.companyId,authorId:null===ae||void 0===ae||null===(a=ae.user)||void 0===a?void 0:a.id,authorName:"".concat(null===ae||void 0===ae||null===(l=ae.user)||void 0===l?void 0:l.firstName," ").concat(null===ae||void 0===ae||null===(n=ae.user)||void 0===n?void 0:n.lastName),startedDate:U,endedDate:Y},{headers:{Authorization:null===ae||void 0===ae?void 0:ae.accessToken}});console.log(o),i.Ay.success(null===o||void 0===o||null===(s=o.data)||void 0===s?void 0:s.message),q(!1),Ce()}catch(o){console.error("Error adding projects:",o)}},Ce=async()=>{try{var e,t;const a=await y().get("http://54.81.250.98:8083/api/projects?companyId=".concat(null===ae||void 0===ae||null===(e=ae.user)||void 0===e?void 0:e.companyId,"&roleId=").concat(null===ae||void 0===ae||null===(t=ae.user)||void 0===t?void 0:t.roleId),{headers:{Authorization:null===ae||void 0===ae?void 0:ae.accessToken}});console.log("Project response data",a.data);const l=a.data.map((e=>{const t=new Date(e.startedDate).toLocaleDateString("en-GB"),a=new Date(e.endedDate).toLocaleDateString("en-GB");return{...e,startedDate:t,endedDate:a}})),n=null===ae||void 0===ae?void 0:ae.user.departmentId,s=null===ae||void 0===ae?void 0:ae.user.roleId;if(console.log(n,"userId"),void 0!==n&&1!==s){const e=l.filter((e=>e.departmentIds.split(",").includes(n.toString())));console.log("User's Projects:",e),se(e)}else se(l);de(l);const o=[];for(const e of null===a||void 0===a?void 0:a.data)o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title});console.log(o),pe(o)}catch(a){console.error("Error fetching projects:",null===a||void 0===a?void 0:a.message)}};(0,l.useEffect)((()=>{var e;le(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),(async()=>{try{var e;const t=await y().get("http://54.81.250.98:8083/api/clients?companyId=".concat(null===ae||void 0===ae||null===(e=ae.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===ae||void 0===ae?void 0:ae.accessToken}}),a=new Set,l=null===t||void 0===t?void 0:t.data.reduce(((e,t)=>(a.has(t.companyName)||(a.add(t.com),e.push({value:t.id,label:t.companyName,name:t.companyName})),e)),[]);he(l)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const t=await y().get("http://54.81.250.98:8083/api/departments?companyId=".concat(null===ae||void 0===ae||null===(e=ae.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===ae||void 0===ae?void 0:ae.accessToken}});console.log(t.data,"data agaya");const a=[],l=[];for(const e of null===t||void 0===t?void 0:t.data)a.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title}),l.push({id:null===e||void 0===e?void 0:e.id,title:null===e||void 0===e?void 0:e.title,suffix:null===e||void 0===e?void 0:e.suffix});ue(l),re(a)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),Ce()}),[]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(r.A,{title:"Add Project",width:416,centered:!0,visible:R,onCancel:fe,footer:null,closeIcon:(0,k.jsx)(j.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,k.jsxs)(c.A,{layout:"vertical",name:"basic",children:[(0,k.jsx)(c.A.Item,{label:"Project Code",name:"projCode",children:(0,k.jsx)(n.A,{value:H,onChange:e=>te(e.target.value)})}),(0,k.jsx)(c.A.Item,{label:"Project Name",name:"projName",children:(0,k.jsx)(n.A,{value:_,onChange:e=>G(e.target.value)})}),(0,k.jsx)(c.A.Item,{label:"Client",name:"clientEmail",rules:[{required:!0,message:"Please select Client Email"}],children:(0,k.jsx)(u.A,{options:ve,value:K,onChange:e=>Q(e)})}),(0,k.jsx)(c.A.Item,{label:"Departments",name:"departmentIds",rules:[{required:!0,message:"Please select at least one department"}],children:(0,k.jsx)(m.A.Group,{options:ie,value:E,onChange:T})}),(0,k.jsx)(c.A.Item,{label:"Start Date",name:"startedDate",rules:[{required:!0,message:"Please select start date"}],children:(0,k.jsx)(p.A,{style:{width:"100%"},onChange:e=>{W(e)}})}),(0,k.jsx)(c.A.Item,{label:"End Date",name:"endedDate",rules:[{required:!0,message:"Please select end date"}],children:(0,k.jsx)(p.A,{style:{width:"100%"},onChange:e=>{M(e)}})}),(0,k.jsxs)(v.A,{children:[(0,k.jsx)(h.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,k.jsx)(o.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>Se(),children:"Add"})}),(0,k.jsx)(h.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,k.jsx)(o.A,{block:!0,onClick:fe,children:"Cancel"})})]})]})}),(0,k.jsx)(r.A,{title:"Document Permissions",width:416,centered:!0,visible:B,onCancel:()=>{L(!1)},footer:null,closeIcon:(0,k.jsx)(j.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,k.jsxs)(c.A,{layout:"vertical",name:"basic",children:[(0,k.jsx)(c.A.Item,{label:"Project Name",name:"projectId",children:(0,k.jsx)(u.A,{options:me,value:ge,onChange:e=>je(e)})}),(0,k.jsxs)(v.A,{children:[(0,k.jsx)(h.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,k.jsx)(o.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>Se(),children:"Add"})}),(0,k.jsx)(h.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,k.jsx)(o.A,{block:!0,onClick:fe,children:"Cancel"})})]})]})}),(0,k.jsx)("div",{style:{textAlign:"right",marginBottom:"16px"},children:1==(null===ae||void 0===ae||null===(t=ae.user)||void 0===t?void 0:t.roleId)&&(0,k.jsx)(o.A,{type:"primary",onClick:()=>{q(!0)},children:"Add Project"})}),(0,k.jsx)(g.A,{bordered:!0,size:"middle",title:()=>"All Project Details",footer:()=>"You may filter Projects",columns:Ie,dataSource:N(ne),onRow:e=>({onClick:()=>(e=>{xe.push({pathname:"./mdr",state:{selectedRecord:e}})})(e)})}),(0,k.jsx)(I.A,{})]})}const N=e=>{const t={};e.forEach((e=>{const a=e.title;t[a]?t[a].departmentNames.push(e.departmentName+","):t[a]={...e,departmentNames:[e.departmentName+","]}}));return Object.values(t).map((e=>({...e,departmentName:e.departmentNames.join("")})))}}}]);
//# sourceMappingURL=4692.e0a8701d.chunk.js.map