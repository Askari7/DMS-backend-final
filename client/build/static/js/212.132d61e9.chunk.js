"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[212],{33212:(e,t,a)=>{a.r(t),a.d(t,{default:()=>x});var o=a(65043),s=a(64435),r=a(15627),n=a(21261),l=a(47419),i=a(11645),c=a(94376),d=a(33733),u=a(89421),p=a(26412),m=a(73754),v=a(40854),h=a.n(v),S=a(78186),y=a(70579);function x(){var e,t;const a=[{title:"Document Name",dataIndex:"docName",key:"docName"},{title:"MDR Code",dataIndex:"masterDocumentCode",key:"masterDocumentCode"},{title:"Approver",dataIndex:"approver",key:"approver"},{title:"Reviewer",dataIndex:"reviewer",key:"reviewer"},{title:"Your Role",dataIndex:"yourRole",key:"yourRole"},{title:"Your Status",dataIndex:"yourStatus",key:"yourStatus"},{title:"Overall Approver Status",dataIndex:"approverStatuss",key:"approverStatuss"},{title:"Overall Reviewer Status",dataIndex:"reviewerStatuss",key:"reviewerStatuss"},{title:"Creator",dataIndex:"allowCreate",key:"allowCreate"},{title:"Action",key:"action",render:(e,t)=>(0,y.jsxs)(s.A,{size:"middle",children:[(0,y.jsx)("a",{onClick:()=>me(t),children:"Open"}),(0,y.jsx)("a",{onClick:()=>le(t),children:"Add Status"}),(0,y.jsx)("a",{onClick:()=>ce(t),children:"Send to Client"})]})}],[v,x]=(0,o.useState)(""),[A,g]=(0,o.useState)(null),[f,j]=(0,o.useState)(!1),[I,w]=(0,o.useState)(!1),[b,C]=(0,o.useState)([]),[k,R]=(0,o.useState)(!1),[N,O]=(0,o.useState)([]),[z,E]=(0,o.useState)([]),[P,D]=(0,o.useState)(""),[T,M]=(0,o.useState)(""),[G,q]=(0,o.useState)(!1),[F,U]=(0,o.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[Y,B]=(0,o.useState)([]),[Q,_]=(0,o.useState)([]),[J,L]=(0,o.useState)([]),[V,W]=(0,o.useState)([]),[X,H]=(0,o.useState)([]),[K,Z]=(0,o.useState)([]),[$,ee]=(0,o.useState)([]),[te,ae]=(0,o.useState)([]),[oe,se]=(0,o.useState)([]),[re,ne]=(0,o.useState)(""),le=e=>{g(e),j(!0)},ie=()=>{x(""),j(!1)},ce=e=>{w(!0)},de=()=>{w(!1)},[ue,pe]=(0,o.useState)(""),me=async e=>{const t=await(async e=>{try{var t;const a=await h().get("http://127.0.0.1:8083/api/documents/establishment?companyId=".concat(null===F||void 0===F||null===(t=F.user)||void 0===t?void 0:t.companyId,"&userId=").concat(F.user.id,"&docName=").concat(e),{headers:{Authorization:null===F||void 0===F?void 0:F.accessToken}});return console.log(a.data,"received"),a.data}catch(a){console.error("Error fetching documents:",null===a||void 0===a?void 0:a.message)}})(e.docName);console.log("helllooo",t);const a=e.docName,o="".concat("http://127.0.0.1:8083","/documents/").concat(a,"-").concat(e.version,".pdf");console.log(F.user.roleId,F.user.firstName,F);let s="false";t&&(s="true"),window.location.href="http://54.81.250.98:3001/react-pdf-highlighter/?docName=".concat(a,".pdf&url=").concat(o,"&allowed=").concat(s,"&user=").concat(F.user.roleId," ").concat(F.user.firstName)},ve=()=>{M(""),R(!1)},he=async()=>{try{var e,t;const a=await h().get("http://127.0.0.1:8083/api/documents/establishment?companyId=".concat(null===F||void 0===F||null===(e=F.user)||void 0===e?void 0:e.companyId,"&userId=").concat(null===F||void 0===F||null===(t=F.user)||void 0===t?void 0:t.id),{headers:{Authorization:null===F||void 0===F?void 0:F.accessToken}});console.log("response",a.data);for(let e of a.data){const t=e.approverStatus.split(",").map((e=>parseInt(e.trim(),10))),a=e.reviewerStatus.split(",").map((e=>parseInt(e.trim(),10))),o=e.reviewerId.split(",").map((e=>parseInt(e.trim(),10))),s=e.approverId.split(",").map((e=>parseInt(e.trim(),10)));se(e.reviewerId.split(",").map((e=>parseInt(e.trim(),10)))),ae(e.approverId.split(",").map((e=>parseInt(e.trim(),10)))),ee(e.reviewerStatus.split(",").map((e=>parseInt(e.trim(),10)))),Z(e.approverStatus.split(",").map((e=>parseInt(e.trim(),10)))),console.log($,K,"hii"),e.approverId.includes(F.user.id)&&e.reviewerId.includes(F.user.id)?(console.log("YESSSSSSSSSSS"),e.yourRole="Approver and Reviewer"):s.includes(F.user.id)?(console.log("YESSSSSSSSSSS"),e.yourRole="Approver",ne(s.indexOf(F.user.id))):o.includes(F.user.id)&&(console.log("YESSSSSSSSSSS"),e.yourRole="Reviewer",ne(o.indexOf(F.user.id)),console.log(o.indexOf(F.user.id),"jjjjj"),console.log(o,F.user.id,a[o.indexOf(F.user.id)],"ssss"+typeof a),1==a[o.indexOf(F.user.id)]?e.yourStatus="Rejected":2==a[o.indexOf(F.user.id)]?e.yourStatus="Accepted":0==a[o.indexOf(F.user.id)]&&(e.yourStatus="Pending")),t.every((e=>0===e))?e.approverStatuss="Pending":t.some((e=>0!==e&&2!==e))?e.approverStatuss="Rejected":t.every((e=>2===e))&&(e.approverStatuss="Sent to Client"),a.every((e=>0===e))?e.reviewerStatuss="Pending":a.every((e=>1===e))?e.reviewerStatuss="Rejected":a.every((e=>2===e))?e.reviewerStatuss="Sent for Approval":e.reviewerStatuss="Pending"}B(a.data)}catch(a){console.error("Error fetching departments:",null===a||void 0===a?void 0:a.message)}},Se=async e=>{try{console.log($,K,"hohohoho");let t=[...$],a=[...K];"Approver"===e.yourRole&&"Accept"===v?(1,a[te.indexOf(F.user.id)]=2,Z(a)):"Reviewer"===e.yourRole&&"Accept"===v?(0,t[oe.indexOf(F.user.id)]=2,ee(t)):"Approver"===e.yourRole&&"Reject"===v?(1,a[te.indexOf(F.user.id)]=1,Z(a)):"Reviewer"===e.yourRole&&"Reject"===v&&(0,t[oe.indexOf(F.user.id)]=1,ee(t)),console.log(e.yourRole,v,t.join(","),a.join(","));const o=await h().put("http://127.0.0.1:8083/api/documents/establishment",{status:v,revStatusArr:t.join(","),appStatusArr:a.join(","),docName:e.docName},{headers:{Authorization:null===F||void 0===F?void 0:F.accessToken}});console.log(o.data),await he()}catch(t){console.error("Error assigning documents:",t)}};return(0,o.useEffect)((async()=>{var e;U(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),await he(),(async()=>{try{var e;const t=await h().get("http://127.0.0.1:8083/api/users?companyId=".concat(null===F||void 0===F||null===(e=F.user)||void 0===e?void 0:e.companyId,"&roleId=2"),{headers:{Authorization:null===F||void 0===F?void 0:F.accessToken}});console.log(null===t||void 0===t?void 0:t.data,"UUUAUA");const a=[];for(const e of null===t||void 0===t?void 0:t.data)a.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(null===e||void 0===e?void 0:e.lastName)});E(a)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const t=await h().get("http://127.0.0.1:8083/api/documents/mdr?companyId=".concat(null===F||void 0===F||null===(e=F.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===F||void 0===F?void 0:F.accessToken}}),a=[];for(const e of null===t||void 0===t?void 0:t.data)a.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title,DocumentPermissionId:null===e||void 0===e?void 0:e.DocumentPermissionId,departmentId:null===e||void 0===e?void 0:e.departmentId});O(a)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const t=await h().get("http://127.0.0.1:8083/api/clients?companyId=".concat(null===F||void 0===F||null===(e=F.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===F||void 0===F?void 0:F.accessToken}});console.log(t.data,"received");const a=t.data.map((e=>({value:e.companyName,label:e.companyName})));console.log("clients",a),_(a)}catch(t){console.error("Error fetching clients:",null===t||void 0===t?void 0:t.message)}})()}),[]),(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(n.A,{title:"Change Status",width:400,centered:!0,visible:f,onCancel:ie,footer:null,closeIcon:(0,y.jsx)(m.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(l.A,{justify:"space-between",align:"center",children:(0,y.jsx)(i.A,{span:20,children:(0,y.jsxs)(c.A,{layout:"vertical",name:"basic",children:[(0,y.jsx)(c.A.Item,{label:"Select Status",name:"selectedStatus",rules:[{required:!0,message:"Please select a status"}],children:(0,y.jsx)(d.A,{options:[{label:"Accept",value:"Accept"},{label:"Reject",value:"Reject"}],value:v,onChange:e=>x(e)})}),(0,y.jsxs)(l.A,{children:[(0,y.jsx)(i.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(u.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{if(A){const e={...A,status:v},t=Y.map((t=>t.id===A.id?e:t));H(t),await Se(A),ie()}})(),children:"Submit"})}),(0,y.jsx)(i.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,y.jsx)(u.A,{block:!0,onClick:ie,children:"Cancel"})})]})]})})})}),(0,y.jsx)(n.A,{title:"Send To Client",width:400,centered:!0,visible:I,onCancel:de,footer:null,closeIcon:(0,y.jsx)(m.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsx)(l.A,{justify:"space-between",align:"center",children:(0,y.jsx)(i.A,{span:20,children:(0,y.jsxs)(c.A,{layout:"vertical",name:"basic",children:[(0,y.jsx)(c.A.Item,{label:"Select Emails",name:"selectedEmails",rules:[{required:!0,message:"Please select a Email"}],children:(0,y.jsx)(d.A,{options:Q,value:b,onChange:e=>C(e)})}),(0,y.jsxs)(l.A,{children:[(0,y.jsx)(i.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(u.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{})(),children:"Send"})}),(0,y.jsx)(i.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,y.jsx)(u.A,{block:!0,onClick:de,children:"Cancel"})})]})]})})})}),(0,y.jsx)(n.A,{title:"Create Permissions",width:416,centered:!0,visible:k,onCancel:ve,footer:null,closeIcon:(0,y.jsx)(m.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,y.jsxs)(c.A,{layout:"vertical",name:"basic",children:[(0,y.jsx)(c.A.Item,{label:"MDR",name:"mdr",rules:[{required:!0,message:"Please select MDR"}],children:(0,y.jsx)(d.A,{options:N,value:T,onChange:e=>M(e)})}),(0,y.jsx)(c.A.Item,{label:"Users",name:"users",rules:[{required:!0,message:"Please select MDR"}],children:(0,y.jsx)(d.A,{options:z,value:P,onChange:e=>D(e)})}),(0,y.jsx)(c.A.Item,{label:"Permissions",name:"permissions",children:(0,y.jsx)(S.A.Group,{options:[{label:"Reviewer",value:"Reviewer"},{label:"Approver",value:"Approver"},{label:"Creator",value:"Creator"}],defaultValue:0,onChange:e=>{console.log("checked = ",e),W(e)}})}),(0,y.jsxs)(l.A,{children:[(0,y.jsx)(i.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,y.jsx)(u.A,{block:!0,type:"primary",htmlType:"submit",onClick:()=>(async()=>{try{var e,t;const a=await h().post("http://127.0.0.1:8083/api/documents/permissions",{masterDocumentId:T,userId:P,companyId:null===F||void 0===F||null===(e=F.user)||void 0===e?void 0:e.companyId,createDocument:null===V||void 0===V?void 0:V.includes("Creator"),reviewDocument:null===V||void 0===V?void 0:V.includes("Reviewer"),approveDocument:null===V||void 0===V?void 0:V.includes("Approver")},{headers:{Authorization:null===F||void 0===F?void 0:F.accessToken}});console.log(a),r.Ay.success(null===a||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message),M(""),D(""),W([]),await he(),R(!1)}catch(a){"Request failed with status code 403"==(null===a||void 0===a?void 0:a.message)&&r.Ay.error("Permission Denied to create document on this MDR")}})(),children:"Add"})}),(0,y.jsx)(i.A,{md:12,span:24,className:"hp-mt-sm-12 hp-pl-sm-0 hp-pl-12",children:(0,y.jsx)(u.A,{block:!0,onClick:ve,children:"Cancel"})})]})]})}),(0,y.jsx)("div",{style:{textAlign:"right",marginBottom:"16px"},children:(0,y.jsx)(u.A,{type:"primary",onClick:()=>{R(!0)},disabled:1!=(null===F||void 0===F||null===(t=F.user)||void 0===t?void 0:t.roleId),children:"Add Permissions"})}),(0,y.jsx)("div",{style:{overflowX:"auto"},children:(0,y.jsx)(p.A,{columns:a,dataSource:Y})})]})}},64435:(e,t,a)=>{a.d(t,{e:()=>v,A:()=>S});var o=a(58168),s=a(64467),r=a(5544),n=a(65043),l=a(98139),i=a.n(l),c=a(62149),d=a(25055);function u(e){var t=e.className,a=e.direction,r=e.index,l=e.marginDirection,i=e.children,c=e.split,d=e.wrap,u=n.useContext(v),p=u.horizontalSize,m=u.verticalSize,h=u.latestIndex,S={};return u.supportFlexGap||("vertical"===a?r<h&&(S={marginBottom:p/(c?2:1)}):S=(0,o.A)((0,o.A)({},r<h&&(0,s.A)({},l,p/(c?2:1))),d&&{paddingBottom:m})),null===i||void 0===i?null:n.createElement(n.Fragment,null,n.createElement("div",{className:t,style:S},i),r<h&&c&&n.createElement("span",{className:"".concat(t,"-split"),style:S},c))}var p=a(46058),m=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(a[o[s]]=e[o[s]])}return a},v=n.createContext({latestIndex:0,horizontalSize:0,verticalSize:0,supportFlexGap:!1}),h={small:8,middle:16,large:24};const S=function(e){var t,a=n.useContext(d.QO),l=a.getPrefixCls,S=a.space,y=a.direction,x=e.size,A=void 0===x?(null===S||void 0===S?void 0:S.size)||"small":x,g=e.align,f=e.className,j=e.children,I=e.direction,w=void 0===I?"horizontal":I,b=e.prefixCls,C=e.split,k=e.style,R=e.wrap,N=void 0!==R&&R,O=m(e,["size","align","className","children","direction","prefixCls","split","style","wrap"]),z=(0,p.A)(),E=n.useMemo((function(){return(Array.isArray(A)?A:[A,A]).map((function(e){return function(e){return"string"===typeof e?h[e]:e||0}(e)}))}),[A]),P=(0,r.A)(E,2),D=P[0],T=P[1],M=(0,c.A)(j,{keepEmpty:!0}),G=void 0===g&&"horizontal"===w?"center":g,q=l("space",b),F=i()(q,"".concat(q,"-").concat(w),(t={},(0,s.A)(t,"".concat(q,"-rtl"),"rtl"===y),(0,s.A)(t,"".concat(q,"-align-").concat(G),G),t),f),U="".concat(q,"-item"),Y="rtl"===y?"marginLeft":"marginRight",B=0,Q=M.map((function(e,t){return null!==e&&void 0!==e&&(B=t),n.createElement(u,{className:U,key:"".concat(U,"-").concat(t),direction:w,index:t,marginDirection:Y,split:C,wrap:N},e)})),_=n.useMemo((function(){return{horizontalSize:D,verticalSize:T,latestIndex:B,supportFlexGap:z}}),[D,T,B,z]);if(0===M.length)return null;var J={};return N&&(J.flexWrap="wrap",z||(J.marginBottom=-T)),z&&(J.columnGap=D,J.rowGap=T),n.createElement("div",(0,o.A)({className:F,style:(0,o.A)((0,o.A)({},J),k)},O),n.createElement(v.Provider,{value:_},Q))}}}]);
//# sourceMappingURL=212.132d61e9.chunk.js.map