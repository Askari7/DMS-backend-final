"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[9491],{29491:(e,t,o)=>{o.r(t),o.d(t,{default:()=>b});var n=o(65043),a=o(64435),r=o(8387),l=o(86904),s=o(15627),c=o(21261),d=o(47419),i=o(11645),u=o(94376),m=o(60521),p=o(89421),v=o(26512),h=o(43886),g=o(70610),x=o(73754),f=o(40854),y=o.n(f),C=o(91688),j=o(98294),A=o(70579);const b=e=>{var t;let{projectCode:o,mdrCode:f}=e;const[b,I]=(0,n.useState)(!1),[D,S]=(0,n.useState)({}),{search:N}=(0,C.useLocation)(),k=new URLSearchParams(N),w=k.get("projectCode"),O=k.get("mdrCode"),E=k.get("projectId"),z=k.get("title"),P=k.get("departmentId");let T=k.get("departmentOptions"),F=k.get("departmentOption");const R=k.get("projectOptions"),M=k.get("approver"),U=k.get("reviewer"),q=k.get("record");console.log("data from mdr to mdrtemplates",w,O,E,z,P,F,T,R,M,U,q);const[B,L]=(0,n.useState)({}),[X,G]=(0,n.useState)(!1),[Q,J]=(0,n.useState)(!1),[_,K]=(0,n.useState)(""),[Y,V]=(0,n.useState)(null),[W,H]=(0,n.useState)(!1),[Z,$]=(0,n.useState)(!0),[ee,te]=(0,n.useState)([]),[oe,ne]=(0,n.useState)(null),[ae,re]=(0,n.useState)([]),[le,se]=(0,n.useState)([]),[ce,de]=(0,n.useState)(JSON.parse(null===(t=localStorage)||void 0===t?void 0:t.getItem("user"))),[ie,ue]=(0,n.useState)(),[me,pe]=(0,n.useState)(),[ve,he]=(0,n.useState)(),[ge,xe]=(0,n.useState)(),[fe,ye]=(0,n.useState)(),Ce=JSON.parse(F),je=JSON.parse(T),Ae=new Map(je.map((e=>[e.value,e.label]))),be=P.split(",").map(Number).map((e=>Ae.get(e))).join(", "),Ie=Object.entries(j).map((e=>{let[t,o]=e;return{...o,index:parseInt(t),checked:!1}})),[De,Se]=(0,n.useState)(Object.values(Ie)),[Ne,ke]=(0,n.useState)(Object.values(Ie));const[we,Oe]=(0,n.useState)({}),[Ee,ze]=(0,n.useState)({}),[Pe,Te]=(0,n.useState)([]),[Fe,Re]=(0,n.useState)([]),[Me,Ue]=(0,n.useState)([]),[qe,Be]=(0,n.useState)([]),Le=[{title:"Sr.#",dataIndex:"code",key:"code"},{title:"Document",dataIndex:"documentTitle",key:"documentTitle"},{title:"Department Code",dataIndex:"departmentCode",key:"departmentCode",filters:[{text:"Project Management",value:"PM"},{text:"Process",value:"PRO"},{text:"Piping",value:"PIP"},{text:"Mechanical",value:"TK"},{text:"Civil/Structure",value:"CIV"},{text:"Electrical",value:"ELE"},{text:"Instrumentation",value:"INS"}],filterMode:"tree",filterSearch:!0,onFilter:(e,t)=>t.departmentCode===e},{title:"Document Content Code",dataIndex:"documentContentCode",key:"documentContentCode"},{title:"DOCUMENT NUMBER",dataIndex:"document",key:"document"},{title:"No Of Documents",key:"noOfDocuments",render:(e,t)=>(0,A.jsxs)(a.A,{size:"middle",align:"center",children:[(0,A.jsx)(r.A,{style:{color:"white",backgroundColor:"blue"},onClick:()=>Xe(t,"add"),children:"+"}),(0,A.jsx)(r.A,{style:{color:"white",backgroundColor:"blue"},children:we[t.document]||1}),(0,A.jsx)(r.A,{style:{color:"white",backgroundColor:"blue"},onClick:()=>Xe(t,"sub"),children:"-"})]})}];(0,n.useEffect)((()=>{const e=setTimeout((()=>{te(je.map((e=>e.label))),$(!1)}),1e3);return()=>clearTimeout(e)}),[]);const Xe=(e,t)=>{Oe((o=>{const n={...o},a=n[e.document]||1;return n[e.document]="add"==t?a+1:a-1,n}))},Ge=()=>{H(!1)},Qe=e=>{const t=Ne.filter((t=>t.category.toUpperCase()===e.toUpperCase())),o=Ne.filter(((e,t)=>le.includes(t)&&e.checked)).map((e=>e.index));se(o),Se(t)},Je=()=>{G(!1)},_e=()=>{J(!1)};(0,n.useEffect)((()=>{(async()=>{try{var e,t=(await y().get("http://54.81.250.98:8083/api/documents/getCodes?companyId=".concat(null===ce||void 0===ce||null===(e=ce.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===ce||void 0===ce?void 0:ce.accessToken}})).data.documentNumberFormat.split("-");re(w+"-"+t[1]+"-"+t[2]+"-"+O+"-00X")}catch(o){console.error("Error fetching projects:",null===o||void 0===o?void 0:o.message)}})()}),[]),(0,n.useEffect)((()=>{}),[Pe]);const Ke=()=>{I(!1)};return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(c.A,{title:"Update Code",width:400,centered:!0,visible:Q,onCancel:_e,footer:null,closeIcon:(0,A.jsx)(x.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:[(0,A.jsx)(d.A,{justify:"space-between",align:"center",children:(0,A.jsx)(i.A,{span:20,children:(0,A.jsx)(u.A,{layout:"vertical",name:"basic",children:(0,A.jsx)(u.A.Item,{label:"Update Code",name:"UpdateCode",rules:[{required:!0,message:"Please Update Code"}],children:(0,A.jsx)(m.A,{value:ie,onChange:e=>{K(e.target.value)}})})})})}),(0,A.jsx)(p.A,{type:"primary",onClick:e=>{if(Y){const e=[...De],t=Y.key,o="".concat(w,"-").concat(_,"-").concat(O,"-00X");e[t]={...Y,document:o},Se(e),V(null),_e()}},children:"Confirm"})]}),(0,A.jsxs)(c.A,{title:"Upload Document",width:400,visible:X,onCancel:Je,footer:null,closeIcon:(0,A.jsx)(x.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:[(0,A.jsx)(d.A,{justify:"space-between",align:"center",children:(0,A.jsxs)("div",{children:[(0,A.jsx)("h3",{children:"Selected Documents:"}),(0,A.jsx)("ul",{style:{margin:"2px",padding:"2px"},children:le.map((e=>(0,A.jsx)(n.Fragment,{children:Array.from({length:De[e].count||1},((t,o)=>{var n,a,r,l,s,c,d;return(0,A.jsxs)("li",{style:{margin:"2px",padding:"2px"},children:[(0,A.jsx)("strong",{style:{color:"blue"},children:"Category:"})," ",De[e].category," ",(0,A.jsx)("br",{}),(0,A.jsx)("strong",{style:{color:"blue"},children:"Code:"})," ",De[e].code," ",(0,A.jsx)("br",{}),(0,A.jsx)("strong",{style:{color:"blue"},children:"Document Number:"})," ",(null===(n=Pe[e])||void 0===n?void 0:n[o])||""," ",(0,A.jsx)("br",{}),(0,A.jsx)("br",{}),(0,A.jsx)(u.A.Item,{label:"Start Date",name:"startedDate[".concat(e,"][").concat(o,"]"),children:(0,A.jsx)(v.A,{style:{width:"100%"},onChange:t=>((e,t,o,n)=>{Be((t=>{const a=[...t];return a[o]=a[o]||[],a[o][n]={...a[o][n],startDate:e?e.toDate():null},a}))})(t,De[e].document,e,o),disabled:null===(a=qe[e])||void 0===a||null===(r=a[o])||void 0===r?void 0:r.isChecked,required:!0})}),(0,A.jsx)(u.A.Item,{label:"End Date",name:"endedDate[".concat(e,"][").concat(o,"]"),children:(0,A.jsx)(v.A,{style:{width:"100%"},onChange:t=>((e,t,o,n)=>{Be((t=>{const a=[...t];return a[o]=a[o]||[],a[o][n]={...a[o][n],endDate:e?e.toDate():null},a}))})(t,De[e].document,e,o),disabled:null===(l=qe[e])||void 0===l||null===(s=l[o])||void 0===s?void 0:s.isChecked,required:!0})}),(0,A.jsx)(u.A.Item,{label:"Title",name:"title[".concat(e,"][").concat(o,"]"),children:(0,A.jsx)(m.A,{style:{margin:"6px"},placeholder:"Enter Document Title",value:(null===(c=qe[e])||void 0===c||null===(d=c[o])||void 0===d?void 0:d.title)||"",onChange:t=>((e,t,o,n)=>{Be((t=>{const a=[...t];return a[o]=a[o]||[],a[o][n]={...a[o][n],title:e},a}))})(t.target.value,De[e].document,e,o),required:!0})})]},o)}))},e)))}),null!=D.count||""]})}),(0,A.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,A.jsx)(p.A,{type:"primary",onClick:async()=>{let e=!0;le.forEach((async t=>{let o=De[t].count||1;const n=qe.filter((e=>void 0!==e));console.log("count",o),console.log("DOC INFO1",n);for(let a=0;a<n.length;a++){console.log("OUTER LOOP I",a),console.log(n[a],"DOC ARRAY");for(let t=0;t<n[a].length;t++){if(console.log("INNER LOOP INDEX1",t),!(n[a][t].hasOwnProperty("title")&&n[a][t].hasOwnProperty("startDate")&&n[a][t].hasOwnProperty("endDate")&&null!==n[a][t].title&&null!==n[a][t].startDate&&null!==n[a][t].endDate)){console.log("IF CONDITION"),e=!0,s.Ay.error("Fill all the fields first");break}console.log("ELSE CONDITION"),e=!1}}})),0==e&&await(async()=>{await JSON.parse(T);try{var e=z,t=O;t=t.replace(/\s/g,"");var n=le.length;if(q)try{var a,r,c,d;const o=await y().put("http://54.81.250.98:8083/api/documents/mdr",{record:q,title:e,departmentId:P,projectId:E,noOfDocuments:n,status:"Ongoing",companyId:null===ce||void 0===ce||null===(a=ce.user)||void 0===a?void 0:a.companyId,authorId:null===ce||void 0===ce||null===(r=ce.user)||void 0===r?void 0:r.id,authorName:"".concat(null===ce||void 0===ce||null===(c=ce.user)||void 0===c?void 0:c.firstName," ").concat(null===ce||void 0===ce||null===(d=ce.user)||void 0===d?void 0:d.lastName),mdrCode:t,projectCode:w,departmentName:be},{headers:{Authorization:null===ce||void 0===ce?void 0:ce.accessToken}});l.A.success({message:"Successfully Created",description:"".concat(o.data.message),style:{backgroundColor:"#52c41a",color:"#fff"}})}catch(I){var i;if(409===(null===(i=I.response)||void 0===i?void 0:i.status))return l.A.error({message:"Conflict Error",description:"A mdr with this name or code already exists. Please choose a different name or code.",style:{backgroundColor:"#f5222d",color:"#fff"}}),void history.push("/pages/mdr");l.A.success({message:"Successfully Created",description:"".concat(response.data.message),style:{backgroundColor:"#52c41a",color:"#fff"}})}else try{var u,m,p,v;const o=await y().post("http://54.81.250.98:8083/api/documents/mdr",{title:e,departmentId:P,projectId:E,noOfDocuments:n,status:"Ongoing",companyId:null===ce||void 0===ce||null===(u=ce.user)||void 0===u?void 0:u.companyId,authorId:null===ce||void 0===ce||null===(m=ce.user)||void 0===m?void 0:m.id,authorName:"".concat(null===ce||void 0===ce||null===(p=ce.user)||void 0===p?void 0:p.firstName," ").concat(null===ce||void 0===ce||null===(v=ce.user)||void 0===v?void 0:v.lastName),mdrCode:t,projectCode:w,departmentName:be},{headers:{Authorization:null===ce||void 0===ce?void 0:ce.accessToken}});l.A.success({message:"Successfully Created",description:"".concat(o.data.message),style:{backgroundColor:"#52c41a",color:"#fff"}})}catch(I){var h;if(409===(null===(h=I.response)||void 0===h?void 0:h.status))return l.A.error({message:"Conflict Error",description:"A mdr with this name or code already exists. Please choose a different name or code.",style:{backgroundColor:"#f5222d",color:"#fff"}}),void history.push("/pages/mdr");l.A.error({message:"Error",description:"An error occurred while adding the mdr. Please try again.",style:{backgroundColor:"#f5222d",color:"#fff"}})}if(le.forEach((async e=>{De[e].document;let n=De[e].count||1;const a=h,r=ce.user.roleId,s=ce.user.id;for(let g=0;g<n;g++)try{var c,d,i,u,m=qe[e][g].title,p=qe[e][g].startDate,v=qe[e][g].endDate,h=Pe[e][g];await y().post("http://54.81.250.98:8083/api/documents/",{title:h,startedDate:p,expectedEndedDate:v,docTitle:m,departmentId:P,projectId:E,companyId:null===ce||void 0===ce||null===(c=ce.user)||void 0===c?void 0:c.companyId,userId:null===ce||void 0===ce||null===(d=ce.user)||void 0===d?void 0:d.id,userName:"".concat(null===ce||void 0===ce||null===(i=ce.user)||void 0===i?void 0:i.firstName," ").concat(null===ce||void 0===ce||null===(u=ce.user)||void 0===u?void 0:u.lastName),masterDocumentId:t,masterDocumentName:a,projectCode:o,departmentName:be,status:"Initialized",assignedBy:r,assignedFrom:s,approver:M,reviewer:U,version:"000"},{headers:{Authorization:null===ce||void 0===ce?void 0:ce.accessToken}}),l.A.success({message:"Documents Successfully Added",style:{backgroundColor:"#52c41a",color:"#fff"}})}catch(I){}})),null!=D.count){let n=D.count||1;const a=e,r=ce.user.roleId,s=ce.user.id;for(let c=0;c<n;c++)try{var g,x,f,C,j=qe[0][c].title,A=qe[0][c].startDate,b=qe[0][c].endDate;e=Fe[c],await y().post("http://54.81.250.98:8083/api/documents/",{title:e,startedDate:A,expectedEndedDate:b,docTitle:j,departmentId:P,projectId:E,companyId:null===ce||void 0===ce||null===(g=ce.user)||void 0===g?void 0:g.companyId,userId:null===ce||void 0===ce||null===(x=ce.user)||void 0===x?void 0:x.id,userName:"".concat(null===ce||void 0===ce||null===(f=ce.user)||void 0===f?void 0:f.firstName," ").concat(null===ce||void 0===ce||null===(C=ce.user)||void 0===C?void 0:C.lastName),masterDocumentId:t,masterDocumentName:a,projectCode:o,departmentName:be,status:"Initialized",assignedBy:r,assignedFrom:s,approver:M,reviewer:U,version:"000"},{headers:{Authorization:null===ce||void 0===ce?void 0:ce.accessToken}}),l.A.success({message:"Documents Successfully Added",style:{backgroundColor:"#52c41a",color:"#fff"}})}catch(I){}}if(0===le.length)return void s.Ay.error("Please select at least one row.")}catch(I){console.error("Error adding MDR:",I)}})(),Je()},disabled:0==qe.length,style:{},children:"Done"})})]}),(0,A.jsxs)(c.A,{title:"Departments",width:416,centered:!0,visible:W,onCancel:Ge,footer:null,closeIcon:(0,A.jsx)(x.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:[(0,A.jsx)(p.A,{size:"default",type:"primary",onClick:()=>(Ge(),void Se(Ne)),style:{margin:"8px"},children:"All Documents"}),Z?je.map((e=>(0,A.jsx)(p.A,{loading:!0,size:"default",style:{margin:"8px"},children:e.label},e.label))):ee.map((e=>(0,A.jsx)(p.A,{size:"default",style:{margin:"8px"},onClick:()=>(e=>{ne(e),Ge(),Qe(e)})(e),type:oe===e?"primary":"default",children:e},e)))]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("div",{style:{textAlign:"center",marginTop:20},children:(0,A.jsx)("h1",{children:"Select Documents For MDR"})}),(0,A.jsx)("div",{style:{marginBottom:"16px",justifyContent:"space-between"},children:(0,A.jsx)("h1",{children:"MDR Templates"})}),(0,A.jsx)(h.A,{columns:Le,dataSource:De.map(((e,t)=>({...e,key:t}))),rowSelection:{selectedRowKeys:le,onChange:(e,t)=>((e,t)=>{const o=t.map((e=>({...e,checked:!0}))).map((e=>e.index));se(o)})(0,t)},bordered:!0,size:"middle",title:()=>"All Department Documents",footer:()=>"You may filter docs",expandable:{expandedRowRender:e=>(0,A.jsx)("p",{style:{margin:0},children:e.document}),rowExpandable:e=>"Not Expandable"!==e.departmentCode}}),(0,A.jsxs)(a.A,{children:[(0,A.jsx)(p.A,{type:"primary",onClick:()=>{I(!0)},children:"Add Custom"}),(0,A.jsx)(p.A,{type:"primary",onClick:()=>{G(!0);const e=[...De];let t=[],o=[];const n=D.count;for(let a=0;a<n;a++){let e=D.document.replace("00X",(a+1).toString().padStart(3,"0")).replace("xxxx",w);o[a]||(o[a]={}),o[a]=e}le.forEach(((o,n)=>{const a=we[De[o].document]||1;for(let r=0;r<a;r++){let n=De[o].document.replace("00X",(r+1).toString().padStart(3,"0")).replace("xxxx",w);t[o]||(t[o]={}),t[o][r]=n,e[o]={...De[o],count:we[De[o].document]}}})),Re(o),Te(t),Se(e)},children:"Proceed"})]}),(0,A.jsx)(c.A,{title:"Add Custom Field",width:400,centered:!0,visible:b,onCancel:Ke,footer:[(0,A.jsx)(p.A,{onClick:Ke,children:"Cancel"},"cancel"),(0,A.jsx)(p.A,{type:"primary",onClick:()=>{const e=Ce.find((e=>e.value==me)),t="xxxx-01-".concat(me,"-").concat(ge,"-00X"),o={count:fe||"",departmentCode:me||"",documentContentCode:ge||"",documentTitle:ve||"",areaCode:"01",category:e.label,sequenceNumber:"00X",document:t};S(o),I(!1)},children:"Add"},"add")],closeIcon:(0,A.jsx)(x.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,A.jsxs)(u.A,{layout:"vertical",name:"customForm",children:[(0,A.jsx)(u.A.Item,{label:"Department",name:"department",rules:[{required:!0,message:"Please select Project Name"}],children:(0,A.jsx)(g.A,{options:Ce,value:me,onChange:e=>pe(e)})}),(0,A.jsx)(u.A.Item,{label:"Document",name:"document",rules:[{required:!0,message:"Please Add Document"}],children:(0,A.jsx)(m.A,{value:ve,onChange:e=>he(e.target.value)})}),(0,A.jsx)(u.A.Item,{label:"Document Content Code",name:"documentContentCode",rules:[{required:!0,message:"Please Add Document Content Code"}],children:(0,A.jsx)(m.A,{value:ge,onChange:e=>xe(e.target.value)})}),(0,A.jsx)(u.A.Item,{label:"Number Of Documents",name:"noOfDoxuments",rules:[{required:!0,message:"Please Add Number of Documents"}],children:(0,A.jsx)(m.A,{value:fe,onChange:e=>ye(e.target.value)})})]})})]})]})}},64435:(e,t,o)=>{o.d(t,{e:()=>v,A:()=>g});var n=o(58168),a=o(64467),r=o(5544),l=o(65043),s=o(98139),c=o.n(s),d=o(62149),i=o(25055);function u(e){var t=e.className,o=e.direction,r=e.index,s=e.marginDirection,c=e.children,d=e.split,i=e.wrap,u=l.useContext(v),m=u.horizontalSize,p=u.verticalSize,h=u.latestIndex,g={};return u.supportFlexGap||("vertical"===o?r<h&&(g={marginBottom:m/(d?2:1)}):g=(0,n.A)((0,n.A)({},r<h&&(0,a.A)({},s,m/(d?2:1))),i&&{paddingBottom:p})),null===c||void 0===c?null:l.createElement(l.Fragment,null,l.createElement("div",{className:t,style:g},c),r<h&&d&&l.createElement("span",{className:"".concat(t,"-split"),style:g},d))}var m=o(46058),p=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(o[n[a]]=e[n[a]])}return o},v=l.createContext({latestIndex:0,horizontalSize:0,verticalSize:0,supportFlexGap:!1}),h={small:8,middle:16,large:24};const g=function(e){var t,o=l.useContext(i.QO),s=o.getPrefixCls,g=o.space,x=o.direction,f=e.size,y=void 0===f?(null===g||void 0===g?void 0:g.size)||"small":f,C=e.align,j=e.className,A=e.children,b=e.direction,I=void 0===b?"horizontal":b,D=e.prefixCls,S=e.split,N=e.style,k=e.wrap,w=void 0!==k&&k,O=p(e,["size","align","className","children","direction","prefixCls","split","style","wrap"]),E=(0,m.A)(),z=l.useMemo((function(){return(Array.isArray(y)?y:[y,y]).map((function(e){return function(e){return"string"===typeof e?h[e]:e||0}(e)}))}),[y]),P=(0,r.A)(z,2),T=P[0],F=P[1],R=(0,d.A)(A,{keepEmpty:!0}),M=void 0===C&&"horizontal"===I?"center":C,U=s("space",D),q=c()(U,"".concat(U,"-").concat(I),(t={},(0,a.A)(t,"".concat(U,"-rtl"),"rtl"===x),(0,a.A)(t,"".concat(U,"-align-").concat(M),M),t),j),B="".concat(U,"-item"),L="rtl"===x?"marginLeft":"marginRight",X=0,G=R.map((function(e,t){return null!==e&&void 0!==e&&(X=t),l.createElement(u,{className:B,key:"".concat(B,"-").concat(t),direction:I,index:t,marginDirection:L,split:S,wrap:w},e)})),Q=l.useMemo((function(){return{horizontalSize:T,verticalSize:F,latestIndex:X,supportFlexGap:E}}),[T,F,X,E]);if(0===R.length)return null;var J={};return w&&(J.flexWrap="wrap",E||(J.marginBottom=-F)),E&&(J.columnGap=T,J.rowGap=F),l.createElement("div",(0,n.A)({className:q,style:(0,n.A)((0,n.A)({},J),N)},O),l.createElement(v.Provider,{value:Q},G))}}}]);
//# sourceMappingURL=9491.0c8c3157.chunk.js.map