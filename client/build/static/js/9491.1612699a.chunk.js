"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[9491],{29491:(e,t,o)=>{o.r(t),o.d(t,{default:()=>b});var n=o(65043),l=o(64435),r=o(8387),a=o(86904),s=o(15627),d=o(21261),i=o(47419),c=o(11645),u=o(94376),m=o(60521),p=o(89421),v=o(26512),h=o(43886),g=o(79940),x=o(73754),f=o(40854),y=o.n(f),C=o(91688),j=o(98294),A=o(70579);const b=e=>{var t;let{projectCode:o,mdrCode:f}=e;const[b,I]=(0,n.useState)(!1),[D,S]=(0,n.useState)({}),{search:N}=(0,C.useLocation)(),k=new URLSearchParams(N),w=k.get("projectCode"),O=k.get("mdrCode"),E=k.get("projectId"),z=k.get("title"),P=k.get("departmentId");let $=k.get("departmentOptions"),T=k.get("departmentOption");const F=k.get("projectOptions"),R=k.get("approver"),M=k.get("reviewer"),U=k.get("record");console.log("data from mdr to mdrtemplates",w,O,E,z,P,T,$,F,R,M,U);const[q,B]=(0,n.useState)({}),[L,X]=(0,n.useState)(!1),[G,Q]=(0,n.useState)(!1),[J,_]=(0,n.useState)(""),[K,Y]=(0,n.useState)(null),[V,W]=(0,n.useState)(!1),[H,Z]=(0,n.useState)(!0),[ee,te]=(0,n.useState)([]),[oe,ne]=(0,n.useState)(null),[le,re]=(0,n.useState)([]),[ae,se]=(0,n.useState)([]),[de,ie]=(0,n.useState)(JSON.parse(null===(t=localStorage)||void 0===t?void 0:t.getItem("user"))),[ce,ue]=(0,n.useState)(),[me,pe]=(0,n.useState)(),[ve,he]=(0,n.useState)(),[ge,xe]=(0,n.useState)(),[fe,ye]=(0,n.useState)(),Ce=JSON.parse(T),je=JSON.parse($),Ae=new Map(je.map((e=>[e.value,e.label]))),be=P.split(",").map(Number).map((e=>Ae.get(e))).join(", "),Ie=Object.entries(j).map((e=>{let[t,o]=e;return{...o,index:parseInt(t),checked:!1}})),[De,Se]=(0,n.useState)(Object.values(Ie)),[Ne,ke]=(0,n.useState)(Object.values(Ie));const[we,Oe]=(0,n.useState)({}),[Ee,ze]=(0,n.useState)({}),[Pe,$e]=(0,n.useState)([]),[Te,Fe]=(0,n.useState)([]),[Re,Me]=(0,n.useState)([]),[Ue,qe]=(0,n.useState)([]),Be=[{title:"Sr.#",dataIndex:"code",key:"code"},{title:"Document",dataIndex:"documentTitle",key:"documentTitle"},{title:"Department Code",dataIndex:"departmentCode",key:"departmentCode",filters:[{text:"Project Management",value:"PM"},{text:"Process",value:"PRO"},{text:"Piping",value:"PIP"},{text:"Mechanical",value:"TK"},{text:"Civil/Structure",value:"CIV"},{text:"Electrical",value:"ELE"},{text:"Instrumentation",value:"INS"}],filterMode:"tree",filterSearch:!0,onFilter:(e,t)=>t.departmentCode===e},{title:"Document Content Code",dataIndex:"documentContentCode",key:"documentContentCode"},{title:"DOCUMENT NUMBER",dataIndex:"document",key:"document"},{title:"No Of Documents",key:"noOfDocuments",render:(e,t)=>(0,A.jsxs)(l.A,{size:"middle",align:"center",children:[(0,A.jsx)(r.A,{style:{color:"white",backgroundColor:"blue"},onClick:()=>Le(t,"add"),children:"+"}),(0,A.jsx)(r.A,{style:{color:"white",backgroundColor:"blue"},children:we[t.document]||1}),(0,A.jsx)(r.A,{style:{color:"white",backgroundColor:"blue"},onClick:()=>Le(t,"sub"),children:"-"})]})}];(0,n.useEffect)((()=>{const e=setTimeout((()=>{te(je.map((e=>e.label))),Z(!1)}),1e3);return()=>clearTimeout(e)}),[]);const Le=(e,t)=>{Oe((o=>{const n={...o},l=n[e.document]||1;return n[e.document]="add"==t?l+1:l-1,n}))},Xe=()=>{W(!1)},Ge=e=>{const t=Ne.filter((t=>t.category.toUpperCase()===e.toUpperCase())),o=Ne.filter(((e,t)=>ae.includes(t)&&e.checked)).map((e=>e.index));se(o),Se(t)},Qe=()=>{X(!1)},Je=()=>{Q(!1)};(0,n.useEffect)((()=>{(async()=>{try{var e,t=(await y().get(`https://novacon.live/api/documents/getCodes?companyId=${null===de||void 0===de||null===(e=de.user)||void 0===e?void 0:e.companyId}`,{headers:{Authorization:null===de||void 0===de?void 0:de.accessToken}})).data.documentNumberFormat.split("-");re(w+"-"+t[1]+"-"+t[2]+"-"+O+"-00X")}catch(o){console.error("Error fetching projects:",null===o||void 0===o?void 0:o.message)}})()}),[]),(0,n.useEffect)((()=>{}),[Pe]);const _e=()=>{I(!1)};return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(d.A,{title:"Update Code",width:400,centered:!0,visible:G,onCancel:Je,footer:null,closeIcon:(0,A.jsx)(x.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:[(0,A.jsx)(i.A,{justify:"space-between",align:"center",children:(0,A.jsx)(c.A,{span:20,children:(0,A.jsx)(u.A,{layout:"vertical",name:"basic",children:(0,A.jsx)(u.A.Item,{label:"Update Code",name:"UpdateCode",rules:[{required:!0,message:"Please Update Code"}],children:(0,A.jsx)(m.A,{value:ce,onChange:e=>{_(e.target.value)}})})})})}),(0,A.jsx)(p.A,{type:"primary",onClick:e=>{if(K){const e=[...De],t=K.key,o=`${w}-${J}-${O}-00X`;e[t]={...K,document:o},Se(e),Y(null),Je()}},children:"Confirm"})]}),(0,A.jsxs)(d.A,{title:"Upload Document",width:400,visible:L,onCancel:Qe,footer:null,closeIcon:(0,A.jsx)(x.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:[(0,A.jsx)(i.A,{justify:"space-between",align:"center",children:(0,A.jsxs)("div",{children:[(0,A.jsx)("h3",{children:"Selected Documents:"}),(0,A.jsx)("ul",{style:{margin:"2px",padding:"2px"},children:ae.map((e=>(0,A.jsx)(n.Fragment,{children:Array.from({length:De[e].count||1},((t,o)=>{var n,l,r,a,s,d,i;return(0,A.jsxs)("li",{style:{margin:"2px",padding:"2px"},children:[(0,A.jsx)("strong",{style:{color:"blue"},children:"Category:"})," ",De[e].category," ",(0,A.jsx)("br",{}),(0,A.jsx)("strong",{style:{color:"blue"},children:"Code:"})," ",De[e].code," ",(0,A.jsx)("br",{}),(0,A.jsx)("strong",{style:{color:"blue"},children:"Document Number:"})," ",(null===(n=Pe[e])||void 0===n?void 0:n[o])||""," ",(0,A.jsx)("br",{}),(0,A.jsx)("br",{}),(0,A.jsx)(u.A.Item,{label:"Start Date",name:`startedDate[${e}][${o}]`,children:(0,A.jsx)(v.A,{style:{width:"100%"},onChange:t=>((e,t,o,n)=>{qe((t=>{const l=[...t];return l[o]=l[o]||[],l[o][n]={...l[o][n],startDate:e?e.toDate():null},l}))})(t,De[e].document,e,o),disabled:null===(l=Ue[e])||void 0===l||null===(r=l[o])||void 0===r?void 0:r.isChecked,required:!0})}),(0,A.jsx)(u.A.Item,{label:"End Date",name:`endedDate[${e}][${o}]`,children:(0,A.jsx)(v.A,{style:{width:"100%"},onChange:t=>((e,t,o,n)=>{qe((t=>{const l=[...t];return l[o]=l[o]||[],l[o][n]={...l[o][n],endDate:e?e.toDate():null},l}))})(t,De[e].document,e,o),disabled:null===(a=Ue[e])||void 0===a||null===(s=a[o])||void 0===s?void 0:s.isChecked,required:!0})}),(0,A.jsx)(u.A.Item,{label:"Title",name:`title[${e}][${o}]`,children:(0,A.jsx)(m.A,{style:{margin:"6px"},placeholder:"Enter Document Title",value:(null===(d=Ue[e])||void 0===d||null===(i=d[o])||void 0===i?void 0:i.title)||"",onChange:t=>((e,t,o,n)=>{qe((t=>{const l=[...t];return l[o]=l[o]||[],l[o][n]={...l[o][n],title:e},l}))})(t.target.value,De[e].document,e,o),required:!0})})]},o)}))},e)))}),null!=D.count||""]})}),(0,A.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,A.jsx)(p.A,{type:"primary",onClick:async()=>{let e=!0;ae.forEach((async t=>{let o=De[t].count||1;const n=Ue.filter((e=>void 0!==e));console.log("count",o),console.log("DOC INFO1",n);for(let l=0;l<n.length;l++){console.log("OUTER LOOP I",l),console.log(n[l],"DOC ARRAY");for(let t=0;t<n[l].length;t++){if(console.log("INNER LOOP INDEX1",t),!(n[l][t].hasOwnProperty("title")&&n[l][t].hasOwnProperty("startDate")&&n[l][t].hasOwnProperty("endDate")&&null!==n[l][t].title&&null!==n[l][t].startDate&&null!==n[l][t].endDate)){console.log("IF CONDITION"),e=!0,s.Ay.error("Fill all the fields first");break}console.log("ELSE CONDITION"),e=!1}}})),0==e&&await(async()=>{await JSON.parse($);try{var e=z,t=O;t=t.replace(/\s/g,"");var n=ae.length;if(U)try{var l,r,d,i;const o=await y().put("https://novacon.live/api/documents/mdr",{record:U,title:e,departmentId:P,projectId:E,noOfDocuments:n,status:"Ongoing",companyId:null===de||void 0===de||null===(l=de.user)||void 0===l?void 0:l.companyId,authorId:null===de||void 0===de||null===(r=de.user)||void 0===r?void 0:r.id,authorName:`${null===de||void 0===de||null===(d=de.user)||void 0===d?void 0:d.firstName} ${null===de||void 0===de||null===(i=de.user)||void 0===i?void 0:i.lastName}`,mdrCode:t,projectCode:w,departmentName:be},{headers:{Authorization:null===de||void 0===de?void 0:de.accessToken}});a.A.success({message:"Successfully Created",description:`${o.data.message}`,style:{backgroundColor:"#52c41a",color:"#fff"}})}catch(I){var c;if(409===(null===(c=I.response)||void 0===c?void 0:c.status))return a.A.error({message:"Conflict Error",description:"A mdr with this name or code already exists. Please choose a different name or code.",style:{backgroundColor:"#f5222d",color:"#fff"}}),void history.push("/pages/mdr");a.A.success({message:"Successfully Created",description:`${response.data.message}`,style:{backgroundColor:"#52c41a",color:"#fff"}})}else try{var u,m,p,v;const o=await y().post("https://novacon.live/api/documents/mdr",{title:e,departmentId:P,projectId:E,noOfDocuments:n,status:"Ongoing",companyId:null===de||void 0===de||null===(u=de.user)||void 0===u?void 0:u.companyId,authorId:null===de||void 0===de||null===(m=de.user)||void 0===m?void 0:m.id,authorName:`${null===de||void 0===de||null===(p=de.user)||void 0===p?void 0:p.firstName} ${null===de||void 0===de||null===(v=de.user)||void 0===v?void 0:v.lastName}`,mdrCode:t,projectCode:w,departmentName:be},{headers:{Authorization:null===de||void 0===de?void 0:de.accessToken}});a.A.success({message:"Successfully Created",description:`${o.data.message}`,style:{backgroundColor:"#52c41a",color:"#fff"}})}catch(I){var h;if(409===(null===(h=I.response)||void 0===h?void 0:h.status))return a.A.error({message:"Conflict Error",description:"A mdr with this name or code already exists. Please choose a different name or code.",style:{backgroundColor:"#f5222d",color:"#fff"}}),void history.push("/pages/mdr");a.A.error({message:"Error",description:"An error occurred while adding the mdr. Please try again.",style:{backgroundColor:"#f5222d",color:"#fff"}})}if(ae.forEach((async e=>{De[e].document;let n=De[e].count||1;const l=h,r=de.user.roleId,s=de.user.id;for(let g=0;g<n;g++)try{var d,i,c,u,m=Ue[e][g].title,p=Ue[e][g].startDate,v=Ue[e][g].endDate,h=Pe[e][g];await y().post("https://novacon.live/api/documents/",{title:h,startedDate:p,expectedEndedDate:v,docTitle:m,departmentId:P,projectId:E,companyId:null===de||void 0===de||null===(d=de.user)||void 0===d?void 0:d.companyId,userId:null===de||void 0===de||null===(i=de.user)||void 0===i?void 0:i.id,userName:`${null===de||void 0===de||null===(c=de.user)||void 0===c?void 0:c.firstName} ${null===de||void 0===de||null===(u=de.user)||void 0===u?void 0:u.lastName}`,masterDocumentId:t,masterDocumentName:l,projectCode:o,departmentName:be,status:"Initialized",assignedBy:r,assignedFrom:s,approver:R,reviewer:M,version:"000"},{headers:{Authorization:null===de||void 0===de?void 0:de.accessToken}}),a.A.success({message:"Documents Successfully Added",style:{backgroundColor:"#52c41a",color:"#fff"}})}catch(I){}})),null!=D.count){let n=D.count||1;const l=e,r=de.user.roleId,s=de.user.id;for(let d=0;d<n;d++)try{var g,x,f,C,j=Ue[0][d].title,A=Ue[0][d].startDate,b=Ue[0][d].endDate;e=Te[d],await y().post("https://novacon.live/api/documents/",{title:e,startedDate:A,expectedEndedDate:b,docTitle:j,departmentId:P,projectId:E,companyId:null===de||void 0===de||null===(g=de.user)||void 0===g?void 0:g.companyId,userId:null===de||void 0===de||null===(x=de.user)||void 0===x?void 0:x.id,userName:`${null===de||void 0===de||null===(f=de.user)||void 0===f?void 0:f.firstName} ${null===de||void 0===de||null===(C=de.user)||void 0===C?void 0:C.lastName}`,masterDocumentId:t,masterDocumentName:l,projectCode:o,departmentName:be,status:"Initialized",assignedBy:r,assignedFrom:s,approver:R,reviewer:M,version:"000"},{headers:{Authorization:null===de||void 0===de?void 0:de.accessToken}}),a.A.success({message:"Documents Successfully Added",style:{backgroundColor:"#52c41a",color:"#fff"}})}catch(I){}}if(0===ae.length)return void s.Ay.error("Please select at least one row.")}catch(I){console.error("Error adding MDR:",I)}})(),Qe()},disabled:0==Ue.length,style:{},children:"Done"})})]}),(0,A.jsxs)(d.A,{title:"Departments",width:416,centered:!0,visible:V,onCancel:Xe,footer:null,closeIcon:(0,A.jsx)(x.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:[(0,A.jsx)(p.A,{size:"default",type:"primary",onClick:()=>(Xe(),void Se(Ne)),style:{margin:"8px"},children:"All Documents"}),H?je.map((e=>(0,A.jsx)(p.A,{loading:!0,size:"default",style:{margin:"8px"},children:e.label},e.label))):ee.map((e=>(0,A.jsx)(p.A,{size:"default",style:{margin:"8px"},onClick:()=>(e=>{ne(e),Xe(),Ge(e)})(e),type:oe===e?"primary":"default",children:e},e)))]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("div",{style:{textAlign:"center",marginTop:20},children:(0,A.jsx)("h1",{children:"Select Documents For MDR"})}),(0,A.jsx)("div",{style:{marginBottom:"16px",justifyContent:"space-between"},children:(0,A.jsx)("h1",{children:"MDR Templates"})}),(0,A.jsx)(h.A,{columns:Be,dataSource:De.map(((e,t)=>({...e,key:t}))),rowSelection:{selectedRowKeys:ae,onChange:(e,t)=>((e,t)=>{const o=t.map((e=>({...e,checked:!0}))).map((e=>e.index));se(o)})(0,t)},bordered:!0,size:"middle",title:()=>"All Department Documents",footer:()=>"You may filter docs",expandable:{expandedRowRender:e=>(0,A.jsx)("p",{style:{margin:0},children:e.document}),rowExpandable:e=>"Not Expandable"!==e.departmentCode}}),(0,A.jsxs)(l.A,{children:[(0,A.jsx)(p.A,{type:"primary",onClick:()=>{I(!0)},children:"Add Custom"}),(0,A.jsx)(p.A,{type:"primary",onClick:()=>{X(!0);const e=[...De];let t=[],o=[];const n=D.count;for(let l=0;l<n;l++){let e=D.document.replace("00X",(l+1).toString().padStart(3,"0")).replace("xxxx",w);o[l]||(o[l]={}),o[l]=e}ae.forEach(((o,n)=>{const l=we[De[o].document]||1;for(let r=0;r<l;r++){let n=De[o].document.replace("00X",(r+1).toString().padStart(3,"0")).replace("xxxx",w);t[o]||(t[o]={}),t[o][r]=n,e[o]={...De[o],count:we[De[o].document]}}})),Fe(o),$e(t),Se(e)},children:"Proceed"})]}),(0,A.jsx)(d.A,{title:"Add Custom Field",width:400,centered:!0,visible:b,onCancel:_e,footer:[(0,A.jsx)(p.A,{onClick:_e,children:"Cancel"},"cancel"),(0,A.jsx)(p.A,{type:"primary",onClick:()=>{const e=Ce.find((e=>e.value==me)),t=`xxxx-01-${me}-${ge}-00X`,o={count:fe||"",departmentCode:me||"",documentContentCode:ge||"",documentTitle:ve||"",areaCode:"01",category:e.label,sequenceNumber:"00X",document:t};S(o),I(!1)},children:"Add"},"add")],closeIcon:(0,A.jsx)(x.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,A.jsxs)(u.A,{layout:"vertical",name:"customForm",children:[(0,A.jsx)(u.A.Item,{label:"Department",name:"department",rules:[{required:!0,message:"Please select Project Name"}],children:(0,A.jsx)(g.A,{options:Ce,value:me,onChange:e=>pe(e)})}),(0,A.jsx)(u.A.Item,{label:"Document",name:"document",rules:[{required:!0,message:"Please Add Document"}],children:(0,A.jsx)(m.A,{value:ve,onChange:e=>he(e.target.value)})}),(0,A.jsx)(u.A.Item,{label:"Document Content Code",name:"documentContentCode",rules:[{required:!0,message:"Please Add Document Content Code"}],children:(0,A.jsx)(m.A,{value:ge,onChange:e=>xe(e.target.value)})}),(0,A.jsx)(u.A.Item,{label:"Number Of Documents",name:"noOfDoxuments",rules:[{required:!0,message:"Please Add Number of Documents"}],children:(0,A.jsx)(m.A,{value:fe,onChange:e=>ye(e.target.value)})})]})})]})]})}},64435:(e,t,o)=>{o.d(t,{e:()=>v,A:()=>g});var n=o(58168),l=o(64467),r=o(5544),a=o(65043),s=o(98139),d=o.n(s),i=o(62149),c=o(25055);function u(e){var t=e.className,o=e.direction,r=e.index,s=e.marginDirection,d=e.children,i=e.split,c=e.wrap,u=a.useContext(v),m=u.horizontalSize,p=u.verticalSize,h=u.latestIndex,g={};return u.supportFlexGap||("vertical"===o?r<h&&(g={marginBottom:m/(i?2:1)}):g=(0,n.A)((0,n.A)({},r<h&&(0,l.A)({},s,m/(i?2:1))),c&&{paddingBottom:p})),null===d||void 0===d?null:a.createElement(a.Fragment,null,a.createElement("div",{className:t,style:g},d),r<h&&i&&a.createElement("span",{className:"".concat(t,"-split"),style:g},i))}var m=o(46058),p=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o},v=a.createContext({latestIndex:0,horizontalSize:0,verticalSize:0,supportFlexGap:!1}),h={small:8,middle:16,large:24};const g=function(e){var t,o=a.useContext(c.QO),s=o.getPrefixCls,g=o.space,x=o.direction,f=e.size,y=void 0===f?(null===g||void 0===g?void 0:g.size)||"small":f,C=e.align,j=e.className,A=e.children,b=e.direction,I=void 0===b?"horizontal":b,D=e.prefixCls,S=e.split,N=e.style,k=e.wrap,w=void 0!==k&&k,O=p(e,["size","align","className","children","direction","prefixCls","split","style","wrap"]),E=(0,m.A)(),z=a.useMemo((function(){return(Array.isArray(y)?y:[y,y]).map((function(e){return function(e){return"string"===typeof e?h[e]:e||0}(e)}))}),[y]),P=(0,r.A)(z,2),$=P[0],T=P[1],F=(0,i.A)(A,{keepEmpty:!0}),R=void 0===C&&"horizontal"===I?"center":C,M=s("space",D),U=d()(M,"".concat(M,"-").concat(I),(t={},(0,l.A)(t,"".concat(M,"-rtl"),"rtl"===x),(0,l.A)(t,"".concat(M,"-align-").concat(R),R),t),j),q="".concat(M,"-item"),B="rtl"===x?"marginLeft":"marginRight",L=0,X=F.map((function(e,t){return null!==e&&void 0!==e&&(L=t),a.createElement(u,{className:q,key:"".concat(q,"-").concat(t),direction:I,index:t,marginDirection:B,split:S,wrap:w},e)})),G=a.useMemo((function(){return{horizontalSize:$,verticalSize:T,latestIndex:L,supportFlexGap:E}}),[$,T,L,E]);if(0===F.length)return null;var Q={};return w&&(Q.flexWrap="wrap",E||(Q.marginBottom=-T)),E&&(Q.columnGap=$,Q.rowGap=T),a.createElement("div",(0,n.A)({className:U,style:(0,n.A)((0,n.A)({},Q),N)},O),a.createElement(v.Provider,{value:G},X))}}}]);
//# sourceMappingURL=9491.1612699a.chunk.js.map