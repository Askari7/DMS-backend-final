"use strict";(self.webpackChunkyoda_admin_react=self.webpackChunkyoda_admin_react||[]).push([[2151],{23415:(e,t,o)=>{o.d(t,{A:()=>r});o(14556);var n=o(91688),l=o(70579);const r=()=>{var e;const t=null===(e=localStorage)||void 0===e?void 0:e.getItem("user");return console.log(t,"loggin"),t?null:(0,l.jsx)(n.Redirect,{to:"/pages/authentication/login"})}},42151:(e,t,o)=>{o.r(t),o.d(t,{default:()=>O});var n=o(65043),l=o(91688),r=o(62058),s=o(16854),i=o.n(s),a=o(44411),d=(o(15627),o(60521)),c=o(64435),u=o(89421),m=o(83557),v=o(86904),p=o(21261),h=o(47419),g=o(11645),j=o(94376),x=o(70610),f=o(78186),y=o(26412),A=o(40854),I=o.n(A),C=o(22285),b=(o(14556),o(92823),o(25884),o(23415)),S=o(7313),N=o(70579);const D=e=>{let{percentage:t}=e,o="#ff0000";return t>75?o="#1890ff":t>50&&(o="#fadb14"),(0,N.jsx)(h.A,{justify:"center",align:"middle",style:{width:180},children:(0,N.jsx)(S.A,{percent:t,steps:5,strokeColor:o})})},{Title:k,Text:w}=a.A;function O(){var e;const[t,o]=(0,n.useState)(""),[s,a]=(0,n.useState)(""),A=(0,n.useRef)(null),[S,O]=(0,n.useState)(!1),[R,E]=(0,n.useState)(!1),[P,T]=(0,n.useState)(!1),[M,z]=(0,n.useState)(!1),[J,q]=(0,n.useState)(!1),[F,L]=(0,n.useState)(),[Q,U]=(0,n.useState)(""),[_,B]=(0,n.useState)(""),[H,K]=(0,n.useState)(""),[V,G]=(0,n.useState)(""),[Y,W]=(0,n.useState)(""),[X,Z]=(0,n.useState)([]),[$,ee]=(0,n.useState)(""),[te,oe]=(0,n.useState)([]),[ne,le]=(0,n.useState)(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),[re,se]=(0,n.useState)([]),[ie,ae]=(0,n.useState)([]),[de,ce]=(0,n.useState)([]),[ue,me]=(0,n.useState)([]),[ve,pe]=(0,n.useState)([]),[he,ge]=(0,n.useState)([]),[je,xe]=(0,n.useState)([]),[fe,ye]=(0,n.useState)([]),[Ae,Ie]=(0,n.useState)(!1),[Ce,be]=(0,n.useState)([]),[Se,Ne]=(0,n.useState)([]),[De,ke]=(0,n.useState)([]),[we,Oe]=(0,n.useState)([]),[Re,Ee]=(0,n.useState)([]),[Pe,Te]=(0,n.useState)(),[Me,ze]=(0,n.useState)(),[Je,qe]=(0,n.useState)(),Fe=(0,l.useLocation)(),{matchingRecord:Le}=Fe.state||{},Qe=(e,t,n)=>{t(),o(e[0]),a(n)},Ue=e=>({filterDropdown:t=>{let{setSelectedKeys:n,selectedKeys:l,confirm:s,clearFilters:i,close:a}=t;return(0,N.jsxs)("div",{style:{padding:8},children:[(0,N.jsx)(d.A,{ref:A,placeholder:"Search ".concat(e),value:l[0],onChange:e=>n(e.target.value?[e.target.value]:[]),onPressEnter:()=>Qe(l,s,e),style:{marginBottom:8,display:"block"}}),(0,N.jsxs)(c.A,{children:[(0,N.jsx)(u.A,{type:"primary",onClick:()=>Qe(l,s,e),icon:(0,N.jsx)(r.A,{}),size:"small",style:{width:90},children:"Search"}),(0,N.jsx)(u.A,{onClick:()=>i&&(e=>{e(),o("")})(i),size:"small",style:{width:90},children:"Reset"})]})]})},filterIcon:e=>(0,N.jsx)(r.A,{style:{color:e?"#1677ff":void 0}}),onFilter:(t,o)=>o[e].toString().toLowerCase().includes(t.toLowerCase()),onFilterDropdownOpenChange:e=>{e&&setTimeout((()=>{var e;return null===(e=A.current)||void 0===e?void 0:e.select()}),100)},render:o=>s===e?(0,N.jsx)(i(),{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[t],autoEscape:!0,textToHighlight:o?o.toString():""}):o}),_e=(m.A,m.A.Item,m.A.Item,m.A.Item,JSON.stringify(Se),(0,l.useHistory)()),Be=()=>{U(""),B(""),K(""),O(!1)};const He=async e=>{Ve(e)},Ke=async(e,t)=>{if(await Ve(e),ve.length>0){const e=(e=>{const t=[];return t.push("Novacon"),e.forEach((e=>{const o=Object.keys(e)[0],n=e[o];t.push("Key,".concat(o));const l=Object.keys(n[0]);t.push('"'.concat(l.join('","'),'"')),n.forEach((e=>{const o=l.map((t=>{const o=e[t];return Array.isArray(o)?'"'.concat(o.join(","),'"'):'"'.concat(o,'"')}));t.push(o.join(","))})),t.push("")})),t.join("\n")})(ve),t=new Blob([e],{type:"text/csv"}),o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.setAttribute("download","MDR ".concat(ve[0].masterDocumentId,".csv")),document.body.appendChild(n),n.click(),document.body.removeChild(n)}},Ve=async e=>{try{const t=await I().get("http://54.81.250.98:8083/api/documents?masterDocumentId=".concat(e.mdrCode,"&projectId=").concat(e.projectId,"&companyId=").concat(e.companyId),{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}});console.log("response",t.data);const o=t.data.map((e=>{const{version:t,companyId:o,departmentId:n,projectId:l,masterDocumentId:r,masterDocumentName:s,content:i,extension:a,fileName:d,...c}=e;return c})),n={};o.forEach((e=>{const t=e.title.split("-")[2];n[t]||(n[t]=[]),n[t].push(e)}));const l=Object.keys(n).map((e=>({[e]:n[e]})));pe(l)}catch(t){console.error("Error fetching documents:",null===t||void 0===t?void 0:t.message)}};(0,n.useEffect)((()=>{}),[ve]);const Ge=async()=>{try{var e,t,o,n;const r=await I().get("http://54.81.250.98:8083/api/documents/mdr?companyId=".concat(null===ne||void 0===ne||null===(e=ne.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}});if(console.log(r.data,"response aya"),qe(r.data.projectCode),3===(null===ne||void 0===ne||null===(t=ne.user)||void 0===t?void 0:t.roleId)||4===(null===ne||void 0===ne||null===(o=ne.user)||void 0===o?void 0:o.roleId)){const e=r.data.filter((e=>{var t;return e.authorId===(null===ne||void 0===ne||null===(t=ne.user)||void 0===t?void 0:t.id)}));se(e),ae(e)}else if(2===(null===ne||void 0===ne||null===(n=ne.user)||void 0===n?void 0:n.roleId)){var l;console.log(null===ne||void 0===ne||null===(l=ne.user)||void 0===l?void 0:l.departmentId,"departmentId");const e=r.data.filter((e=>{var t,o;return e.departmentId.split(",").includes(null===ne||void 0===ne||null===(t=ne.user)||void 0===t?void 0:t.departmentId)||e.authorId===(null===ne||void 0===ne||null===(o=ne.user)||void 0===o?void 0:o.id)}));console.log("dataaaaaa",e);const t=e.map((e=>e.projectId));Z(t),se(e),ae(e)}else se(r.data),ae(r.data)}catch(r){console.error("Error fetching documents:",null===r||void 0===r?void 0:r.message)}};return(0,n.useEffect)((()=>{var e;le(JSON.parse(null===(e=localStorage)||void 0===e?void 0:e.getItem("user"))),(async()=>{try{var e;const t=await I().get("http://54.81.250.98:8083/api/departments?companyId=".concat(null===ne||void 0===ne||null===(e=ne.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}}),o=[],n=[];for(const e of null===t||void 0===t?void 0:t.data)o.push({value:null===e||void 0===e?void 0:e.id,label:null===e||void 0===e?void 0:e.title}),n.push({value:null===e||void 0===e?void 0:e.suffix,label:null===e||void 0===e?void 0:e.title});be(o),Ne(n)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const t=await I().get("http://54.81.250.98:8083/api/projects?companyId=".concat(null===ne||void 0===ne||null===(e=ne.user)||void 0===e?void 0:e.companyId),{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}}),o=new Set,n=null===t||void 0===t?void 0:t.data.reduce(((e,t)=>(o.has(t.title)||(o.add(t.title),e.push({value:t.id,label:t.title,code:t.code})),e)),[]);console.log(t.data),oe(n),console.log(te)}catch(t){console.error("Error fetching departments:",null===t||void 0===t?void 0:t.message)}})(),(async()=>{try{var e;const o=await I().get("http://54.81.250.98:8083/api/users?companyId=".concat(null===ne||void 0===ne||null===(e=ne.user)||void 0===e?void 0:e.companyId,"&roleId=2"),{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}});ye(o.data),console.log(null===o||void 0===o?void 0:o.data,"Users");const n=[],l=[];for(const e of null===o||void 0===o?void 0:o.data){var t="Engineer";1==e.roleId&&(t="CEO",n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName,departmentId:null===e||void 0===e?void 0:e.departmentId,department:e.department},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),2==e.roleId&&(t="HEAD of ".concat(e.department),n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")}),l.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),3==e.roleId&&(t="Senior Engineer ".concat(e.department),n.push({value:{id:null===e||void 0===e?void 0:e.id,name:e.firstName},label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")}),l.push({value:null===e||void 0===e?void 0:e.id,label:"".concat(null===e||void 0===e?void 0:e.firstName," ").concat(t," ")})),4==e.roleId&&(t="Junior"),5==e.roleId&&(t="Designer/Draughtsmen")}const r=n.filter((e=>1!==e.roleId));Oe(r),ke(n),Ee(l)}catch(o){console.error("Error fetching departments:",null===o||void 0===o?void 0:o.message)}})(),Ge(),console.log(re)}),[]),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(p.A,{title:"Upload Document",width:400,centered:!0,visible:S,onCancel:Be,footer:null,closeIcon:(0,N.jsx)(C.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,N.jsx)(h.A,{justify:"space-between",align:"center",children:(0,N.jsx)(g.A,{span:20,children:(0,N.jsxs)(j.A,{layout:"vertical",name:"basic",children:[(0,N.jsx)(j.A.Item,{label:"MDR Title",name:"docTitle",rules:[{required:!0,message:"Please input your title"}],children:(0,N.jsx)(d.A,{value:Q,onChange:e=>U(e.target.value)})}),(0,N.jsx)(j.A.Item,{label:"MDR Code",name:"docCode",rules:[{required:!0,message:"Please input your code"}],children:(0,N.jsx)(d.A,{value:Q,onChange:e=>G(e.target.value)})}),(0,N.jsxs)(j.A.Item,{label:"Project Name",name:"projectName",rules:[{required:!0,message:"Please select Project Name"}],children:[(0,N.jsx)(x.A,{options:te,value:_,onChange:e=>B(e)}),"              "]}),(0,N.jsx)(j.A.Item,{label:"Add Reviewers",name:"reviewers",rules:[{required:!0,message:"Please select Reviewers Name"}],children:(0,N.jsx)(f.A.Group,{options:De,value:ue,onChange:me})})," ",(0,N.jsx)(j.A.Item,{label:"Add Approvers",name:"approvers",rules:[{required:!0,message:"Please select Approvers Name"}],children:(0,N.jsx)(f.A.Group,{options:De,value:je,onChange:xe})}),(0,N.jsx)(h.A,{children:(0,N.jsx)(g.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,N.jsx)(u.A,{block:!0,onClick:Pe?()=>{if(!Q||!_||!ue||!je)return void v.A.error({message:"Validation Error",description:"Please fill in all required fields.",style:{backgroundColor:"#f5222d",color:"#fff"}});const e=te.find((e=>(null===e||void 0===e?void 0:e.value)==_)),t=JSON.stringify(Ce),o=JSON.stringify(Se),n=JSON.stringify(Pe),l=JSON.stringify(te),r=JSON.stringify(je),s=JSON.stringify(ue);_e.push("/pages/initialMDR?projectCode=".concat(e.code,"&mdrCode=").concat(V,"\n      &departmentOption=").concat(o,"&departmentOptions=").concat(t,"\n      &projectOptions=").concat(l,"&projectId=").concat(_,"&projectCode=").concat(Je,"\n      &departmentId=").concat(de,"&title=").concat(Q,"&approver=").concat(r,"\n      &reviewer=").concat(s,"&record=").concat(n))}:()=>{if(!Q||!_||!ue||!je)return void v.A.error({message:"Validation Error",description:"Please fill in all required fields.",style:{backgroundColor:"#f5222d",color:"#fff"}});const e=te.find((e=>(null===e||void 0===e?void 0:e.value)==_)),t=JSON.stringify(Ce),o=JSON.stringify(Se),n=JSON.stringify(te),l=JSON.stringify(je),r=JSON.stringify(ue);_e.push("/pages/initialMDR?projectCode=".concat(e.code,"&mdrCode=").concat(V,"\n    &departmentOption=").concat(o,"&departmentOptions=").concat(t,"\n    &projectOptions=").concat(n,"&projectId=").concat(_,"&projectCode=").concat(Je,"\n    &departmentId=").concat(de,"&title=").concat(Q,"&approver=").concat(l,"&reviewer=").concat(r))},type:"primary",htmlType:"submit",children:"MDR template"})})})]})})})}),(0,N.jsx)(p.A,{title:"Assign Document",width:400,centered:!0,visible:R,onCancel:()=>{E(!1)},footer:null,closeIcon:(0,N.jsx)(C.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,N.jsx)(h.A,{justify:"space-between",align:"center",children:(0,N.jsx)(g.A,{span:20,children:(0,N.jsxs)(j.A,{layout:"vertical",name:"basic",children:[(0,N.jsx)(j.A.Item,{label:"Project Name",name:"projectName",rules:[{required:!0,message:"Please select Project Name"}],children:(0,N.jsx)(x.A,{options:te,value:_,onChange:e=>B(e)})}),(0,N.jsx)(j.A.Item,{label:"Assigned MDR to",name:"assignMDR",rules:[{required:!0,message:"Please Assign MDR"}],children:(0,N.jsx)(x.A,{options:Re,value:he,onChange:e=>ge(e)})}),(0,N.jsx)(h.A,{children:(0,N.jsx)(g.A,{md:12,span:24,className:"hp-pr-sm-0 hp-pr-12",children:(0,N.jsx)(u.A,{block:!0,onClick:()=>(async(e,t)=>{if(_&&e)try{var o;const n=t.find((t=>t.id==e)),l=te.find((e=>(null===e||void 0===e?void 0:e.value)==_)),r=(Ce.find((e=>(null===e||void 0===e?void 0:e.value)==H)),await I().post("http://54.81.250.98:8083/api/documents/mdr",{departmentId:n.departmentId,projectId:_,companyId:null===n||void 0===n?void 0:n.companyId,authorId:null===n||void 0===n?void 0:n.id,authorName:null===n||void 0===n?void 0:n.firstName,mdrCode:V,projectCode:null===l||void 0===l?void 0:l.code,departmentName:n.department,status:"Assigned",noOfDocuments:0},{headers:{Authorization:null===ne||void 0===ne?void 0:ne.accessToken}}));v.A.success({message:"".concat(null===r||void 0===r||null===(o=r.data)||void 0===o?void 0:o.message),style:{backgroundColor:"#52c41a",color:"#fff"}}),E(!1),Ge()}catch(n){console.error("Error assigning documents:",n)}else v.A.error({message:"Validation Error",description:"Please fill in all required fields.",style:{backgroundColor:"#f5222d",color:"#fff"}})})(he,fe),type:"primary",htmlType:"submit",children:"Assigned"})})}),(0,N.jsx)(h.A,{})]})})})}),(0,N.jsx)(p.A,{title:"MDR Information",width:400,centered:!0,visible:J,onCancel:()=>{q(!1)},footer:null,closeIcon:(0,N.jsx)(C.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:Me?(0,N.jsxs)("div",{style:{textAlign:"center"},children:[(0,N.jsxs)("div",{style:{textAlign:"left"},children:[(0,N.jsxs)(k,{level:3,children:["Title: ",Me.title||null]}),(0,N.jsx)("br",{}),(0,N.jsx)(w,{strong:!0,children:"Author Name: "}),(0,N.jsx)(w,{children:Me.authorName||null}),(0,N.jsx)("br",{}),(0,N.jsx)(w,{strong:!0,children:"Department ID: "}),(0,N.jsx)(w,{children:Me.departmentId||null}),(0,N.jsx)("br",{}),(0,N.jsx)(w,{strong:!0,children:"Project Code: "}),(0,N.jsx)(w,{children:Me.projectCode||null}),(0,N.jsx)("br",{}),(0,N.jsx)(w,{strong:!0,children:"MDR Code: "}),(0,N.jsx)(w,{children:Me.mdrCode||null}),(0,N.jsx)("br",{}),(0,N.jsx)(w,{strong:!0,children:"No of Documents: "}),(0,N.jsx)(w,{children:Me.noOfDocuments||null}),(0,N.jsx)("br",{}),(0,N.jsx)(w,{strong:!0,children:"Percentage: "}),(0,N.jsx)(w,{children:Me.percentage||null}),(0,N.jsx)("br",{}),(0,N.jsx)(w,{strong:!0,children:"Status: "}),(0,N.jsx)(w,{children:Me.status}),(0,N.jsx)("br",{}),(0,N.jsx)(w,{strong:!0,children:"Created At: "}),(0,N.jsx)(w,{children:Me.createdAt}),(0,N.jsx)("br",{}),(0,N.jsx)("br",{})]}),(0,N.jsx)(u.A,{type:"primary",style:{marginTop:"16px"},onClick:async()=>{try{console.log(Me,"recordMdr")}catch(e){}},children:"Add More Documents"})]}):null}),(0,N.jsx)(p.A,{title:"Show MDR Documents ",width:400,centered:!0,visible:M,onCancel:()=>{z(!1)},footer:null,closeIcon:(0,N.jsx)(C.dCQ,{className:"remix-icon text-color-black-100",size:24}),children:(0,N.jsx)(h.A,{justify:"space-between",align:"center",children:(0,N.jsx)(g.A,{span:20,children:(0,N.jsxs)("div",{children:[(0,N.jsx)("h3",{children:"MDR Documents"}),(0,N.jsx)("ul",{children:ve.map(((e,t)=>(0,N.jsx)("li",{children:Object.entries(e).map((e=>{let[t,o]=e;return(0,N.jsxs)("div",{children:[(0,N.jsxs)("strong",{children:[t,":"]}),(0,N.jsx)("ul",{children:o.map(((e,t)=>(0,N.jsxs)("li",{children:[(0,N.jsx)("strong",{children:"Document Title:"})," ",e.docTitle," ",(0,N.jsx)("br",{})]},t)))})]},t)}))},t)))}),"        "]})})})}),(0,N.jsxs)("div",{style:{textAlign:"right",marginBottom:"16px"},children:[1==(null===ne||void 0===ne?void 0:ne.user.roleId)&&(0,N.jsx)(u.A,{type:"primary",onClick:()=>{O(!0)},style:{marginRight:"10px"},children:"Create MDR Yourself"}),1==(null===ne||void 0===ne?void 0:ne.user.roleId)&&(0,N.jsx)(u.A,{type:"primary",onClick:()=>{E(!0)},children:"Assign MDR"}),Ae&&(0,N.jsx)(MdrTemplate,{})]}),(0,N.jsx)("div",{style:{overflowX:"auto"},children:(0,N.jsx)(y.A,{columns:[{title:"Document Title",dataIndex:"title",key:"title",...Ue("title")},{title:"Project Code",dataIndex:"projectCode",key:"projectCode",...Ue("projectCode")},{title:"Dept Name",dataIndex:"departmentName",key:"departmentName",...Ue("departmentName")},{title:"Author Name",dataIndex:"authorName",key:"authorName",...Ue("authorName")},{title:"No of Documents",dataIndex:"noOfDocuments",key:"noOfDocuments",sorter:(e,t)=>e.noOfDocuments-t.noOfDocuments},{title:"Status",key:"status",dataIndex:"status",filters:[{text:"Initialized",value:"Initialized"},{text:"Ongoing",value:"Ongoing"},{text:"Completed",value:"Completed"}],onFilter:(e,t)=>t.status===e},{title:"Action",key:"action",render:(e,t)=>{var o;return(0,N.jsx)(N.Fragment,{children:(0,N.jsxs)(c.A,{size:"middle",children:[(0,N.jsx)(u.A,{onClick:()=>Ke(t),disabled:1!=(null===ne||void 0===ne||null===(o=ne.user)||void 0===o?void 0:o.roleId),children:"Export"},null===t||void 0===t?void 0:t.id),1!==ne.user.roleId&&t.authorId===(null===ne||void 0===ne?void 0:ne.user.id)&&"Assigned"==t.status&&(0,N.jsx)(u.A,{onClick:()=>(e=>{console.log("record",e),Te(e),O(!0)})(t),children:"Create"},null===t||void 0===t?void 0:t.id),1==ne.user.roleId&&(0,N.jsx)(N.Fragment,{children:(0,N.jsx)(u.A,{onClick:()=>{(e=>{console.log("record",e),Te(e),He(e),z(!0)})(t)},children:"Open"},null===t||void 0===t?void 0:t.id)})]})})}},{title:"Progress Per Document",key:"percentage",render:(e,t)=>(0,N.jsx)(c.A,{children:null!==t.percentage?(0,N.jsx)(D,{percentage:t.percentage.toFixed(1)}):null})}],size:"middle",bordered:!0,title:()=>"All Department Documents",footer:()=>"You may filter MDR",dataSource:re,rowClassName:e=>Le&&e.id===Le.selectedRecord.id?"highlighted-row":""})}),(0,N.jsx)(b.A,{})]})}}}]);
//# sourceMappingURL=2151.963375b2.chunk.js.map